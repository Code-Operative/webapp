<div id="branch-post" loading when="isLoadingPost">
  <div id="post-header" class="clearfix">
    <div class="votes">
      <img src="/assets/images/icons/black/arrow-up.png" ng-click="vote(post, 'up')">
      <p>{{ post.local }}</p>
      <img src="/assets/images/icons/black/arrow-down.png" ng-click="vote(post, 'down')">
    </div>
    <!-- Two DOM elements conditionally displayed if the post is a text type.
         One is to perform internal state transition with uisref. (Text posts)
         One is to link to an external site. (Non-text posts) -->
    <a ng-if="post.type == 'text'" ui-sref="weco.branch.post({ postid: post.id })"
       ng-show="post.profileUrlThumb">
      <div class="post-picture" style="background-image: url('{{ post.profileUrlThumb }}')"></div>
    </a>
    <a ng-if="post.type != 'text'" href="{{ post.data.text }}"
       ng-show="post.profileUrlThumb || (post.type == 'image' && post.data.text)" target="_blank">
      <div class="post-picture" style="background-image: url('{{ post.type == 'image' ? getProxyUrl(post.data.text) : post.profileUrlThumb }}'), url('/assets/images/invalid-image-url.jpg')"></div>
    </a>
    <div class="nsfw-label" ng-show="post.nsfw"><span>NSFW</span></div>
    <div class="data">
      <!-- Two DOM elements conditionally displayed again - see above. -->
      <a ng-if="post.type == 'text'" ui-sref="weco.branch.post({ postid: post.id })">
        <p class="title">{{ post.data.title }}</p>
      </a>
      <a ng-if="post.type != 'text'" href="{{ post.data.text }}" target="_blank">
        <p class="title">{{ post.data.title }}</p>
      </a>
      <span ng-class="post.type" class="post-type-marker" tooltip-text="(post.type | capitalize) + ' Post'" offset-y="20"></span>
      <span ng-class="post.type" class="description">Submitted by <a ui-sref="weco.profile.about({ username: post.data.creator })">{{ post.data.creator }}</a> to <a ui-sref="weco.branch.subbranches({ branchid: getOriginalBranches(post)[0] })">b/{{ getOriginalBranches(post)[0] }}</a><span ng-show="getOriginalBranches(post).length > 1" tooltip-text="getOriginalBranchesTooltipString(post)" offset-y="20" offset-x="25"> and {{ getOriginalBranches(post).length - 1 }} others</span> at {{ post.date | date:'HH:mm on dd of MMMM yyyy' }}</span>
      <img ng-show="isOwnPost()" ng-click="openDeletePostModal()" id="delete-post" src="/assets/images/icons/black/delete.png">
    </div>
    <div id="preview-controls" class="clearfix" ng-show="post.type != 'page' && post.type != 'audio'">
      <img src="/assets/images/icons/black/hide.png" ng-click="setPreviewState('hide')" ng-show="previewState == 'show' || previewState == 'maximise'" tooltip-text="'Hide'" offset-y="30">
      <img src="/assets/images/icons/black/show.png" ng-click="setPreviewState('show')" ng-show="previewState == 'hide'" tooltip-text="'Reveal'" offset-y="30">
      <img src="/assets/images/icons/black/maximise.png" ng-click="setPreviewState('maximise')" ng-show="previewState == 'show' && post.type != 'text'" tooltip-text="'Expand'" offset-y="30" offset-x="-10">
      <img src="/assets/images/icons/black/minimise.png" ng-click="setPreviewState('show')" ng-show="previewState == 'maximise' && post.type != 'text'" tooltip-text="'Shrink'" offset-y="30" offset-x="-10">
    </div>
  </div>
  <div id="image-post" class="post-content" ng-show="post.type == 'image' && previewState != 'hide'" ng-class="{ 'maximised': previewState == 'maximise' }">
    <div style="background-image: url('{{ getProxyUrl(post.data.text) }}'), url('/assets/images/invalid-image-url.jpg')"></div>
  </div>
  <div id="video-post" class="post-content" ng-show="post.type == 'video' && videoEmbedURL !== '' && previewState != 'hide'" ng-class="{ 'maximised': previewState == 'maximise' }">
    <div id="video-wrapper">
      <iframe width="854" height="480" ng-src="{{ videoEmbedURL }}" frameborder="0" allowfullscreen></iframe>
    </div>
  </div>
  <div id="text-post" class="post-content" ng-show="(post.type == 'text' || post.type == 'poll') && previewState != 'hide'" marked="markdownRaw"></div>

  <tabs ng-if="post.type == 'poll'" items="tabItems" states="tabStates"></tabs>

  <div id="poll-post-page-content" class="post-page-content" ng-if="post.type == 'poll'">
    <div class="content-header" id="poll-vote-header" ng-if="$state.current.name === 'weco.branch.post.vote'">
      <dropdown title="'SORT BY'" items="poll.sortAnswersByItems" selected="poll.selectedAnswerSortByItemIdx"></dropdown>
    </div>
    <div id="answer-list-container" ng-if="$state.current.name === 'weco.branch.post.vote'">
      <ul id="answer-list">
        <li ng-repeat="answer in poll.answers">
          <span class="index">{{ $index + 1 }}</span>
          <div class="data">
            <p class="title">{{ answer.text }}</p>
            <span class="description">Submitted by <a ui-sref="weco.profile.about({ username: answer.creator })">{{ answer.creator }}</a> at {{ answer.date | date:'HH:mm on dd of MMMM yyyy' }}</span>
          </div>
        </li>
      </ul>
    </div>
  </div>

  <div class="post-page-content" ng-if="post.type != 'poll'">
    <write-comment id="write-root-comment" postid="post.id" parentid="'none'" on-submit="onSubmitComment" update="false" placeholder="'Write a comment...'"></write-comment>
    <p id="permalink-notice" ng-show="isCommentPermalink()">You are viewing a single comment's thread.<a ui-sref="weco.branch.post({ postid: post.id })">(View all comments)</a></p>
    <dropdown title="'SORT BY'" items="sortCommentsByItems" selected="selectedCommentsSortByItemIdx"></dropdown>
    <div id="post-comments-wrapper" scroll-to-top-when="add-comment">
      <div id="post-comments" on-scroll-to-bottom="loadMore" loading when="isLoadingComments">
        <p id="no-comments" ng-show="comments.length == 0">No comments yet!</p>
        <div id="comment-thread" ng-show="comments.length > 0">
          <comment-thread comments="comments" sort-by="sortItems[selectedSortItemIdx]"></comment-thread>
        </div>
      </div>
    </div>
  </div>
</div>

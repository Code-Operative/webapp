<div id="branch-post" loading when="isLoadingPost">
  <div class="table-row">
    <div id="post-header" class="clearfix">
      <div class="votes">
        <img src="/assets/images/icons/black/arrow-up.png" ng-click="vote(post, 'up')">
        <p>{{ post.local }}</p>
        <img src="/assets/images/icons/black/arrow-down.png" ng-click="vote(post, 'down')">
      </div>
      <!-- Two DOM elements conditionally displayed if the post is a text type.
           One is to perform internal state transition with uisref. (Text posts)
           One is to link to an external site. (Non-text posts) -->
      <a ng-if="post.type == 'text'" ui-sref="weco.branch.post({ postid: post.id })"
         ng-show="post.profileUrlThumb">
        <div class="post-picture" style="background-image: url('{{ post.profileUrlThumb }}')"></div>
      </a>
      <a ng-if="post.type != 'text'" href="{{ post.data.text }}"
         ng-show="post.profileUrlThumb || (post.type == 'image' && post.data.text)" target="_blank">
        <div class="post-picture" style="background-image: url('{{ post.type == 'image' ? post.data.text : post.profileUrlThumb }}'), url('/assets/images/invalid-image-url.jpg')"></div>
      </a>
      <div class="data">
        <!-- Two DOM elements conditionally displayed again - see above. -->
        <a ng-if="post.type == 'text'" ui-sref="weco.branch.post({ postid: post.id })">
          <p class="title">{{ post.data.title }}</p>
        </a>
        <a ng-if="post.type != 'text'" href="{{ post.data.text }}" target="_blank">
          <p class="title">{{ post.data.title }}</p>
        </a>
        <span ng-class="post.type" class="description">Submitted by <a ui-sref="weco.profile.about({ username: post.data.creator })">{{ post.data.creator }}</a> on {{ post.date | date:'dd MMMM yyyy' }}</span>
      </div>
      <div id="preview-controls" class="clearfix" ng-show="post.type != 'page' && post.type != 'audio'">
        <img src="/assets/images/icons/black/hide.png" ng-click="setPreviewState('hide')" ng-show="previewState == 'show' || previewState == 'maximise'">
        <img src="/assets/images/icons/black/show.png" ng-click="setPreviewState('show')" ng-show="previewState == 'hide'">
        <img src="/assets/images/icons/black/maximise.png" ng-click="setPreviewState('maximise')" ng-show="previewState == 'show' && post.type != 'text'">
        <img src="/assets/images/icons/black/minimise.png" ng-click="setPreviewState('show')" ng-show="previewState == 'maximise' && post.type != 'text'">
      </div>
    </div>
    <div id="image-post" class="post-content" ng-show="post.type == 'image' && previewState != 'hide'" ng-class="{ 'maximised': previewState == 'maximise' }">
      <div style="background-image: url('{{ post.data.text }}'), url('/assets/images/invalid-image-url.jpg')"></div>
    </div>
    <div id="video-post" class="post-content" ng-show="post.type == 'video' && videoEmbedURL !== '' && previewState != 'hide'" ng-class="{ 'maximised': previewState == 'maximise' }">
      <div id="video-wrapper">
        <iframe width="854" height="480" ng-src="{{ videoEmbedURL }}" frameborder="0" allowfullscreen></iframe>
      </div>
    </div>
    <div id="text-post" class="post-content" ng-show="post.type == 'text' && previewState != 'hide'" marked="markdownRaw"></div>
    <write-comment id="write-root-comment" postid="post.id" parentid="'none'" on-submit="onSubmitComment" update="false" placeholder="'Write a comment...'"></write-comment>
    <p id="permalink-notice" ng-show="isCommentPermalink()">You are viewing a single comment's thread.<a ui-sref="weco.branch.post({ postid: post.id })">(View all comments)</a></p>
    <dropdown title="'SORT BY'" items="sortItems" selected="selectedSortItemIdx"></dropdown>
  </div>
  <!-- #fill-height (table row) takes the remaining height left by the #post-header (also table row)
       by setting height: 100% -->
  <div id="fill-height" class="table-row">
    <div id="post-comments-wrapper" scroll-to-top-when="add-comment">
      <div id="post-comments">
        <p id="no-comments" ng-show="comments.length == 0">No comments yet!</p>
        <div id="comment-thread" loading when="isLoadingComments" ng-show="comments.length > 0">
          <comment-thread comments="comments" sort-by="sortItems[selectedSortItemIdx]"></comment-thread>
        </div>
      </div>
    </div>
  </div>
</div>

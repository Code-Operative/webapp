<!--
loading
loading-when="CPMCtrl.isLoading"
-->
<div
  id="create-post-modal"
  ng-controller="CreatePostModalController as CPMCtrl">
  <h1>Submit a Post</h1>

  <p class="error-message">{{ CPMCtrl.errorMessage }}</p>

  <div>
    <div id="create-post-picture" ng-show="!CPMCtrl.UploadService.isUploading">
      <div
        id="dragdrop"
        ngf-drag-over-class="'dragover'"
        ngf-drop="setFile($file)"
        ngf-drop-available="dropSupported"
        ngf-fix-orientation="true"
        ngf-hide-on-drop-not-available="false">
        <img
          alt=""
          id="graphic"
          ng-show="CPMCtrl.postType.items[CPMCtrl.postType.selectedIndex] !== 'image'"
          ng-src="{{ CPMCtrl.url || '/assets/images/image.png' }}" />

        <div
          id="image-preview"
          ng-show="CPMCtrl.postType.items[CPMCtrl.postType.selectedIndex] === 'image'"
          style="background-image: url('{{ CPMCtrl.AppService.getProxyUrl(CPMCtrl.url) }}'), url('/assets/images/invalid-image-url.jpg')">
        </div>

        <h2 ng-show="CPMCtrl.postType.items[CPMCtrl.postType.selectedIndex] !== 'image'">
          Drop an image here!
        </h2>

        <div id="preview" ngf-background="CPMCtrl.file"></div>
      </div>

      <div
        id="choose-file"
        ng-show="CPMCtrl.postType.items[CPMCtrl.postType.selectedIndex] !== 'image'"
        ngf-accept="'image/*'"
        ngf-fix-orientation="true"
        ngf-select="CPMCtrl.setFile($file)">
        {{ dropSupported ? 'Or choose from file...' : 'Choose from file...' }}
      </div>
    </div>

    <div id="create-post-inputs" ng-show="!CPMCtrl.UploadService.isUploading">
      <dropdown
        class="style--horizontal"
        items="CPMCtrl.postType.items"
        selected="CPMCtrl.postType.selectedIndex"
        title="'post type'">
      </dropdown>

      <div class="modal__checkbox-wrapper">
        <span class="text--uppercase">
          nsfw
        </span>
        <input
          id="checkbox-nsfw"
          ng-model="CPMCtrl.newPost.nsfw"
          type="checkbox" />
        <label class="checkbox" for="checkbox-nsfw"></label>
      </div>

      <div
        class="modal__checkbox-wrapper"
        ng-show="CPMCtrl.postType.selectedIndex === 5">
        <span class="text--uppercase">
          lock answers
        </span>
        <input
          id="checkbox-locked"
          ng-model="CPMCtrl.newPost.locked"
          type="checkbox" />
        <label class="checkbox" for="checkbox-locked"></label>
      </div>

      <input
        ng-model="CPMCtrl.newPost.title"
        placeholder="Title (max 200 characters)"
        type="text" />

      <tag-editor
        items="CPMCtrl.tags"
        max="5"
        title="'Tag another branch, max 5 tags'">
      </tag-editor>
    </div>
  </div>

  <input
    ng-model="CPMCtrl.newPost.url"
    ng-show="!CPMCtrl.UploadService.isUploading && !['poll', 'text'].includes(CPMCtrl.postType.items[CPMCtrl.postType.selectedIndex])"
    placeholder="Url"
    type="text" />

  <textarea
    ng-model="CPMCtrl.newPost.text"
    ng-show="!CPMCtrl.UploadService.isUploading && !CPMCtrl.preview" 
    placeholder="Describe this post..."
    type="text">
  </textarea>

  <input
    class="captcha"
    name="captcha"
    ng-model="CPMCtrl.newPost.captcha"
    type="text" />

  <div
    id="preview-content"
    marked="CPMCtrl.newPost.text"
    ng-show="!CPMCtrl.UploadService.isUploading && CPMCtrl.preview && ['poll', 'text'].includes(CPMCtrl.postType.items[CPMCtrl.postType.selectedIndex])">
  </div>

  <p
    id="preview-post"
    ng-click="CPMCtrl.togglePreview()"
    ng-show="!CPMCtrl.UploadService.isUploading && CPMCtrl.newPost.text.length && ['poll', 'text'].includes(CPMCtrl.postType.items[CPMCtrl.postType.selectedIndex])">
    {{ CPMCtrl.preview ? 'Edit...' : 'Preview...' }}
  </p>

  <poll-answer-editor
    answers="CPMCtrl.pollAnswers"
    ng-show="!CPMCtrl.UploadService.isUploading && CPMCtrl.postType.items[CPMCtrl.postType.selectedIndex] === 'poll'"
    title="Create a new Answer">
  </poll-answer-editor>

  <div id="progress-container" ng-show="CPMCtrl.UploadService.isUploading">
    <div id="progress" style="width:{{ CPMCtrl.UploadService.progress }}%"></div>
  </div>
</div>

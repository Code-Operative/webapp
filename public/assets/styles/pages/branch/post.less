@post__preview-spacing: @g-padding-post;
@post__preview-control-btn-size: 30px;
@post__preview-control-btn-opacity: .5;

@post__preview-control-btn-animation-speed: .3s;
@post__preview-control-btn-animation-easing: ease;
@post__preview-control-btn-animation-start-opacity: @post__preview-control-btn-opacity;
@post__preview-control-btn-animation-start-transform: scale(1);
@post__preview-control-btn-animation-end-opacity: 0;
@post__preview-control-btn-animation-end-transform: scale(0);

@post__preview-content-animation-start-opacity: 1;
@post__preview-content-animation-start-transform: translateY(0);
@post__preview-content-animation-end-opacity: 0;
@post__preview-content-animation-end-transform: translateY(-100%);

div#branch-post, // Legacy identifier
.post {
  @header-min-height: 70px;

  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  // overflow: auto;
  // padding: 10px 20px 0;
  position: relative;

  > .branch-post--header {
    align-items: center;
    display: flex;
    min-height: @header-min-height + (@g-padding-post * 2);

    .mediaQuery(@screen-md, { display: block; });
  }

  .chart {
    @size: 250px;

    height: @size;
    margin: @post__preview-spacing auto;
    width: @size;
  }

  .comments { padding: @post__preview-spacing; }

  .content--sidebar-toggle {
    margin-left: @g-padding-post;
    margin-right: 0 !important;
  }

  .dropdown {
    margin-right: @post__preview-spacing;
    padding: 0;

    .dropdown-title {
      line-height: 1;
      padding-left: 0;
      padding-top: 3px;
    }
  }

  .list-item {
    .list-item(@header-min-height);

    margin-top: @g-padding-post;
    padding: 0 0 @g-padding-post;

    .list-item-votes { margin-left: @post__preview-spacing; }
  }

  .post__body {
    display: flex;
    flex: 1;
    flex-direction: column;
    overflow-y: hidden;
  }

  .post__preview {
    border-bottom: solid 1px @primary-8;
    min-height: @post__preview-control-btn-size + (@post__preview-spacing * 2);
    overflow: auto;
    position: relative;

    ng-include {
      display: block;
      height: 100%;
      margin: 0 @post__preview-spacing @post__preview-spacing;
      overflow: hidden;
      // Must be padding so the content animation goes to the top edge.
      padding-top: @post__preview-spacing;
      position: relative;
    }

    .post__preview-content {
      p { margin: 0; }

      &.ng-hide-add,
      &.ng-hide-remove {
        transition: transform @post__preview-control-btn-animation-speed @post__preview-control-btn-animation-easing,
          opacity @post__preview-control-btn-animation-speed @post__preview-control-btn-animation-easing;
      }

      &.ng-hide-add {
        opacity: @post__preview-content-animation-start-opacity;
        transform: @post__preview-content-animation-start-transform;

        &.ng-hide-add-active {
          opacity: @post__preview-content-animation-end-opacity;
          transform: @post__preview-content-animation-end-transform;
        }
      }

      &.ng-hide-remove {
        opacity: @post__preview-content-animation-end-opacity;
        transform: @post__preview-content-animation-end-transform;

        &.ng-hide-remove-active {
          opacity: @post__preview-content-animation-start-opacity;
          transform: @post__preview-content-animation-start-transform;
        }
      }

      &.style--image {
        div {
          background-position: center;
          background-repeat: no-repeat;
          background-size: contain;
          height: 200px;
          width: auto;
          transition: height .3s ease-out;
        }

        &.maximised div {
          height: 350px;
          width: auto;
        }
      }

      &.style--poll {}

      &.style--text {
        max-height: 350px;
        overflow-y: scroll;
      }

      &.style--video {
        margin-left: auto;
        margin-right: auto;
        width: 100%;
        transition: width .3s ease-out;

        div {
          height: 0;
          position: relative;
          padding-bottom: 56.25%; /* 16:9 */
          padding-top: 25px;
          transition: width .3s ease-out;

          iframe {
            height: 100%;
            left: 0;
            position: absolute;
            top: 0;
            width: 100%;
          }
        }

        &.maximised { width: 100%; }

        .mediaQuery(@screen-md, { width: 43.75%; });
      }
    }

    .post__preview-controls {
      position: absolute;
      right: @post__preview-spacing;
      top: @post__preview-spacing;
      z-index: 1;

      .post__preview-control-btn {
        float: right;
        height: @post__preview-control-btn-size;
        margin-left: 5px;
        opacity: @post__preview-control-btn-opacity;
        width: @post__preview-control-btn-size;
        transition: transform @post__preview-control-btn-animation-speed @post__preview-control-btn-animation-easing;
        // Fix Webkit blur issue.
        // @source: https://stackoverflow.com/questions/27060690/webkit-transform-scale-blurry-images
        -webkit-filter: blur(0px);

        &:hover {
          cursor: pointer;
          opacity: 1;
        }

        &.toggled { transform: rotateZ(180deg); }

        &.ng-hide-add,
        &.ng-hide-remove {
          transition: transform @post__preview-control-btn-animation-speed @post__preview-control-btn-animation-easing,
            opacity @post__preview-control-btn-animation-speed @post__preview-control-btn-animation-easing;
        }

        &.ng-hide-add {
          opacity: @post__preview-control-btn-animation-start-opacity;
          transform: @post__preview-control-btn-animation-start-transform;

          &.ng-hide-add-active {
            opacity: @post__preview-control-btn-animation-end-opacity;
            transform: @post__preview-control-btn-animation-end-transform;
          }
        }

        &.ng-hide-remove {
          opacity: @post__preview-control-btn-animation-end-opacity;
          transform: @post__preview-control-btn-animation-end-transform;

          &.ng-hide-remove-active {
            opacity: @post__preview-control-btn-animation-start-opacity;
            transform: @post__preview-control-btn-animation-start-transform;
          }
        }
      }
    }
  }

  .post__content-wrapper {
    flex: 1;
    overflow-y: scroll;

    .list-item__title { line-height: 1.5 !important; }

    .style--card-poll-answer {
      .list-item(70px);
    }

    p#no-answers { font-style: italic; }
  }

  .post__content-header {
    align-items: center !important;
    display: flex !important;
    justify-content: flex-start !important;
    padding: @post__preview-spacing !important;

    .button.ok {
      .button(@primary-7, transparent, auto, {
        background-color: @primary-7;
        box-shadow: none;
        color: #fff;
      });

      border: none;
      display: flex;
      line-height: 1;
      padding: 5px 8px;

      span {
        font-size: 11px;
        line-height: inherit;
      }

      & ~ .button { margin-left: 8px; }
    }
  }

  .tabs { display: block; }

  .mediaQuery(@screen-md, {
    .loading-container {
      height: calc(~'100% - 20px');
      width: calc(~'100% - 20px');
    }
  });
}

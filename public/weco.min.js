"use strict";function getLogActionVerb(a){return"addmod"==a?"added":"removemod"==a?"removed":""}function getTemplate(a){var b="<div class=\"time\">{{ entry.date | date: 'dd MMMM yyyy HH:mm' }}</div>";switch(a.action){case"removemod":case"addmod":return b+'<div class="entry"><a ui-sref="weco.profile.about({ username: entry.username })">{{ entry.username }}</a> '+getLogActionVerb(a.action)+' <a ui-sref="weco.profile.about({ username: entry.data })">{{ entry.data }}</a> as a moderator.</div>';case"make-subbranch-request":return b+'<div class="entry"><a ui-sref="weco.profile.about({ username: entry.username })">{{ entry.username }}</a> made a Child Branch Request to <a ui-sref="weco.branch.nucleus.about({ branchid: entry.data })">{{ entry.data }}</a>.</div>';case"answer-subbranch-request":var c=JSON.parse(a.data);return b+'<div class="entry"><a ui-sref="weco.profile.about({ username: entry.username })">{{ entry.username }}</a> '+c.response+"ed a Child Branch Request to <a ui-sref=\"weco.branch.nucleus.about({ branchid: '"+c.parentid+"' })\">"+c.parentid+"</a> made by <a ui-sref=\"weco.profile.about({ username: '"+c.childmod+"' })\">"+c.childmod+"</a> from <a ui-sref=\"weco.branch.nucleus.about({ branchid: '"+c.childid+"' })\">"+c.childid+"</a>.</div>";default:return""}}var app=angular.module("wecoApp",["config","ui.router","ngAnimate","ngSanitize","ngFileUpload","hc.marked","api"]);app.constant("NotificationTypes",{NEW_CHILD_BRANCH_REQUEST:0,CHILD_BRANCH_REQUEST_ANSWERED:1,BRANCH_MOVED:2,ADDED_MODERATOR:3,REMOVED_MODERATOR:4,NEW_COMMENT:5,NEW_REPLY:6}),app.config(["markedProvider",function(a){a.setOptions({gfm:!0,sanitize:!0})}]),app.config(function($sceDelegateProvider){$sceDelegateProvider.resourceUrlWhitelist(["self","*://www.youtube.com/**"])}),app.config(function($stateProvider,$urlRouterProvider,$locationProvider){$locationProvider.html5Mode(!0),$urlRouterProvider.otherwise("/"),$urlRouterProvider.rule(function($injector,$location){var a=$location.path(),b="/"===a[a.length-1];if(b){var c=a.substr(0,a.length-1);return c}}),$stateProvider.state("auth",{"abstract":!0,templateUrl:"/app/pages/auth/auth.view.html",controller:"authController"}).state("auth.login",{url:"/login"}).state("auth.signup",{url:"/signup"}).state("weco",{"abstract":!0,resolve:{authenticate:function(){console.log("This code is ran before any state is reached...")}},template:'<nav-bar></nav-bar><div class="full-page" ui-view></div>'}).state("weco.notfound",{templateUrl:"/app/pages/notfound/notfound.view.html"}).state("weco.home",{url:"/",templateUrl:"/app/pages/home/home.view.html"}).state("weco.profile",{url:"/u/:username","abstract":!0,templateUrl:"/app/pages/profile/profile.view.html",controller:"profileController"}).state("weco.profile.about",{url:"/about",templateUrl:"/app/pages/profile/about/about.view.html"}).state("weco.profile.timeline",{url:"/timeline",templateUrl:"/app/pages/profile/timeline/timeline.view.html"}).state("weco.profile.settings",{url:"/settings",templateUrl:"/app/pages/profile/settings/settings.view.html",selfOnly:!0,redirectTo:"auth.login"}).state("weco.profile.notifications",{url:"/notifications",templateUrl:"/app/pages/profile/notifications/notifications.view.html",selfOnly:!0,redirectTo:"auth.login"}).state("weco.branch",{url:"/b/:branchid","abstract":!0,templateUrl:"/app/pages/branch/branch.view.html",controller:"branchController"}).state("weco.branch.nucleus",{url:"/nucleus","abstract":!0,templateUrl:"/app/pages/branch/nucleus/nucleus.view.html",controller:"nucleusController"}).state("weco.branch.nucleus.about",{url:"",templateUrl:"/app/pages/branch/nucleus/about/about.view.html"}).state("weco.branch.nucleus.settings",{templateUrl:"/app/pages/branch/nucleus/settings/settings.view.html",controller:"nucleusSettingsController"}).state("weco.branch.nucleus.moderators",{templateUrl:"/app/pages/branch/nucleus/moderators/moderators.view.html",controller:"nucleusModeratorsController"}).state("weco.branch.nucleus.modtools",{templateUrl:"/app/pages/branch/nucleus/modtools/modtools.view.html",controller:"nucleusModToolsController"}).state("weco.branch.subbranches",{url:"/subbranches",templateUrl:"/app/pages/branch/subbranches/subbranches.view.html",controller:"subbranchesController"}).state("weco.branch.wall",{url:"/wall",templateUrl:"/app/pages/branch/wall/wall.view.html",controller:"wallController"}).state("weco.branch.post",{url:"/p/:postid",templateUrl:"/app/pages/branch/post/post.view.html",controller:"postController"}).state("weco.branch.post.comment",{url:"/c/:commentid"}),$urlRouterProvider.when("/u/{username}","/u/{username}/about"),$urlRouterProvider.when("/b/{branchid}","/b/{branchid}/wall"),$urlRouterProvider.otherwise(function($injector,$location){var a=$injector.get("$state");return a.go("weco.notfound"),$location.path()})}),app.run(["$rootScope","$state","User",function(a,b,c){a.$on("$stateChangeStart",function(a,d,e,f,g){function h(){d.authenticate&&0===Object.keys(i).length&&(b.transitionTo(d.redirectTo),a.preventDefault()),!d.selfOnly||0!==Object.keys(i).length&&e.username==i.username||(b.transitionTo(d.redirectTo),a.preventDefault())}var i=c.me();0===Object.keys(i).length?c.isAuthenticated().then(function(a){i=a,h()},h):h()})}]),app.controller("rootController",["$scope","$state",function(a,b){a.hasNavBar=function(){return!(b.current.name.indexOf("auth")>-1)}}]);var app=angular.module("wecoApp");app.directive("commentThread",["$state","Comment","User","$timeout",function(a,b,c,d){return{restrict:"E",replace:!1,scope:{comments:"=",sortBy:"="},templateUrl:"/app/components/comment-thread/comment-thread.view.html",link:function(e){function f(a,c,e){var g=c.shift();g&&b.get(a.postid,a.comments[e].id).then(function(b){b&&d(function(){a.comments[e].data=b.data,a.comments[e].isLoading=!1}),f(a,c,e+1)})["catch"](function(){f(a,c,e+1)})}function g(a){b.getMany(a.postid,a.id,e.sortBy.toLowerCase()).then(function(b){d(function(){a.comments=b;for(var c=0;c<a.comments.length;c++)a.comments[c].isLoading=!0;f(a,b.slice(),0)})},function(){console.error("Unable to get replies!")})}e.user=c.me(),e.openComment=void 0,e.openReply=function(a,b){d(function(){e.openComment&&(e.openComment.openReply=!1),e.openComment=a,e.openComment.openReply=!0,e.openComment.update=b})},e.closeReply=function(){d(function(){e.openComment.openReply=!1,e.openComment=void 0})},e.onCancelComment=function(){e.closeReply()},e.onSubmitComment=function(){e.openComment.update?(d(function(){e.openComment.isLoading=!0}),b.get(e.openComment.postid,e.openComment.id).then(function(a){d(function(){e.openComment.data=a,e.openComment.isLoading=!1,e.closeReply()})},function(){console.error("Unable to reload comment!"),e.closeReply()})):(e.loadMore(e.openComment),e.closeReply())},e.timeSince=function(a){var b=6e4,c=60*b,d=24*c,e=30*d,f=365*d,g=(new Date).getTime()-new Date(a);return g<b?Math.round(g/1e3)+" seconds ago":g<c?Math.round(g/b)+" minutes ago":g<d?Math.round(g/c)+" hours ago":g<e?Math.round(g/d)+" days ago":g<f?Math.round(g/e)+" months ago":Math.round(g/f)+" years ago"},e.loadMore=function(a){g(a)},e.vote=function(a,c){b.vote(a.postid,a.id,c).then(function(){var b="up"==c?1:-1;d(function(){a.individual+=b})},function(a){console.error("Unable to vote on comment!")})},e.isOwnComment=function(a){return!(!c.me()||!a.data)&&c.me().username==a.data.creator},e.openCommentPermalink=function(b){a.go("weco.branch.post.comment",{postid:b.postid,commentid:b.id},{reload:!0})}}}}]);var app=angular.module("wecoApp");app.directive("dropdown",["$timeout",function(a){return{restrict:"E",replace:"true",templateUrl:"/app/components/dropdown/dropdown.view.html",scope:{title:"&",items:"=",selected:"="},link:function(b,c,d){b.isOpen=!1,b.open=function(){a(function(){b.isOpen=!0})},b.close=function(){a(function(){b.isOpen=!1})},b.select=function(c){a(function(){b.selected=c,b.close()})}}}}]);var app=angular.module("wecoApp");app.directive("loading",["$compile",function(a){return{restrict:"A",templateUrl:"/app/components/loading/loading.view.html",scope:{when:"&"},replace:!1,transclude:!0,link:function(a,b,c,d,e){e(a.$parent,function(a,c){b.append(a)})}}}]);var app=angular.module("wecoApp");app.directive("modLogEntry",["$compile",function(a){var b=function(b,c,d){c.html(getTemplate(b.entry)),a(c.contents())(b)};return{restrict:"A",replace:!1,link:b,scope:{entry:"="}}}]);var app=angular.module("wecoApp");app.controller("modalCreateBranchController",["$scope","$timeout","Modal","Branch",function(a,b,c,d){a.newBranch={parentid:c.getInputArgs().branchid},a.errorMessage="",a.$on("OK",function(){return a.newBranch&&a.newBranch.id&&a.newBranch.name?(a.isLoading=!0,a.newBranch.id=a.newBranch.id.toLowerCase(),void d.create(a.newBranch).then(function(){b(function(){var b=a.newBranch.id;a.newBranch={},a.errorMessage="",a.isLoading=!1,c.OK({branchid:b})})},function(c){b(function(){a.errorMessage=c.message,a.isLoading=!1})})):void b(function(){a.errorMessage="Please fill in all fields"})}),a.$on("Cancel",function(){b(function(){a.newBranch={},a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalNucleusAddModController",["$scope","$timeout","Modal","Mod",function(a,b,c,d){a.Modal=c,a.errorMessage="",a.isLoading=!1,a.data={},a.$on("OK",function(){a.isLoading=!0;var e=c.getInputArgs().branchid;d.create(e,a.data.username).then(function(){b(function(){a.data={},a.errorMessage="",a.isLoading=!1,c.OK()})},function(c){b(function(){a.data={},a.errorMessage=c.message,404==c.status&&(a.errorMessage="That user doesn't exist"),a.isLoading=!1})})}),a.$on("Cancel",function(){b(function(){a.data={},a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalNucleusDeleteBranchController",["$scope","$timeout","Modal","Branch",function(a,b,c,d){a.Modal=c,a.errorMessage="",a.isLoading=!1,a.data={},a.$on("OK",function(){return a.data&&a.data.branchid?(a.isLoading=!0,void d["delete"](a.data.branchid).then(function(){b(function(){a.data={},a.errorMessage="",a.isLoading=!1,c.OK()})},function(c){b(function(){a.errorMessage=c.message,a.isLoading=!1})})):void b(function(){a.errorMessage="Please fill in all fields"})}),a.$on("Cancel",function(){b(function(){a.data={},a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalNucleusRemoveModController",["$scope","$timeout","Modal","Branch","User","Mod",function(a,b,c,d,e,f){function g(c,d){var f=e.get(c);return f.then(function(c){b(function(){a.mods[d]=c})},function(){console.error("Unable to get mod!")}),f}a.Modal=c,a.errorMessage="",a.isLoading=!0,a.mods=[],a.selectedMod={};for(var h=[],i=0;i<c.getInputArgs().mods.length;i++)h.push(g(c.getInputArgs().mods[i].username,i));Promise.all(h).then(function(){a.isLoading=!1}),a.select=function(b){a.selectedMod=b},a.$on("OK",function(){a.isLoading=!0;var d=c.getInputArgs().branchid;f["delete"](d,a.selectedMod.username).then(function(){b(function(){c.OK(),a.selectedMod={},a.errorMessage="",a.isLoading=!1})},function(c){b(function(){a.errorMessage=c.message,404==c.status&&(a.errorMessage="That user doesn't exist"),a.isLoading=!1})})}),a.$on("Cancel",function(){b(function(){c.Cancel(),a.selectedMod={},a.errorMessage="",a.isLoading=!1})})}]);var app=angular.module("wecoApp");app.controller("modalNucleusReviewSubbranchRequestsController",["$scope","$timeout","Modal","Branch",function(a,b,c,d){a.Modal=c,a.errorMessage="",a.requests=[],a.isLoading=!0,d.getSubbranchRequests(c.getInputArgs().branchid).then(function(c){function e(a,b){var e=d.get(a);return e.then(function(a){c[b].branch=a},function(){console.error("Unable to get branch!")}),e}for(var f=[],g=0;g<c.length;g++)f.push(e(c[g].childid,g));Promise.all(f).then(function(){b(function(){a.requests=c,a.isLoading=!1})},function(){b(function(){a.errorMessage="Unable to fetch SubBranch requests.",a.isLoading=!1})})},function(){console.error("Unable to get subbranch requests!")}),a.action=function(c,e){a.isLoading=!0,d.actionSubbranchRequest(e,a.requests[c].parentid,a.requests[c].childid).then(function(){b(function(){a.requests.splice(c,1),a.errorMessage="",a.isLoading=!1})},function(c){b(function(){a.errorMessage=c.message,404==c.status&&(a.errorMessage="That user doesn't exist"),a.isLoading=!1})})},a.$on("OK",function(){b(function(){a.errorMessage="",a.isLoading=!1,c.OK()})}),a.$on("Cancel",function(){b(function(){a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalNucleusSubmitSubbranchRequestController",["$scope","$timeout","Modal","Branch",function(a,b,c,d){a.Modal=c,a.errorMessage="",a.isLoading=!1,a.data={},a.$on("OK",function(){if(!a.data||!a.data.parentid)return void b(function(){a.errorMessage="Please fill in all fields"});a.isLoading=!0;var e=c.getInputArgs().branchid;d.submitSubbranchRequest(a.data.parentid,e).then(function(){b(function(){a.data={},a.errorMessage="",a.isLoading=!1,c.OK()})},function(c){b(function(){a.errorMessage=c.message,a.isLoading=!1})})}),a.$on("Cancel",function(){b(function(){a.data={},a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalNucleusSettingsController",["$scope","$timeout","Modal","Branch",function(a,b,c,d){a.Modal=c,a.inputValues=[],a.textareaValues=[],a.errorMessage="",a.isLoading=!1,a.$on("OK",function(){if(a.inputValues.length<c.getInputArgs().inputs.length||a.inputValues.indexOf("")>-1||a.textareaValues.length<c.getInputArgs().textareas.length||a.textareaValues.indexOf("")>-1)return void b(function(){a.errorMessage="Please fill in all fields"});for(var e={},f=0;f<c.getInputArgs().inputs.length;f++)e[c.getInputArgs().inputs[f].fieldname]=a.inputValues[f],"date"==c.getInputArgs().inputs[f].type&&(e[c.getInputArgs().inputs[f].fieldname]=new Date(a.inputValues[f]).getTime());for(var f=0;f<c.getInputArgs().textareas.length;f++)e[c.getInputArgs().textareas[f].fieldname]=a.textareaValues[f];a.isLoading=!0,d.update(e).then(function(){b(function(){a.inputValues=[],a.textareaValues=[],a.errorMessage="",a.isLoading=!1,c.OK()})},function(c){b(function(){a.errorMessage=c.message,a.isLoading=!1})})}),a.$on("Cancel",function(){b(function(){a.inputValues=[],a.textareaValues=[],a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.directive("modal",["Modal",function(a){return{restrict:"A",replace:!1,scope:{},templateUrl:"/app/components/modals/modal.view.html",link:function(b,c,d){b.getTemplateUrl=a.templateUrl,b.isOpen=a.isOpen,b.OK=function(){b.$broadcast("OK")},b.Cancel=function(){b.$broadcast("Cancel")}}}}]);var app=angular.module("wecoApp");app.factory("Modal",["$timeout",function(a){var b={},c="";b.templateUrl=function(){return c};var d=!1;b.isOpen=function(){return d};var e={};b.getInputArgs=function(){return e};var f={};b.getOutputArgs=function(){return f};var g,h;return b.open=function(b,f){return c="",a(function(){c=b}),d=!0,e=f,new Promise(function(a,b){g=a,h=b})},b.OK=function(b){a(function(){d=!1,b&&(f=b),g(!0)})},b.Cancel=function(b){a(function(){d=!1,b&&(f=b),g(!1)})},b.Error=function(){h()},b}]);var app=angular.module("wecoApp");app.controller("modalCreatePostController",["$scope","$timeout","$http","ENV","Upload","Modal","Post",function(a,b,c,d,e,f,g){a.Modal=f,a.errorMessage="",a.file=null,a.uploadUrl="",a.isUploading=!1,a.isLoading=!1,a.progress=0,a.preview=!1,a.newPost={branchids:[f.getInputArgs().branchid]},a.postType={items:["TEXT","PAGE","IMAGE","VIDEO","AUDIO"],idx:0,title:"POST TYPE"},a.togglePreview=function(){a.preview=!a.preview},a.setFile=function(b){a.file=b},a.upload=function(b){c({method:"GET",url:d.apiEndpoint+"post/"+b+"/picture-upload-url"}).then(function(b){b&&b.data&&b.data.data?(a.uploadUrl=b.data.data,e.http({url:a.uploadUrl,method:"PUT",headers:{"Content-Type":"image/*"},data:a.file}).then(function(b){a.file=null,a.isUploading=!1,a.progress=0,f.OK()},function(b){a.file=null,a.isUploading=!1,a.progress=0,console.error("Unable to upload photo!")},function(b){a.progress=Math.min(100,parseInt(100*b.loaded/b.total))})):console.log("error")},function(){console.log("error")})},a.$on("OK",function(){if(!(a.newPost&&a.newPost.title&&a.newPost.branchids&&0!==a.newPost.branchids.length&&a.newPost.text))return void b(function(){a.errorMessage="Please fill in all fields"});a.isLoading=!0,a.newPost.type=a.postType.items[a.postType.idx].toLowerCase();var c=JSON.parse(JSON.stringify(a.newPost));c.branchids=JSON.stringify(a.newPost.branchids),g.create(c).then(function(c){b(function(){a.errorMessage="",a.isLoading=!1,a.progress=0,a.file&&"image"!=a.newPost.type?(a.isUploading=!0,a.upload(c)):f.OK()})},function(c){b(function(){a.errorMessage=c.message,a.isLoading=!1})})}),a.$on("Cancel",function(){b(function(){a.errorMessage="",a.isLoading=!1,f.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalProfileSettingsController",["$scope","$timeout","Modal","User",function(a,b,c,d){a.Modal=c,a.values=[],a.errorMessage="",a.isLoading=!1,a.$on("OK",function(){if(a.values.length<c.getInputArgs().inputs.length||a.values.indexOf("")>-1)return void b(function(){a.errorMessage="Please fill in all fields"});for(var e={},f=0;f<c.getInputArgs().inputs.length;f++)e[c.getInputArgs().inputs[f].fieldname]=a.values[f],"date"==c.getInputArgs().inputs[f].type&&(e[c.getInputArgs().inputs[f].fieldname]=new Date(a.values[f]).getTime());a.isLoading=!0,d.update(e).then(function(){b(function(){a.values=[],a.errorMessage="",a.isLoading=!1,c.OK()})},function(c){b(function(){a.errorMessage=c.message,a.isLoading=!1})})}),a.$on("Cancel",function(){b(function(){a.values=[],a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalUploadImageController",["$scope","$timeout","Modal","$http","ENV","Upload",function(a,b,c,d,e,f){a.Modal=c,a.errorMessage="",a.uploadUrl="",a.file=null,a.isUploading=!1,a.progress=0,a.$watch(function(){return c.isOpen()},function(b){b&&d({method:"GET",url:e.apiEndpoint+c.getInputArgs().route+c.getInputArgs().type+"-upload-url"}).then(function(b){b&&b.data&&b.data.data?a.uploadUrl=b.data.data:console.log("error")},function(){console.log("error")})}),a.setFile=function(b){a.file=b},a.upload=function(){return a.file?void f.http({url:a.uploadUrl,method:"PUT",headers:{"Content-Type":"image/*"},data:a.file}).then(function(b){a.file=null,a.isUploading=!1,a.progress=0,c.OK()},function(b){a.file=null,a.isUploading=!1,a.progress=0,console.error("Unable to upload photo!")},function(b){a.progress=Math.min(100,parseInt(100*b.loaded/b.total))}):void console.error("No file selected")},a.$on("Cancel",function(){b(function(){a.file=null,a.errorMessage="",c.Cancel()})}),a.$on("OK",function(){return a.file?void b(function(){a.errorMessage="",a.isUploading=!0,a.progress=0,a.upload()}):void console.error("No file selected")})}]);var app=angular.module("wecoApp");app.directive("navBar",["User","$state",function(a,b){return{restrict:"E",replace:"true",templateUrl:"/app/components/nav/nav.view.html",link:function(c,d,e){c.user=a.me,c.isLoggedIn=a.isLoggedIn,c.logout=function(){c.expanded=!1,a.logout().then(function(){b.go("auth.login")},function(){alert("Unable to log out!")})},c.isControlSelected=function(a){return b.current.name.indexOf(a)>-1&&"root"==b.params.branchid},c.onHomePage=function(){return"weco.home"==b.current.name},c.expanded=!1,c.isNavExpanded=function(){return c.expanded},c.toggleNav=function(){c.expanded=!c.expanded}}}}]);var app=angular.module("wecoApp");app.directive("notificationEntry",["$compile","NotificationTypes",function(a,b){function c(a){switch(a.type){case b.NEW_CHILD_BRANCH_REQUEST:return'<div class="title"><a ui-sref="weco.profile.about({ username: entry.data.username })">{{ entry.data.username }}</a> has submitted a parent branch request to <a ui-sref="weco.branch.nucleus.about({ branchid: entry.data.parentid })">b/{{ entry.data.parentid }}</a></div><div class="description">received at {{ entry.date | date:\'hh:mm on dd of MMMM yyyy\' }}</div>';default:return""}}var d=function(b,d,e){d.html(c(b.entry)),a(d.contents())(b)};return{restrict:"A",replace:!1,link:d,scope:{entry:"="}}}]);var app=angular.module("wecoApp");app.directive("scrollToTopWhen",["$rootScope","$timeout",function(a,b){return{link:function(c,d,e){a.$on(e.scrollToTopWhen,function(){b(function(){angular.element(d)[0].scrollTop=0})})}}}]);var app=angular.module("wecoApp");app.directive("tabs",["$state",function(a){return{restrict:"E",replace:"true",scope:{items:"&",states:"&",callbacks:"="},templateUrl:"/app/components/tabs/tabs.view.html",link:function(b,c,d){b.isSelected=function(c){var d,e,f=b.states()[c].indexOf("("),g=b.states()[c].indexOf(")");if(f>-1&&g>-1)try{d=JSON.parse(b.states()[c].substr(f+1,b.states()[c].length-f-2)),e=b.states()[c].substr(0,f)}catch(h){console.error("Unable to parse JSON!")}return d&&e?a.current.name==e&&JSON.stringify(d)==JSON.stringify(a.params):a.current.name==b.states()[c]}}}}]);var app=angular.module("wecoApp");app.directive("tagEditor",["$timeout",function(a){return{restrict:"E",replace:"true",templateUrl:"/app/components/tag-editor/tag-editor.view.html",scope:{items:"=",title:"&",max:"&"},link:function(a,b,c){a.errorMessage="",a.data={},a.addItem=function(){if(a.errorMessage="",!(a.items.length>=a.max())&&a.data.item){if(/\s/g.test(a.data.item))return void(a.errorMessage="Cannot contain spaces.");a.data.item=a.data.item.toLowerCase(),a.items.indexOf(a.data.item)>-1||(a.items.push(a.data.item),a.data.item=void 0)}},a.removeItem=function(b){a.errorMessage="",a.items.indexOf(b)>-1&&a.items.splice(a.items.indexOf(b),1)}}}}]);var app=angular.module("wecoApp");app.controller("writeCommentController",["$scope","$timeout","Comment",function(a,b,c){a.isLoading=!1,a.comment={text:""},a.postComment=function(){b(function(){a.isLoading=!0}),a.comment.postid=a.postid(),a.comment.parentid=a.parentid(),a.update?c.update(a.comment.postid,a.comment.parentid,a.comment.text).then(function(){b(function(){a.isLoading=!1,a.comment={text:""},a.onSubmit(a.comment.id)})},function(c){console.log(c),b(function(){a.isLoading=!1})}):c.create(a.comment).then(function(c){b(function(){a.isLoading=!1,a.comment={text:""},a.onSubmit(c)})},function(c){console.log(c),b(function(){a.isLoading=!1})})},a.cancelComment=function(){b(function(){a.isLoading=!1,a.comment={text:""},a.onCancel()})}}]);var app=angular.module("wecoApp");app.directive("writeComment",function(){return{restrict:"E",replace:!0,scope:{parentid:"&",postid:"&",onSubmit:"=",onCancel:"=",update:"=",placeholder:"&"},templateUrl:"/app/components/write-comment/write-comment.view.html",controller:"writeCommentController"}}),angular.module("config",[]).constant("ENV",{name:"local",apiEndpoint:"http://localhost:8080/"});var api=angular.module("api",["ngResource"]);api.config(["$httpProvider",function(a){a.defaults.withCredentials=!0}]);var api=angular.module("api");api.factory("BranchPostsAPI",["$resource","ENV",function(a,b){function c(a,b){var c=[];for(var d in a)c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.join("&")}return a(b.apiEndpoint+"branch/:branchid/posts/:postid",{branchid:"@branchid",postid:""},{vote:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c}})}]);var api=angular.module("api");api.factory("BranchAPI",["$resource","ENV",function(a,b){function c(a,b){var c=[];for(var d in a)c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.join("&")}return a(b.apiEndpoint+"branch/:branchid",{},{update:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c}})}]);var api=angular.module("api");api.factory("CommentAPI",["$resource","ENV",function(a,b){function c(a,b){var c=[];for(var d in a)c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.join("&")}return a(b.apiEndpoint+"post/:postid/comments/:commentid",{postid:"@postid",commentid:""},{vote:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c},update:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c}})}]);var api=angular.module("api");api.factory("ModLogAPI",["$resource","ENV",function(a,b){return a(b.apiEndpoint+"branch/:branchid/modlog",{},{})}]);var api=angular.module("api");api.factory("ModsAPI",["$resource","ENV",function(a,b){return a(b.apiEndpoint+"branch/:branchid/mods/:username",{},{})}]);var api=angular.module("api");api.factory("PostAPI",["$resource","ENV",function(a,b){return a(b.apiEndpoint+"post/:postid",{},{})}]);var api=angular.module("api");api.factory("SubbranchRequestAPI",["$resource","ENV",function(a,b){function c(a,b){var c=[];for(var d in a)c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.join("&")}return a(b.apiEndpoint+"branch/:branchid/requests/subbranches/:childid",{branchid:"@branchid",childid:"@childid"},{getAll:{method:"GET",params:{childid:""},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c},accept:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c},reject:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c}})}]);var api=angular.module("api");api.factory("SubbranchesAPI",["$resource","ENV",function(a,b){return a(b.apiEndpoint+"branch/:branchid/subbranches",{branchid:"@branchid"},{})}]);var api=angular.module("api");api.factory("UserNotificationsAPI",["$resource","ENV",function(a,b){return a(b.apiEndpoint+"user/:username/notifications",{username:"@username"},{})}]);var api=angular.module("api");api.factory("UserAPI",["$resource","ENV",function(a,b){function c(a,b){var c=[];for(var d in a)c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.join("&")}return a(b.apiEndpoint+"user/:param",{param:"me"},{login:{method:"POST",params:{param:"login"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c},logout:{method:"GET",params:{param:"logout"}},signup:{method:"POST",params:{param:""}},update:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c}})}]);var app=angular.module("wecoApp");app.factory("Branch",["BranchAPI","SubbranchesAPI","ModLogAPI","SubbranchRequestAPI","BranchPostsAPI","$http","$state","ENV",function(a,b,c,d,e,f,g,h){var i={};return i.getPictureUrl=function(a,b,c){return"picture"!=b&&"cover"!=b&&(b="picture"),f({method:"GET",url:h.apiEndpoint+"branch/"+a+"/"+b+(c?"-thumb":"")})},i.get=function(b){return new Promise(function(c,d){a.get({branchid:b},function(a){return a&&a.data?void i.getPictureUrl(b,"picture",!1).then(function(c){return c&&c.data&&c.data.data&&(a.data.profileUrl=c.data.data),i.getPictureUrl(b,"picture",!0)},function(){return i.getPictureUrl(b,"picture",!0)}).then(function(c){return c&&c.data&&c.data.data&&(a.data.profileUrlThumb=c.data.data),i.getPictureUrl(b,"cover",!1)},function(){return i.getPictureUrl(b,"cover",!1)}).then(function(c){return c&&c.data&&c.data.data&&(a.data.coverUrl=c.data.data),i.getPictureUrl(b,"cover",!0)},function(){return i.getPictureUrl(b,"cover",!0)}).then(function(b){b&&b.data&&b.data.data&&(a.data.coverUrlThumb=b.data.data),c(a.data)},function(){c(a.data)}):d()},function(a){d({status:a.status,message:a.data.message})})})},i.update=function(b){return new Promise(function(c,d){a.update({branchid:g.params.branchid},b,function(){c()},function(a){d({status:a.status,message:a.data.message})})})},i.create=function(b){return new Promise(function(c,d){a.save(b,function(){c()},function(a){d({status:a.status,message:a.data.message})})})},i["delete"]=function(b){return new Promise(function(c,d){a["delete"]({branchid:b},function(){c()},function(a){d({status:a.status,message:a.data.message})})})},i.getSubbranches=function(a,c){return new Promise(function(d,e){b.get({branchid:a,timeafter:c},function(a){a&&a.data?d(a.data):e({status:500,message:"Something went wrong"})},function(a){e({status:a.status,message:a.data.message})})})},i.getModLog=function(a){return new Promise(function(b,d){c.get({branchid:a},function(a){a&&a.data?b(a.data):d({status:500,message:"Something went wrong"})},function(a){d({status:a.status,message:a.data.message})})})},i.submitSubbranchRequest=function(a,b){return new Promise(function(c,e){d.save({branchid:a,childid:b},function(){c()},function(a){e({status:a.status,message:a.data.message})})})},i.getSubbranchRequests=function(a){return new Promise(function(b,c){d.getAll({branchid:a},function(a){a&&a.data?b(a.data):c({status:500,message:"Something went wrong"})},function(a){c({status:a.status,message:a.data.message})})})},i.actionSubbranchRequest=function(a,b,c){return new Promise(function(e,f){function g(a){f({status:a.status,message:a.data.message})}if("accept"==a)d.accept({branchid:b,childid:c},{action:a},e,g);else{if("reject"!=a)return f({status:400,message:"Invalid action"});d.reject({branchid:b,childid:c},{action:a},e,g)}})},i.getPosts=function(a,b,c){return new Promise(function(d,f){e.get({branchid:a,timeafter:b,stat:c},function(a){a&&a.data?d(a.data):f({status:500,message:"Something went wrong"})},function(a){f({status:a.status,message:a.data.message})})})},i}]);var app=angular.module("wecoApp");app.factory("Comment",["CommentAPI","$http","$state","ENV",function(a,b,c,d){var e={};return e.create=function(b){return new Promise(function(c,d){a.save(b,function(a){c(a.data)},function(a){d({status:a.status,message:a.data.message})})})},e.getMany=function(b,c,d){return new Promise(function(e,f){a.get({postid:b,parentid:c,sort:d},function(a){return a&&a.data?void e(a.data):f()},function(a){f({status:a.status,message:a.data.message})})})},e.get=function(b,c){return new Promise(function(d,e){a.get({postid:b,commentid:c},function(a){return a&&a.data?void d(a.data):e()},function(a){e({status:a.status,message:a.data.message})})})},e.vote=function(b,c,d){return new Promise(function(e,f){return"up"!=d&&"down"!=d?f():void a.vote({postid:b,commentid:c},{vote:d},function(){e()},function(a){f({status:a.status,message:a.data.message})})})},e.update=function(b,c,d){return new Promise(function(e,f){a.update({postid:b,commentid:c},{text:d},function(){e()},function(a){f({status:a.status,message:a.data.message})})})},e}]);var app=angular.module("wecoApp");app.factory("Mod",["ModsAPI","$http","$state","ENV",function(a,b,c,d){var e={};return e.getByBranch=function(b){return new Promise(function(c,d){a.get({branchid:b}).$promise["catch"](function(a){d({status:a.status,message:a.data.message})}).then(function(a){a&&a.data?c(a.data):d({status:500,message:"Something went wrong"})})})},e.create=function(b,c){return new Promise(function(d,e){a.save({branchid:b},{username:c}).$promise["catch"](function(a){e({status:a.status,message:a.data.message})}).then(function(){d()})})},e["delete"]=function(b,c){return new Promise(function(d,e){a["delete"]({branchid:b,username:c}).$promise["catch"](function(a){e({status:a.status,message:a.data.message})}).then(function(){d()})})},e}]);var app=angular.module("wecoApp");app.factory("Post",["PostAPI","BranchPostsAPI","CommentAPI","$http","$state","ENV",function(a,b,c,d,e,f){var g={};return g.getPictureUrl=function(a,b){return d({method:"GET",url:f.apiEndpoint+"post/"+a+"/picture"+(b?"-thumb":"")})},g.create=function(b){return new Promise(function(c,d){a.save(b,function(a){c(a.data)},function(a){d({status:a.status,message:a.data.message})})})},g.get=function(b){return new Promise(function(c,d){a.get({postid:b},function(a){return a&&a.data?void g.getPictureUrl(b,!1).then(function(c){return c&&c.data&&c.data.data&&(a.data.profileUrl=c.data.data),g.getPictureUrl(b,!0)}).then(function(b){b&&b.data&&b.data.data&&(a.data.profileUrlThumb=b.data.data),c(a.data)},function(){c(a.data)}):d()},function(a){d({status:a.status,message:a.data.message})})})},g.vote=function(a,c,d){return new Promise(function(e,f){return"up"!=d&&"down"!=d?f():void b.vote({branchid:a,
postid:c},{vote:d},function(){e()},function(a){f({status:a.status,message:a.data.message})})})},g.getPostOnBranch=function(a,c){return new Promise(function(d,e){b.get({postid:a,branchid:c},function(a){return a&&a.data?void d(a.data):e()},function(a){e({status:a.status,message:a.data.message})})})},g}]);var app=angular.module("wecoApp");app.factory("User",["UserAPI","UserNotificationsAPI","$http","ENV",function(a,b,c,d){function e(a,b,e){return a||(a="me"),"picture"!=b&&"cover"!=b&&(b="picture"),c.get(d.apiEndpoint+"user/"+a+"/"+b+(e?"-thumb":""))}function f(){return new Promise(function(b,c){a.get().$promise["catch"](function(){return console.error("Unable to fetch user!"),c()}).then(function(a){return a&&a.data?void e("me","picture",!1).then(function(b){return b&&b.data&&b.data.data&&(a.data.profileUrl=b.data.data),e("me","picture",!0)},function(){return e("me","picture",!0)}).then(function(b){return b&&b.data&&b.data.data&&(a.data.profileUrlThumb=b.data.data),e("me","cover",!1)},function(){return e("me","cover",!1)}).then(function(b){return b&&b.data&&b.data.data&&(a.data.coverUrl=b.data.data),e("me","cover",!0)},function(){return e("me","cover",!0)}).then(function(c){c&&c.data&&c.data.data&&(a.data.coverUrlThumb=c.data.data),h.data=a.data,b()},function(){h.data=a.data,b()}):c()})})}var g={},h={};return f().then(function(){},function(){console.error("Unable to get user!")}),g.isAuthenticated=function(){return new Promise(function(b,c){a.get().$promise["catch"](function(){return console.error("Unable to fetch user!"),c()}).then(function(a){return a&&a.data?b(a.data):c()})})},g.me=function(){return h.data||{}},g.get=function(b){return new Promise(function(c,d){a.get({param:b}).$promise["catch"](function(a){d({status:a.status,message:a.data.message})}).then(function(a){return a&&a.data?void e(b,"picture",!1).then(function(c){return c&&c.data&&c.data.data&&(a.data.profileUrl=c.data.data),e(b,"picture",!0)},function(){return e(b,"picture",!0)}).then(function(c){return c&&c.data&&c.data.data&&(a.data.profileUrlThumb=c.data.data),e(b,"cover",!1)},function(){return e(b,"cover",!1)}).then(function(c){return c&&c.data&&c.data.data&&(a.data.coverUrl=c.data.data),e(b,"cover",!0)},function(){return e(b,"cover",!0)}).then(function(b){b&&b.data&&b.data.data&&(a.data.coverUrlThumb=b.data.data),c(a.data)},function(){c(a.data)}):d()})})},g.update=function(b){return new Promise(function(c,d){a.update(b).$promise["catch"](function(a){d({status:a.status,message:a.data.message})}).then(function(){c()})})},g.isLoggedIn=function(){return g.me().username||!1},g.login=function(b){return new Promise(function(c,d){a.login(b).$promise["catch"](function(a){d({status:a.status,message:a.data.message})}).then(function(){f().then(c,d)})})},g.logout=function(){return new Promise(function(b,c){a.logout().$promise["catch"](function(a){c({status:a.status,message:a.data.message})}).then(function(){h=a.get(),b()})})},g.signup=function(b){return new Promise(function(c,d){a.signup(b).$promise["catch"](function(a){d({status:a.status,message:a.data.message})}).then(function(){f().then(c,d)})})},g.getNotifications=function(a){return new Promise(function(c,d){b.get({username:a}).$promise["catch"](function(){return console.error("Unable to fetch user notifications!"),d()}).then(function(a){return a&&a.data?c(a.data):d()})})},g}]);var app=angular.module("wecoApp");app.controller("authController",["$scope","$state","User",function(a,b,c){function d(){c.login(a.credentials).then(function(){a.isLoading=!1,b.go("weco.home")},function(b){a.errorMessage=b.message,a.isLoading=!1})}function e(){c.signup(a.credentials).then(function(){a.isLoading=!1,b.go("weco.home")},function(b){a.errorMessage=b.message,a.isLoading=!1})}a.credentials={},a.user=c.me,a.isLoading=!1,a.errorMessage="",a.isLoginForm=function(){return"auth.login"==b.current.name},a.submit=function(){a.isLoading=!0,a.credentials.username=a.credentials.username.toLowerCase(),a.isLoginForm()?d():e()}}]);var app=angular.module("wecoApp");app.controller("branchController",["$scope","$rootScope","$state","$timeout","Branch","Mod","User","Modal",function(a,b,c,d,e,f,g,h){function i(){h.open("/app/components/modals/branch/create/create-branch.modal.view.html",{branchid:a.branchid}).then(function(a){a&&(h.getOutputArgs()&&h.getOutputArgs().branchid?c.go("weco.branch.subbranches",{branchid:h.getOutputArgs().branchid},{reload:!0}):c.go(c.current,{},{reload:!0}))},function(){console.log("error")})}function j(){h.open("/app/components/modals/post/create/create-post.modal.view.html",{branchid:a.branchid}).then(function(a){a&&(h.getOutputArgs()&&h.getOutputArgs().branchid?c.go("weco.branch.wall",{branchid:h.getOutputArgs().branchid},{reload:!0}):c.go(c.current,{},{reload:!0}))},function(){console.log("error")})}a.branchid=c.params.branchid,a.isLoading=!0,a.timeItems=["ALL TIME","THIS YEAR","THIS MONTH","THIS WEEK","LAST 24 HRS","THIS HOUR"],a.getTimeafter=function(a){var b,c=new Date;switch(a){case"ALL TIME":b=0;break;case"THIS YEAR":b=new Date(c.getFullYear(),0,1,0,0,0,0).getTime();break;case"THIS MONTH":b=new Date(c.getFullYear(),c.getMonth(),1,0,0,0,0).getTime();break;case"THIS WEEK":b=new Date(c.getFullYear(),c.getMonth(),c.getDate()-c.getDay()+1,0,0,0,0).getTime();break;case"LAST 24 HRS":var d=new Date(c);d.setDate(c.getDate()-1),b=new Date(c.getFullYear(),c.getMonth(),d.getDate(),c.getHours(),0,0,0).getTime();break;case"THIS HOUR":b=new Date(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours(),0,0,0).getTime()}return b},a.isControlSelected=function(a){return c.current.name.indexOf(a)>-1},a.branch={},a.parent={},e.get(c.params.branchid).then(function(b){return d(function(){a.branch=b}),f.getByBranch(a.branchid)},function(a){404==a.status&&c.go("weco.notfound")}).then(function(b){return d(function(){a.branch.mods=b,a.isLoading=!1}),e.get(a.branch.parentid)}).then(function(b){d(function(){a.parent=b})},function(b){a.isLoading=!1}),a.openProfilePictureModal=function(){h.open("/app/components/modals/upload/upload-image.modal.view.html",{route:"branch/"+a.branchid+"/",type:"picture"}).then(function(a){a&&c.go(c.current,{},{reload:!0})},function(){console.log("error")})},a.openCoverPictureModal=function(){h.open("/app/components/modals/upload/upload-image.modal.view.html",{route:"branch/"+a.branchid+"/",type:"cover"}).then(function(a){a&&c.go(c.current,{},{reload:!0})},function(){console.log("error")})},a.addContent=function(){switch(c.current.name){case"weco.branch.subbranches":i();break;case"weco.branch.wall":"root"!=a.branchid&&j();break;case"weco.branch.post":b.$broadcast("add-comment");break;default:console.error("Unable to add content in state "+c.current.name)}},a.isModerator=function(){if(!a.branch.mods)return!1;for(var b=0;b<a.branch.mods.length;b++)if(a.branch.mods[b].username==g.me().username)return!0;return!1}}]);var app=angular.module("wecoApp");app.controller("nucleusModeratorsController",["$scope","$state","$timeout","User","Branch",function(a,b,c,d,e){a.mods=[],a.isLoading=!0,a.getMod=function(b,e){var f=d.get(b);return f.then(function(b){c(function(){a.mods[e]=b})},function(){console.error("Unable to get mod!")}),f};for(var f=[],g=0;g<a.branch.mods.length;g++)f.push(a.getMod(a.branch.mods[g].username,g));Promise.all(f).then(function(){a.isLoading=!1},function(){console.error("Unable to fetch mods!"),a.isLoading=!1})}]);var app=angular.module("wecoApp");app.controller("nucleusModToolsController",["$scope","$state","$timeout","Modal","User","Branch",function(a,b,c,d,e,f){a.isLoading=!0,a.isModLogOpen=!1,a.toggleIsModLogOpen=function(){a.isModLogOpen=!a.isModLogOpen},a.modLog=[],f.getModLog(a.branchid).then(function(b){c(function(){a.modLog=b,a.isLoading=!1})},function(){console.error("Unable to fetch mod log."),a.isLoading=!1}),a.openAddModModal=function(){d.open("/app/components/modals/branch/nucleus/modtools/add-mod/add-mod.modal.view.html",{branchid:a.branchid}).then(function(a){a&&b.go(b.current,{},{reload:!0})},function(){console.error("Error updating moderator settings")})},a.openRemoveModModal=function(){for(var c,f=0;f<a.branch.mods.length;f++)a.branch.mods[f].username==e.me().username&&(c=a.branch.mods[f]);for(var g=[],f=0;f<a.branch.mods.length;f++)a.branch.mods[f].date>c.date&&a.branch.mods[f].username!==c.username&&g.push(a.branch.mods[f]);d.open("/app/components/modals/branch/nucleus/modtools/remove-mod/remove-mod.modal.view.html",{branchid:a.branchid,mods:g}).then(function(a){a&&b.go(b.current,{},{reload:!0})},function(){console.error("Error updating moderator settings")})},a.openSubmitSubbranchRequestModal=function(){d.open("/app/components/modals/branch/nucleus/modtools/submit-subbranch-request/submit-subbranch-request.modal.view.html",{branchid:a.branchid}).then(function(a){a&&b.go(b.current,{},{reload:!0})},function(){console.error("Error submitting subbranch request")})},a.openReviewSubbranchRequestsModal=function(){d.open("/app/components/modals/branch/nucleus/modtools/review-subbranch-requests/review-subbranch-requests.modal.view.html",{branchid:a.branchid}).then(function(a){a&&b.go(b.current,{},{reload:!0})},function(){console.error("Error responding to subbranch request")})},a.openDeleteBranchModal=function(){d.open("/app/components/modals/branch/nucleus/modtools/delete-branch/delete-branch.modal.view.html",{}).then(function(a){a&&b.go(b.current,{},{reload:!0})},function(){console.error("Error deleting branch")})}}]);var app=angular.module("wecoApp");app.controller("nucleusController",["$scope","$state","$timeout","Branch","User",function(a,b,c,d,e){a.tabItems=["about","moderators"],a.tabStates=['weco.branch.nucleus.about({ "branchid": "'+a.branchid+'"})','weco.branch.nucleus.moderators({ "branchid": "'+a.branchid+'"})'],a.$watch(a.isModerator,function(){if(a.branch.mods)for(var b=0;b<a.branch.mods.length;b++)a.branch.mods[b].username==e.me().username&&(a.tabItems.indexOf("settings")==-1&&(a.tabItems.push("settings"),a.tabStates.push('weco.branch.nucleus.settings({ "branchid": "'+a.branchid+'"})')),a.tabItems.indexOf("mod tools")==-1&&(a.tabItems.push("mod tools"),a.tabStates.push('weco.branch.nucleus.modtools({ "branchid": "'+a.branchid+'"})')))}),a.addHTMLLineBreaks=function(a){if(a)return a.split("\n").join("<br>")}}]);var app=angular.module("wecoApp");app.controller("nucleusSettingsController",["$scope","$state","$timeout","Modal",function(a,b,c,d){function e(a){d.open("/app/components/modals/branch/nucleus/settings/settings.modal.view.html",a).then(function(a){a&&b.go(b.current,{},{reload:!0})},function(){console.error("Error updating branch settings")})}a.openVisibleNameModal=function(){e({title:"Visible Name",inputs:[{placeholder:"Visible name",type:"text",fieldname:"name"}],textareas:[]})},a.openRulesModal=function(){e({title:"Rules & Etiquette",inputs:[],textareas:[{placeholder:"Rules & Etiquette Text",fieldname:"rules"}]})},a.openDescriptionModal=function(){e({title:"Description",inputs:[],textareas:[{placeholder:"Description",fieldname:"description"}]})}}]);var app=angular.module("wecoApp");app.controller("postController",["$scope","$rootScope","$state","$timeout","Post","Comment",function(a,b,c,d,e,f){function g(a){if(a&&""!==a){var b=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=|\?v=)([^#\&\?]*).*/,c=a.match(b);if(c&&11==c[2].length)return!0}return!1}function h(b,e){var g=b.shift();g&&f.get(c.params.postid,a.comments[e].id).then(function(c){c&&d(function(){a.comments[e].data=c.data,a.comments[e].isLoading=!1}),h(b,e+1)})["catch"](function(){h(b,e+1)})}function i(){if(a.isCommentPermalink())f.get(c.params.postid,c.params.commentid).then(function(b){d(function(){a.comments=[b],a.isLoadingComments=!1;for(var c=0;c<a.comments.length;c++)a.comments[c].isLoading=!0;h(a.comments.slice(),0)})},function(){console.error("Unable to get comments!"),a.isLoadingComments=!1});else{var b=a.sortItems[a.selectedSortItemIdx].toLowerCase();f.getMany(c.params.postid,void 0,b).then(function(b){d(function(){a.comments=b,a.isLoadingComments=!1;for(var c=0;c<a.comments.length;c++)a.comments[c].isLoading=!0;h(a.comments.slice(),0)})},function(){console.error("Unable to get comments!"),a.isLoadingComments=!1})}}a.isLoadingPost=!0,a.isLoadingComments=!0,a.post={},a.comments=[],a.markdownRaw="",a.videoEmbedURL="",a.previewState="show",a.sortItems=["POINTS","REPLIES","DATE"],a.selectedSortItemIdx=0,a.selectedSortItemIdx=0,a.$watch("selectedSortItemIdx",function(){i()}),a.onSubmitComment=function(){i()},a.isCommentPermalink=function(){return"weco.branch.post.comment"==c.current.name},a.setPreviewState=function(b){a.previewState=b},a.vote=function(a,b){e.vote("root",a.id,b).then(function(){var c="up"==b?1:-1;d(function(){a.individual+=c,a.local+=c,a.global+=c})},function(a){console.error("Unable to vote on post!")})},e.getPostOnBranch(c.params.postid,a.branchid).then(function(){return e.get(c.params.postid)},function(){c.go("weco.notfound")}).then(function(b){d(function(){if(a.post=b,a.markdownRaw=b.data.text,a.isLoadingPost=!1,"video"==a.post.type&&g(a.post.data.text)){var c=a.post.data.text.split("v=")[1]||a.post.data.text.split("embed/")[1];c.indexOf("&")!=-1&&(c=c.substring(0,c.indexOf("&"))),a.videoEmbedURL="//www.youtube.com/embed/"+c+"?rel=0"}})},function(b){404==b.status&&c.go("weco.notfound"),a.isLoadingPost=!1}),b.$on("$stateChangeSuccess",function(a,b,c,d,e,f){i()})}]);var app=angular.module("wecoApp");app.controller("subbranchesController",["$scope","$state","$timeout","Branch",function(a,b,c,d){function e(b,f){var g=b.shift();g&&d.getPictureUrl(a.branches[f].id,"picture",!1).then(function(b){return b&&b.data&&b.data.data&&c(function(){a.branches[f].profileUrl=b.data.data}),d.getPictureUrl(a.branches[f].id,"picture",!0)}).then(function(d){d&&d.data&&d.data.data&&c(function(){a.branches[f].profileUrlThumb=d.data.data}),e(b,f+1)})["catch"](function(){e(b,f+1)})}function f(){var b=a.getTimeafter(a.timeItems[a.selectedTimeItemIdx]);d.getSubbranches(a.branchid,b).then(function(b){c(function(){a.branches=b,a.isLoading=!1,e(a.branches.slice(),0)})},function(){console.error("Unable to get branches!"),a.isLoading=!1})}a.isLoading=!0,a.branches=[],a.selectedTimeItemIdx=0,a.$watch("selectedTimeItemIdx",function(){f()})}]);var app=angular.module("wecoApp");app.controller("wallController",["$scope","$state","$timeout","Branch","Post",function(a,b,c,d,e){function f(b,d){var g=b.shift();g&&e.get(a.posts[d].id).then(function(e){e&&c(function(){var b=a.posts[d].global;a.posts[d]=e,a.posts[d].global=b,a.posts[d].isLoading=!1}),f(b,d+1)})["catch"](function(){f(b,d+1)})}function g(){var b=a.getTimeafter(a.timeItems[a.selectedTimeItemIdx]);d.getPosts(a.branchid,b,a.stat).then(function(b){c(function(){a.posts=b,a.isLoading=!1;for(var c=0;c<a.posts.length;c++)a.posts[c].isLoading=!0;f(a.posts.slice(),0)})},function(){console.error("Unable to get posts!"),a.isLoading=!1})}a.isLoading=!1,a.posts=[],a.stat="global",a.vote=function(b,d){e.vote(a.branchid,b.id,d).then(function(){var a="up"==d?1:-1;c(function(){b.individual+=a,b.local+=a,b.global+=a})},function(a){console.error("Unable to vote on post!")})},a.setStat=function(b){a.isLoading=!0,a.stat=b,g()},a.getLink=function(a){return"text"==a.type?b.href("weco.branch.post",{postid:a.id}):a.text},a.selectedTimeItemIdx=0,a.$watch("selectedTimeItemIdx",function(){g()}),a.postTypeItems=["ALL","TEXT","IMAGE","VIDEO","AUDIO","PAGE"],a.selectedPostTypeItemIdx=0}]);var app=angular.module("wecoApp");app.controller("profileNotificationsController",["$scope","$state","$timeout","User",function(a,b,c,d){function e(){a.isLoading=!0,d.getNotifications(b.params.username).then(function(b){c(function(){a.notifications=b,a.isLoading=!1,console.log(b)})},function(){console.error("Unable to fetch notifications")})}a.isLoading=!1,a.notifications=[],e()}]);var app=angular.module("wecoApp");app.controller("profileController",["$scope","$timeout","$state","User","Modal",function(a,b,c,d,e){a.user={},a.isLoading=!0,d.get(c.params.username).then(function(c){b(function(){a.user=c,a.isLoading=!1})},function(b){404==b.status&&c.go("weco.notfound"),a.isLoading=!1}),a.tabItems=["about","timeline"],a.tabStates=["weco.profile.about","weco.profile.timeline"],a.$watch(function(){return d.me().username},function(b){b==c.params.username&&(a.tabItems.indexOf("settings")==-1&&a.tabStates.indexOf("weco.profile.settings")==-1&&(a.tabItems.push("settings"),a.tabStates.push("weco.profile.settings")),a.tabItems.indexOf("notifications")==-1&&a.tabStates.indexOf("weco.profile.notifications")==-1&&(a.tabItems.push("notifications"),a.tabStates.push("weco.profile.notifications")))}),a.openProfilePictureModal=function(){e.open("/app/components/modals/upload/upload-image.modal.view.html",{route:"user/me/",type:"picture"}).then(function(a){a&&c.go(c.current,{},{reload:!0})},function(){console.log("error")})},a.openCoverPictureModal=function(){e.open("/app/components/modals/upload/upload-image.modal.view.html",{route:"user/me/",type:"cover"}).then(function(a){a&&c.go(c.current,{},{reload:!0})},function(){console.log("error")})},a.isMyProfile=function(){return d.me().username==c.params.username}}]);var app=angular.module("wecoApp");app.controller("profileSettingsController",["$scope","$state","Modal",function(a,b,c){function d(a){c.open("/app/components/modals/profile/settings/settings.modal.view.html",a).then(function(a){a&&b.go(b.current,{},{reload:!0})},function(){console.error("Error updating profile settings")})}a.openNameModal=function(){d({title:"Name",inputs:[{placeholder:"First name",type:"text",fieldname:"firstname"},{placeholder:"Last name",type:"text",fieldname:"lastname"}]})},a.openEmailModal=function(){d({title:"Email",inputs:[{placeholder:"Email",type:"email",fieldname:"email"}]})},a.openDOBModal=function(){d({title:"Date of Birth",inputs:[{placeholder:"Date of Birth",type:"date",fieldname:"dob"}]})}}]);
"use strict";function getLogActionVerb(a){return"addmod"==a?"added":"removemod"==a?"removed":""}function getTemplate(a){var b="<div class=\"time\">{{ entry.date | date: 'dd MMMM yyyy HH:mm' }}</div>";switch(a.action){case"removemod":case"addmod":return b+'<div class="entry"><a ui-sref="weco.profile.about({ username: entry.username })">{{ entry.username }}</a> '+getLogActionVerb(a.action)+' <a ui-sref="weco.profile.about({ username: entry.data })">{{ entry.data }}</a> as a moderator.</div>';case"make-subbranch-request":return b+'<div class="entry"><a ui-sref="weco.profile.about({ username: entry.username })">{{ entry.username }}</a> made a Child Branch Request to <a ui-sref="weco.branch.nucleus.about({ branchid: entry.data })">{{ entry.data }}</a>.</div>';case"answer-subbranch-request":var c=JSON.parse(a.data);return b+'<div class="entry"><a ui-sref="weco.profile.about({ username: entry.username })">{{ entry.username }}</a> '+c.response+"ed a Child Branch Request to <a ui-sref=\"weco.branch.nucleus.about({ branchid: '"+c.parentid+"' })\">"+c.parentid+"</a> made by <a ui-sref=\"weco.profile.about({ username: '"+c.childmod+"' })\">"+c.childmod+"</a> from <a ui-sref=\"weco.branch.nucleus.about({ branchid: '"+c.childid+"' })\">"+c.childid+"</a>.</div>";default:return""}}var app=angular.module("wecoApp",["config","ui.router","ngAnimate","ngSanitize","ngFileUpload","hc.marked","api"]);app.constant("NotificationTypes",{NEW_CHILD_BRANCH_REQUEST:0,CHILD_BRANCH_REQUEST_ANSWERED:1,BRANCH_MOVED:2,MODERATOR:3,COMMENT:4}),app.config(["markedProvider",function(a){a.setOptions({gfm:!0,sanitize:!0})}]),app.config(function($sceDelegateProvider){$sceDelegateProvider.resourceUrlWhitelist(["self","*://www.youtube.com/**"])}),app.filter("reverse",function(){return function(a){return!!angular.isArray(a)&&(!!a&&a.slice().reverse())}}),app.config(function($stateProvider,$urlRouterProvider,$locationProvider){$locationProvider.html5Mode(!0),$urlRouterProvider.otherwise("/"),$urlRouterProvider.rule(function($injector,$location){var a=$location.path(),b="/"===a[a.length-1];if(b){var c=a.substr(0,a.length-1);return c}}),$stateProvider.state("auth",{"abstract":!0,templateUrl:"/app/pages/auth/auth.view.html",controller:"authController"}).state("auth.login",{url:"/login"}).state("auth.signup",{url:"/signup"}).state("weco",{"abstract":!0,resolve:{authenticate:function(){console.log("This code is ran before any state is reached...")}},template:'<nav-bar></nav-bar><div class="full-page" ui-view></div>'}).state("weco.notfound",{templateUrl:"/app/pages/notfound/notfound.view.html"}).state("weco.home",{url:"/",templateUrl:"/app/pages/home/home.view.html"}).state("weco.profile",{url:"/u/:username","abstract":!0,templateUrl:"/app/pages/profile/profile.view.html",controller:"profileController"}).state("weco.profile.about",{url:"/about",templateUrl:"/app/pages/profile/about/about.view.html"}).state("weco.profile.timeline",{url:"/timeline",templateUrl:"/app/pages/profile/timeline/timeline.view.html"}).state("weco.profile.settings",{url:"/settings",templateUrl:"/app/pages/profile/settings/settings.view.html",selfOnly:!0,redirectTo:"auth.login"}).state("weco.profile.notifications",{url:"/notifications",templateUrl:"/app/pages/profile/notifications/notifications.view.html",selfOnly:!0,redirectTo:"auth.login"}).state("weco.branch",{url:"/b/:branchid","abstract":!0,templateUrl:"/app/pages/branch/branch.view.html",controller:"branchController"}).state("weco.branch.nucleus",{url:"/nucleus","abstract":!0,templateUrl:"/app/pages/branch/nucleus/nucleus.view.html",controller:"nucleusController"}).state("weco.branch.nucleus.about",{url:"/about",templateUrl:"/app/pages/branch/nucleus/about/about.view.html"}).state("weco.branch.nucleus.settings",{url:"/settings",templateUrl:"/app/pages/branch/nucleus/settings/settings.view.html",controller:"nucleusSettingsController",modOnly:!0,redirectTo:"auth.login"}).state("weco.branch.nucleus.moderators",{url:"/moderators",templateUrl:"/app/pages/branch/nucleus/moderators/moderators.view.html",controller:"nucleusModeratorsController"}).state("weco.branch.nucleus.modtools",{url:"/modtools",templateUrl:"/app/pages/branch/nucleus/modtools/modtools.view.html",controller:"nucleusModToolsController",modOnly:!0,redirectTo:"auth.login"}).state("weco.branch.subbranches",{url:"/subbranches",templateUrl:"/app/pages/branch/subbranches/subbranches.view.html",controller:"subbranchesController"}).state("weco.branch.wall",{url:"/wall",templateUrl:"/app/pages/branch/wall/wall.view.html",controller:"wallController"}).state("weco.branch.post",{url:"/p/:postid",templateUrl:"/app/pages/branch/post/post.view.html",controller:"postController"}).state("weco.branch.post.comment",{url:"/c/:commentid"}),$urlRouterProvider.when("/u/{username}","/u/{username}/about"),$urlRouterProvider.when("/b/{branchid}","/b/{branchid}/wall"),$urlRouterProvider.otherwise(function($injector,$location){var a=$injector.get("$state");return a.go("weco.notfound"),$location.path()})}),app.run(["$rootScope","$state","User","Mod","socket",function(a,b,c,d,e){a.tooltip={},e.on("on_connect","notifications",function(a){console.log("Connection established"),c.get().then(function(b){if(!b.username)throw"Not Authenticated";return c.subscribeToNotifications(b.username,a.id)}).then(function(){console.log("Successfully subscribed to notifications")})["catch"](function(a){console.error("Error subscribing to notifications: ",a)})}),e.on("on_disconnect","notifications",function(a){console.log("Disconnected"),c.me().username?c.unsubscribeFromNotifications(c.me().username,a.id).then(function(){console.log("Successfully unsubscribed from notifications")},function(a){console.error("Error unsubscribing to notifications: ",a)}):console.error("Error unsubscribing to notifications: Not Authenticated")}),a.$on("$stateChangeStart",function(a,e,f,g,h){function i(a){d.getByBranch(f.branchid).then(function(b){k=b,a()},a)}function j(){c.get().then(function(c){if(!e.selfOnly||0!==Object.keys(c).length&&f.username==c.username||(console.log(Object.keys(c).length),b.transitionTo(e.redirectTo),a.preventDefault()),e.modOnly){for(var d=!1,g=0;g<k.length;g++)k[g].username==c.username&&(d=!0);d||(b.transitionTo(e.redirectTo),a.preventDefault())}},function(c){c&&(console.error("Unable to fetch self: ",c),b.transitionTo(e.redirectTo),a.preventDefault())})}var k=[];e.modOnly?i(j):e.selfOnly&&j()})}]),app.factory("socket",["$rootScope","ENV",function(a,b){var c={},d={},e=[];return c.reconnect=function(){console.log("Reconnecting"),d={notifications:io.connect(b.apiEndpoint+"notifications",{forceNew:!0}),messages:io.connect(b.apiEndpoint+"messages",{forceNew:!0})};for(var a=0;a<e.length;a++)d[e[a].namespace].on(e[a].event,e[a].cb)},c.disconnect=function(){console.log("Disconnecting");for(var a in d)d[a].io.disconnect()},c.on=function(a,b,c){e.push({event:a,namespace:b,cb:c}),d[b].on(a,c)},c.reconnect(),c}]),app.controller("rootController",["$scope","$state","ENV",function(a,b,c){a.socketioURL=c+"socket.io/socket.io.js",a.hasNavBar=function(){return!(b.current.name.indexOf("auth")>-1)}}]);var app=angular.module("wecoApp");app.directive("alerts",["$timeout","Alerts",function(a,b){return{restrict:"E",replace:!0,scope:{},templateUrl:"/app/components/alerts/alerts.view.html",link:function(a){a.alerts=b.get,a.close=b.close}}}]);var app=angular.module("wecoApp");app.factory("Alerts",["$timeout",function(a){function b(){e=e.filter(function(a){return a.alive===!0})}function c(c){c.alive=!1,a(function(){b()},600)}var d={},e=[],f=5e3;return d.get=function(){return e},d.push=function(b,d){var g={type:b,text:d,alive:!0};e=[g].concat(e),a(function(){c(g)},f)},d.close=function(a){c(e[a])},d}]);var app=angular.module("wecoApp");app.directive("commentThread",["$state","Comment","User","$timeout","Alerts",function(a,b,c,d,e){return{restrict:"E",replace:!1,scope:{comments:"=",sortBy:"="},templateUrl:"/app/components/comment-thread/comment-thread.view.html",link:function(f){function g(a,c,e){var f=c.shift();f&&b.get(a.postid,a.comments[e].id).then(function(b){b&&d(function(){a.comments[e].data=b.data,a.comments[e].isLoading=!1}),g(a,c,e+1)})["catch"](function(){g(a,c,e+1)})}function h(a){b.getMany(a.postid,a.id,f.sortBy.toLowerCase()).then(function(b){d(function(){a.comments=b;for(var c=0;c<a.comments.length;c++)a.comments[c].isLoading=!0;g(a,b.slice(),0)})},function(){e.push("error","Unable to get replies!")})}f.user=c.me(),f.openComment=void 0,f.openReply=function(a,b){d(function(){f.openComment&&(f.openComment.openReply=!1),f.openComment=a,f.openComment.openReply=!0,f.openComment.update=b})},f.closeReply=function(){d(function(){f.openComment.openReply=!1,f.openComment=void 0})},f.onCancelComment=function(){f.closeReply()},f.onSubmitComment=function(){f.openComment.update?(d(function(){f.openComment.isLoading=!0}),b.get(f.openComment.postid,f.openComment.id).then(function(a){d(function(){f.openComment.data=a,f.openComment.isLoading=!1,f.closeReply()})},function(){e.push("error","Unable to reload comment!"),f.closeReply()})):(f.loadMore(f.openComment),f.closeReply())},f.timeSince=function(a){var b=6e4,c=60*b,d=24*c,e=30*d,f=365*d,g=(new Date).getTime()-new Date(a);return g<b?Math.round(g/1e3)+" seconds ago":g<c?Math.round(g/b)+" minutes ago":g<d?Math.round(g/c)+" hours ago":g<e?Math.round(g/d)+" days ago":g<f?Math.round(g/e)+" months ago":Math.round(g/f)+" years ago"},f.loadMore=function(a){h(a)},f.vote=function(a,c){b.vote(a.postid,a.id,c).then(function(){var b="up"==c?1:-1;d(function(){a.individual+=b})},function(a){e.push("error","Unable to vote on comment!")})},f.isOwnComment=function(a){return!(!c.me()||!a.data)&&c.me().username==a.data.creator},f.openCommentPermalink=function(b){a.go("weco.branch.post.comment",{postid:b.postid,commentid:b.id},{reload:!0})}}}}]);var app=angular.module("wecoApp");app.directive("dropdown",["$timeout",function(a){return{restrict:"E",replace:"true",templateUrl:"/app/components/dropdown/dropdown.view.html",scope:{title:"&",items:"=",selected:"="},link:function(b,c,d){b.isOpen=!1,b.open=function(){a(function(){b.isOpen=!0})},b.close=function(){a(function(){b.isOpen=!1})},b.select=function(c){a(function(){b.selected=c,b.close()})}}}}]);var app=angular.module("wecoApp");app.directive("loading",["$compile",function(a){return{restrict:"A",templateUrl:"/app/components/loading/loading.view.html",scope:{when:"&"},replace:!1,transclude:!0,link:function(a,b,c,d,e){e(a.$parent,function(a,c){b.append(a)})}}}]);var app=angular.module("wecoApp");app.directive("modLogEntry",["$compile",function(a){var b=function(b,c,d){c.html(getTemplate(b.entry)),a(c.contents())(b)};return{restrict:"A",replace:!1,link:b,scope:{entry:"="}}}]);var app=angular.module("wecoApp");app.controller("modalCreateBranchController",["$scope","$timeout","Modal","Branch",function(a,b,c,d){a.newBranch={parentid:c.getInputArgs().branchid},a.errorMessage="",a.$on("OK",function(){return a.newBranch&&a.newBranch.id&&a.newBranch.name?(a.isLoading=!0,a.newBranch.id=a.newBranch.id.toLowerCase(),void d.create(a.newBranch).then(function(){b(function(){var b=a.newBranch.id;a.newBranch={},a.errorMessage="",a.isLoading=!1,c.OK({branchid:b})})},function(c){b(function(){a.errorMessage=c.message,a.isLoading=!1})})):void b(function(){a.errorMessage="Please fill in all fields"})}),a.$on("Cancel",function(){b(function(){a.newBranch={},a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalNucleusAddModController",["$scope","$timeout","Modal","Mod",function(a,b,c,d){a.Modal=c,a.errorMessage="",a.isLoading=!1,a.data={},a.$on("OK",function(){a.isLoading=!0;var e=c.getInputArgs().branchid;d.create(e,a.data.username).then(function(){b(function(){a.data={},a.errorMessage="",a.isLoading=!1,c.OK()})},function(c){b(function(){a.data={},a.errorMessage=c.message,404==c.status&&(a.errorMessage="That user doesn't exist"),a.isLoading=!1})})}),a.$on("Cancel",function(){b(function(){a.data={},a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalNucleusDeleteBranchController",["$scope","$timeout","Modal","Branch",function(a,b,c,d){a.Modal=c,a.errorMessage="",a.isLoading=!1,a.data={},a.$on("OK",function(){return a.data&&a.data.branchid?(a.isLoading=!0,void d["delete"](a.data.branchid).then(function(){b(function(){a.data={},a.errorMessage="",a.isLoading=!1,c.OK()})},function(c){b(function(){a.errorMessage=c.message,a.isLoading=!1})})):void b(function(){a.errorMessage="Please fill in all fields"})}),a.$on("Cancel",function(){b(function(){a.data={},a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalNucleusRemoveModController",["$scope","$timeout","Modal","Branch","User","Mod",function(a,b,c,d,e,f){function g(c,d){var f=e.get(c);return f.then(function(c){b(function(){a.mods[d]=c})},function(){a.errorMessage="Unable to get mod!"}),f}a.Modal=c,a.errorMessage="",a.isLoading=!0,a.mods=[],a.selectedMod={};for(var h=[],i=0;i<c.getInputArgs().mods.length;i++)h.push(g(c.getInputArgs().mods[i].username,i));Promise.all(h).then(function(){a.isLoading=!1}),a.select=function(b){a.selectedMod=b},a.$on("OK",function(){a.isLoading=!0;var d=c.getInputArgs().branchid;f["delete"](d,a.selectedMod.username).then(function(){b(function(){c.OK(),a.selectedMod={},a.errorMessage="",a.isLoading=!1})},function(c){b(function(){a.errorMessage=c.message,404==c.status&&(a.errorMessage="That user doesn't exist"),a.isLoading=!1})})}),a.$on("Cancel",function(){b(function(){c.Cancel(),a.selectedMod={},a.errorMessage="",a.isLoading=!1})})}]);var app=angular.module("wecoApp");app.controller("modalNucleusReviewSubbranchRequestsController",["$scope","$timeout","Modal","Branch",function(a,b,c,d){a.Modal=c,a.errorMessage="",a.requests=[],a.isLoading=!0,d.getSubbranchRequests(c.getInputArgs().branchid).then(function(c){function e(b,e){var f=d.get(b);return f.then(function(a){c[e].branch=a},function(){a.errorMessage="Unable to get branch!"}),f}for(var f=[],g=0;g<c.length;g++)f.push(e(c[g].childid,g));Promise.all(f).then(function(){b(function(){a.requests=c,a.isLoading=!1})},function(){b(function(){a.errorMessage="Unable to fetch child branch requests!",a.isLoading=!1})})},function(){a.errorMessage="Unable to fetch child branch requests!"}),a.action=function(c,e){a.isLoading=!0,d.actionSubbranchRequest(e,a.requests[c].parentid,a.requests[c].childid).then(function(){b(function(){a.requests.splice(c,1),a.errorMessage="",a.isLoading=!1})},function(c){b(function(){a.errorMessage=c.message,404==c.status&&(a.errorMessage="That user doesn't exist"),a.isLoading=!1})})},a.$on("OK",function(){b(function(){a.errorMessage="",a.isLoading=!1,c.OK()})}),a.$on("Cancel",function(){b(function(){a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalNucleusSubmitSubbranchRequestController",["$scope","$timeout","Modal","Branch",function(a,b,c,d){a.Modal=c,a.errorMessage="",a.isLoading=!1,a.data={},a.$on("OK",function(){if(!a.data||!a.data.parentid)return void b(function(){a.errorMessage="Please fill in all fields"});a.isLoading=!0;var e=c.getInputArgs().branchid;d.submitSubbranchRequest(a.data.parentid,e).then(function(){b(function(){a.data={},a.errorMessage="",a.isLoading=!1,c.OK()})},function(c){b(function(){a.errorMessage=c.message,a.isLoading=!1})})}),a.$on("Cancel",function(){b(function(){a.data={},a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalNucleusSettingsController",["$scope","$timeout","Modal","Branch",function(a,b,c,d){a.Modal=c,a.inputValues=[],a.textareaValues=[],a.errorMessage="",a.isLoading=!1,a.$on("OK",function(){if(a.inputValues.length<c.getInputArgs().inputs.length||a.inputValues.indexOf("")>-1||a.textareaValues.length<c.getInputArgs().textareas.length||a.textareaValues.indexOf("")>-1)return void b(function(){a.errorMessage="Please fill in all fields"});for(var e={},f=0;f<c.getInputArgs().inputs.length;f++)e[c.getInputArgs().inputs[f].fieldname]=a.inputValues[f],"date"==c.getInputArgs().inputs[f].type&&(e[c.getInputArgs().inputs[f].fieldname]=new Date(a.inputValues[f]).getTime());for(var f=0;f<c.getInputArgs().textareas.length;f++)e[c.getInputArgs().textareas[f].fieldname]=a.textareaValues[f];a.isLoading=!0,d.update(e).then(function(){b(function(){a.inputValues=[],a.textareaValues=[],a.errorMessage="",a.isLoading=!1,c.OK()})},function(c){b(function(){a.errorMessage=c.message,a.isLoading=!1})})}),a.$on("Cancel",function(){b(function(){a.inputValues=[],a.textareaValues=[],a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.directive("modal",["Modal",function(a){return{restrict:"A",replace:!1,scope:{},templateUrl:"/app/components/modals/modal.view.html",link:function(b,c,d){b.getTemplateUrl=a.templateUrl,b.isOpen=a.isOpen,b.OK=function(){b.$broadcast("OK")},b.Cancel=function(){b.$broadcast("Cancel")}}}}]);var app=angular.module("wecoApp");app.factory("Modal",["$timeout",function(a){var b={},c="";b.templateUrl=function(){return c};var d=!1;b.isOpen=function(){return d};var e={};b.getInputArgs=function(){return e};var f={};b.getOutputArgs=function(){return f};var g,h;return b.open=function(b,f){return c="",a(function(){c=b}),d=!0,e=f,new Promise(function(a,b){g=a,h=b})},b.OK=function(b){a(function(){d=!1,b&&(f=b),g(!0)})},b.Cancel=function(b){a(function(){d=!1,b&&(f=b),g(!1)})},b.Error=function(){h()},b}]);var app=angular.module("wecoApp");app.controller("modalCreatePostController",["$scope","$timeout","$http","ENV","Upload","Modal","Post",function(a,b,c,d,e,f,g){a.Modal=f,a.errorMessage="",a.file=null,a.uploadUrl="",a.isUploading=!1,a.isLoading=!1,a.progress=0,a.preview=!1,a.newPost={branchids:[f.getInputArgs().branchid]},a.postType={items:["TEXT","PAGE","IMAGE","VIDEO","AUDIO"],idx:0,title:"POST TYPE"},a.togglePreview=function(){a.preview=!a.preview},a.setFile=function(b){a.file=b},a.upload=function(b){c({method:"GET",url:d.apiEndpoint+"post/"+b+"/picture-upload-url"}).then(function(b){b&&b.data&&b.data.data?(a.uploadUrl=b.data.data,e.http({url:a.uploadUrl,method:"PUT",headers:{"Content-Type":"image/*"},data:a.file}).then(function(b){a.file=null,a.isUploading=!1,a.progress=0,f.OK()},function(b){a.file=null,a.isUploading=!1,a.progress=0,a.errorMessage="Unable to upload photo!"},function(b){a.progress=Math.min(100,parseInt(100*b.loaded/b.total))})):a.errorMessage="Unable to upload photo!"},function(){a.errorMessage="Unable to upload photo!"})},a.$on("OK",function(){if(!(a.newPost&&a.newPost.title&&a.newPost.branchids&&0!==a.newPost.branchids.length&&a.newPost.text))return void b(function(){a.errorMessage="Please fill in all fields"});a.isLoading=!0,a.newPost.type=a.postType.items[a.postType.idx].toLowerCase();var c=JSON.parse(JSON.stringify(a.newPost));c.branchids=JSON.stringify(a.newPost.branchids),g.create(c).then(function(c){b(function(){a.errorMessage="",a.isLoading=!1,a.progress=0,a.file&&"image"!=a.newPost.type?(a.isUploading=!0,a.upload(c)):f.OK()})},function(c){b(function(){a.errorMessage=c.message,a.isLoading=!1})})}),a.$on("Cancel",function(){b(function(){a.errorMessage="",a.isLoading=!1,f.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalProfileSettingsController",["$scope","$timeout","Modal","User",function(a,b,c,d){a.Modal=c,a.values=[],a.errorMessage="",a.isLoading=!1,a.$on("OK",function(){if(a.values.length<c.getInputArgs().inputs.length||a.values.indexOf("")>-1)return void b(function(){a.errorMessage="Please fill in all fields"});for(var e={},f=0;f<c.getInputArgs().inputs.length;f++)e[c.getInputArgs().inputs[f].fieldname]=a.values[f],"date"==c.getInputArgs().inputs[f].type&&(e[c.getInputArgs().inputs[f].fieldname]=new Date(a.values[f]).getTime());a.isLoading=!0,d.update(e).then(function(){b(function(){a.values=[],a.errorMessage="",a.isLoading=!1,c.OK()})},function(c){b(function(){a.errorMessage=c.message,a.isLoading=!1})})}),a.$on("Cancel",function(){b(function(){a.values=[],a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalUploadImageController",["$scope","$timeout","Modal","$http","ENV","Upload",function(a,b,c,d,e,f){a.Modal=c,a.errorMessage="",a.uploadUrl="",a.file=null,a.isUploading=!1,a.progress=0,a.$watch(function(){return c.isOpen()},function(b){b&&d({method:"GET",url:e.apiEndpoint+c.getInputArgs().route+c.getInputArgs().type+"-upload-url"}).then(function(b){b&&b.data&&b.data.data?a.uploadUrl=b.data.data:a.errorMessage="Unable to upload photo!"},function(){a.errorMessage="Unable to upload photo!"})}),a.setFile=function(b){a.file=b},a.upload=function(){return a.file?void f.http({url:a.uploadUrl,method:"PUT",headers:{"Content-Type":"image/*"},data:a.file}).then(function(b){a.file=null,a.isUploading=!1,a.progress=0,c.OK()},function(b){a.file=null,a.isUploading=!1,a.progress=0,a.errorMessage="Unable to upload photo!"},function(b){a.progress=Math.min(100,parseInt(100*b.loaded/b.total))}):void(a.errorMessage="No file selected!")},a.$on("Cancel",function(){b(function(){a.file=null,a.errorMessage="",c.Cancel()})}),a.$on("OK",function(){return a.file?void b(function(){a.errorMessage="",a.isUploading=!0,a.progress=0,a.upload()}):void(a.errorMessage="No file selected!")})}]);var app=angular.module("wecoApp");app.directive("navBar",["User","$state","$timeout","socket","Alerts",function(a,b,c,d,e){return{restrict:"E",replace:"true",templateUrl:"/app/components/nav/nav.view.html",link:function(f,g,h){function i(){a.me().username&&a.getNotifications(a.me().username,!0).then(function(a){c(function(){f.notificationCount=a})},function(a){e.push("error","Error fetching notifications.")})}f.user=a.me,f.logout=function(){f.expanded=!1,a.logout().then(function(){b.go("auth.login")},function(){e.push("error","Unable to log out.")})},f.isControlSelected=function(a){return b.current.name.indexOf(a)>-1&&"root"==b.params.branchid},f.onHomePage=function(){return"weco.home"==b.current.name},f.expanded=!1,f.isNavExpanded=function(){return f.expanded},f.toggleNav=function(){f.expanded=!f.expanded},f.notificationCount=0,f.$watch(function(){return a.me().username},function(){i()}),f.$on("$stateChangeSuccess",i),d.on("notification","notifications",i),f.showNotificationCount=function(){return f.notificationCount>0};var j="";f.triggerAnimation=function(){c(function(){j="/assets/images/logo-animation.gif"}),c(function(){j=""},1e3)},f.getAnimationSrc=function(){return j}}}}]);var app=angular.module("wecoApp");app.directive("scrollToTopWhen",["$rootScope","$timeout",function(a,b){return{link:function(c,d,e){a.$on(e.scrollToTopWhen,function(){b(function(){angular.element(d)[0].scrollTop=0})})}}}]);var app=angular.module("wecoApp");app.directive("tabs",["$state",function(a){return{restrict:"E",replace:"true",scope:{items:"&",states:"&",callbacks:"="},templateUrl:"/app/components/tabs/tabs.view.html",link:function(b,c,d){b.isSelected=function(c){var d,e,f=b.states()[c].indexOf("("),g=b.states()[c].indexOf(")");if(f>-1&&g>-1)try{d=JSON.parse(b.states()[c].substr(f+1,b.states()[c].length-f-2)),e=b.states()[c].substr(0,f)}catch(h){console.error("Unable to parse JSON!")}return d&&e?a.current.name==e&&JSON.stringify(d)==JSON.stringify(a.params):a.current.name==b.states()[c]}}}}]);var app=angular.module("wecoApp");app.directive("tagEditor",["$timeout",function(a){return{restrict:"E",replace:"true",templateUrl:"/app/components/tag-editor/tag-editor.view.html",scope:{items:"=",title:"&",max:"&"},link:function(a,b,c){a.errorMessage="",a.data={},a.addItem=function(){if(a.errorMessage="",!(a.items.length>=a.max())&&a.data.item){if(/\s/g.test(a.data.item))return void(a.errorMessage="Cannot contain spaces.");a.data.item=a.data.item.toLowerCase(),a.items.indexOf(a.data.item)>-1||(a.items.push(a.data.item),a.data.item=void 0)}},a.removeItem=function(b){a.errorMessage="",a.items.indexOf(b)>-1&&a.items.splice(a.items.indexOf(b),1)}}}}]);var app=angular.module("wecoApp");app.directive("tooltip",["$rootScope",function(a){return{restrict:"E",replace:!1,scope:{},templateUrl:"/app/components/tooltip/tooltip.view.html",link:function(b,c){b.text=function(){return a.tooltip.text},b.x=function(){return a.tooltip.x},b.y=function(){return a.tooltip.y},b.show=function(){return a.tooltip.show}}}}]),app.directive("tooltipText",["$rootScope","$window","$timeout",function(a,b,c){return{restrict:"A",scope:{tooltipText:"="},link:function(d,e,f){var g=e[0],h=d.$eval(f.offsetX),i=d.$eval(f.offsetY);h||(h=0),i||(i=0),g.addEventListener("mouseover",function(){c(function(){a.tooltip.show=!0,a.tooltip.text=d.tooltipText,a.tooltip.x=g.getBoundingClientRect().left+b.pageXOffset+h,a.tooltip.y=g.getBoundingClientRect().top+b.pageYOffset+i})},!1),g.addEventListener("mouseout",function(){c(function(){a.tooltip.show=!1})})}}}]);var app=angular.module("wecoApp");app.controller("writeCommentController",["$scope","$timeout","Comment","Alerts",function(a,b,c,d){a.isLoading=!1,a.comment={text:""},a.postComment=function(){b(function(){a.isLoading=!0}),a.comment.postid=a.postid(),a.comment.parentid=a.parentid(),a.update?c.update(a.comment.postid,a.comment.parentid,a.comment.text).then(function(){b(function(){a.isLoading=!1,a.comment={text:""},a.onSubmit(a.comment.id)})},function(c){d.push("error","Error editing comment."),b(function(){a.isLoading=!1})}):c.create(a.comment).then(function(c){b(function(){a.isLoading=!1,a.comment={text:""},a.onSubmit(c)})},function(c){d.push("error","Error posting comment."),b(function(){a.isLoading=!1})})},a.cancelComment=function(){b(function(){a.isLoading=!1,a.comment={text:""},a.onCancel()})}}]);var app=angular.module("wecoApp");app.directive("writeComment",function(){return{restrict:"E",replace:!0,scope:{parentid:"&",postid:"&",onSubmit:"=",onCancel:"=",update:"=",placeholder:"&"},templateUrl:"/app/components/write-comment/write-comment.view.html",controller:"writeCommentController"}}),angular.module("config",[]).constant("ENV",{name:"development",apiEndpoint:"http://api-dev.eu9ntpt33z.eu-west-1.elasticbeanstalk.com/"});var api=angular.module("api",["ngResource"]);api.config(["$httpProvider",function(a){a.defaults.withCredentials=!0}]);var api=angular.module("api");api.factory("BranchPostsAPI",["$resource","ENV",function(a,b){function c(a,b){var c=[];for(var d in a)c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.join("&")}return a(b.apiEndpoint+"branch/:branchid/posts/:postid",{branchid:"@branchid",postid:""},{vote:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c}})}]);var api=angular.module("api");api.factory("BranchAPI",["$resource","ENV",function(a,b){function c(a,b){var c=[];for(var d in a)c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.join("&")}return a(b.apiEndpoint+"branch/:branchid",{},{update:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c}})}]);var api=angular.module("api");api.factory("CommentAPI",["$resource","ENV",function(a,b){function c(a,b){var c=[];for(var d in a)c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.join("&")}return a(b.apiEndpoint+"post/:postid/comments/:commentid",{postid:"@postid",commentid:""},{vote:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c},update:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c}})}]);var api=angular.module("api");api.factory("ModLogAPI",["$resource","ENV",function(a,b){return a(b.apiEndpoint+"branch/:branchid/modlog",{},{})}]);var api=angular.module("api");api.factory("ModsAPI",["$resource","ENV",function(a,b){return a(b.apiEndpoint+"branch/:branchid/mods/:username",{},{})}]);var api=angular.module("api");api.factory("PostAPI",["$resource","ENV",function(a,b){return a(b.apiEndpoint+"post/:postid",{},{})}]);var api=angular.module("api");api.factory("SubbranchRequestAPI",["$resource","ENV",function(a,b){function c(a,b){var c=[];for(var d in a)c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.join("&")}return a(b.apiEndpoint+"branch/:branchid/requests/subbranches/:childid",{branchid:"@branchid",childid:"@childid"},{getAll:{method:"GET",params:{childid:""},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c},accept:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c},reject:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c}})}]);var api=angular.module("api");api.factory("SubbranchesAPI",["$resource","ENV",function(a,b){return a(b.apiEndpoint+"branch/:branchid/subbranches",{branchid:"@branchid"},{})}]);var api=angular.module("api");api.factory("UserNotificationsAPI",["$resource","ENV",function(a,b){function c(a,b){var c=[];for(var d in a)c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.join("&")}return a(b.apiEndpoint+"user/:username/notifications/:notificationid",{username:"@username",notificationid:""},{update:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c}})}]);var api=angular.module("api");api.factory("UserAPI",["$resource","ENV",function(a,b){function c(a,b){var c=[];for(var d in a)c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.join("&")}return a(b.apiEndpoint+"user/:param",{param:"me"},{login:{method:"POST",params:{param:"login"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c},logout:{method:"GET",params:{param:"logout"}},signup:{method:"POST",params:{param:""}},update:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c}})}]);var app=angular.module("wecoApp");app.factory("Branch",["BranchAPI","SubbranchesAPI","ModLogAPI","SubbranchRequestAPI","BranchPostsAPI","$http","$state","ENV",function(a,b,c,d,e,f,g,h){var i={};return i.getPictureUrl=function(a,b,c){return"picture"!=b&&"cover"!=b&&(b="picture"),f({method:"GET",url:h.apiEndpoint+"branch/"+a+"/"+b+(c?"-thumb":"")})},i.get=function(b){return new Promise(function(c,d){a.get({branchid:b},function(a){return a&&a.data?void i.getPictureUrl(b,"picture",!1).then(function(c){return c&&c.data&&c.data.data&&(a.data.profileUrl=c.data.data),i.getPictureUrl(b,"picture",!0)},function(){return i.getPictureUrl(b,"picture",!0)}).then(function(c){return c&&c.data&&c.data.data&&(a.data.profileUrlThumb=c.data.data),i.getPictureUrl(b,"cover",!1)},function(){return i.getPictureUrl(b,"cover",!1)}).then(function(c){return c&&c.data&&c.data.data&&(a.data.coverUrl=c.data.data),i.getPictureUrl(b,"cover",!0)},function(){return i.getPictureUrl(b,"cover",!0)}).then(function(b){b&&b.data&&b.data.data&&(a.data.coverUrlThumb=b.data.data),c(a.data)},function(){c(a.data)}):d()},function(a){d({status:a.status,message:a.data.message})})})},i.update=function(b){return new Promise(function(c,d){a.update({branchid:g.params.branchid},b,function(){c()},function(a){d({status:a.status,message:a.data.message})})})},i.create=function(b){return new Promise(function(c,d){a.save(b,function(){c()},function(a){d({status:a.status,message:a.data.message})})})},i["delete"]=function(b){return new Promise(function(c,d){a["delete"]({branchid:b},function(){c()},function(a){d({status:a.status,message:a.data.message})})})},i.getSubbranches=function(a,c,d){return new Promise(function(e,f){b.get({branchid:a,timeafter:c,sortBy:d},function(a){a&&a.data?e(a.data):f({status:500,message:"Something went wrong"})},function(a){f({status:a.status,message:a.data.message})})})},i.getModLog=function(a){return new Promise(function(b,d){c.get({branchid:a},function(a){a&&a.data?b(a.data):d({status:500,message:"Something went wrong"})},function(a){d({status:a.status,message:a.data.message})})})},i.submitSubbranchRequest=function(a,b){return new Promise(function(c,e){d.save({branchid:a,childid:b},function(){c()},function(a){
e({status:a.status,message:a.data.message})})})},i.getSubbranchRequests=function(a){return new Promise(function(b,c){d.getAll({branchid:a},function(a){a&&a.data?b(a.data):c({status:500,message:"Something went wrong"})},function(a){c({status:a.status,message:a.data.message})})})},i.actionSubbranchRequest=function(a,b,c){return new Promise(function(e,f){function g(a){f({status:a.status,message:a.data.message})}if("accept"==a)d.accept({branchid:b,childid:c},{action:a},e,g);else{if("reject"!=a)return f({status:400,message:"Invalid action"});d.reject({branchid:b,childid:c},{action:a},e,g)}})},i.getPosts=function(a,b,c,d){return new Promise(function(f,g){e.get({branchid:a,timeafter:b,sortBy:c,stat:d},function(a){a&&a.data?f(a.data):g({status:500,message:"Something went wrong"})},function(a){g({status:a.status,message:a.data.message})})})},i}]);var app=angular.module("wecoApp");app.factory("Comment",["CommentAPI","$http","$state","ENV",function(a,b,c,d){var e={};return e.create=function(b){return new Promise(function(c,d){a.save(b,function(a){c(a.data)},function(a){d({status:a.status,message:a.data.message})})})},e.getMany=function(b,c,d){return new Promise(function(e,f){a.get({postid:b,parentid:c,sort:d},function(a){return a&&a.data?void e(a.data):f()},function(a){f({status:a.status,message:a.data.message})})})},e.get=function(b,c){return new Promise(function(d,e){a.get({postid:b,commentid:c},function(a){return a&&a.data?void d(a.data):e()},function(a){e({status:a.status,message:a.data.message})})})},e.vote=function(b,c,d){return new Promise(function(e,f){return"up"!=d&&"down"!=d?f():void a.vote({postid:b,commentid:c},{vote:d},function(){e()},function(a){f({status:a.status,message:a.data.message})})})},e.update=function(b,c,d){return new Promise(function(e,f){a.update({postid:b,commentid:c},{text:d},function(){e()},function(a){f({status:a.status,message:a.data.message})})})},e}]);var app=angular.module("wecoApp");app.factory("Mod",["ModsAPI","$http","$state","ENV",function(a,b,c,d){var e={};return e.getByBranch=function(b){return new Promise(function(c,d){a.get({branchid:b}).$promise["catch"](function(a){d({status:a.status,message:a.data.message})}).then(function(a){a&&a.data?c(a.data):d({status:500,message:"Something went wrong"})})})},e.create=function(b,c){return new Promise(function(d,e){a.save({branchid:b},{username:c}).$promise["catch"](function(a){e({status:a.status,message:a.data.message})}).then(function(){d()})})},e["delete"]=function(b,c){return new Promise(function(d,e){a["delete"]({branchid:b,username:c}).$promise["catch"](function(a){e({status:a.status,message:a.data.message})}).then(function(){d()})})},e}]);var app=angular.module("wecoApp");app.factory("Post",["PostAPI","BranchPostsAPI","CommentAPI","$http","$state","ENV",function(a,b,c,d,e,f){var g={};return g.getPictureUrl=function(a,b){return d({method:"GET",url:f.apiEndpoint+"post/"+a+"/picture"+(b?"-thumb":"")})},g.create=function(b){return new Promise(function(c,d){a.save(b,function(a){c(a.data)},function(a){d({status:a.status,message:a.data.message})})})},g.get=function(b){return new Promise(function(c,d){a.get({postid:b},function(a){return a&&a.data?void g.getPictureUrl(b,!1).then(function(c){return c&&c.data&&c.data.data&&(a.data.profileUrl=c.data.data),g.getPictureUrl(b,!0)}).then(function(b){b&&b.data&&b.data.data&&(a.data.profileUrlThumb=b.data.data),c(a.data)},function(){c(a.data)}):d()},function(a){d({status:a.status,message:a.data.message})})})},g.vote=function(a,c,d){return new Promise(function(e,f){return"up"!=d&&"down"!=d?f():void b.vote({branchid:a,postid:c},{vote:d},function(){e()},function(a){f({status:a.status,message:a.data.message})})})},g.getPostOnBranch=function(a,c){return new Promise(function(d,e){b.get({postid:a,branchid:c},function(a){return a&&a.data?void d(a.data):e()},function(a){e({status:a.status,message:a.data.message})})})},g}]);var app=angular.module("wecoApp");app.factory("User",["UserAPI","UserNotificationsAPI","$timeout","$http","ENV","socket",function(a,b,c,d,e,f){var g={},h={};return g.me=function(){return h||{}},g.get=function(b){return new Promise(function(c,d){a.get({param:b||"me"},function(a){return a&&a.data?void g.getPictureUrl(b||"me","picture",!1).then(function(c){return c&&c.data&&c.data.data&&(a.data.profileUrl=c.data.data),g.getPictureUrl(b||"me","picture",!0)},function(){return g.getPictureUrl(b||"me","picture",!0)}).then(function(c){return c&&c.data&&c.data.data&&(a.data.profileUrlThumb=c.data.data),g.getPictureUrl(b||"me","cover",!1)},function(){return g.getPictureUrl(b||"me","cover",!1)}).then(function(c){return c&&c.data&&c.data.data&&(a.data.coverUrl=c.data.data),g.getPictureUrl(b||"me","cover",!0)},function(){return g.getPictureUrl(b||"me","cover",!0)}).then(function(d){d&&d.data&&d.data.data&&(a.data.coverUrlThumb=d.data.data),b||(h=a.data),c(a.data)},function(){b||(h=a.data),c(a.data)}):d()},function(a){b||(h={}),d({status:a.status,message:a.data.message})})})},g.get().then(function(){},function(){}),g.getPictureUrl=function(a,b,c){return a||(a="me"),"picture"!=b&&"cover"!=b&&(b="picture"),d.get(e.apiEndpoint+"user/"+a+"/"+b+(c?"-thumb":""))},g.update=function(b){return new Promise(function(c,d){a.update(b,function(){c()},function(a){d({status:a.status,message:a.data.message})})})},g.login=function(b){return new Promise(function(c,d){a.login(b,function(){f.disconnect(),f.reconnect(),g.get().then(c,d)},function(a){d({status:a.status,message:a.data.message})})})},g.logout=function(){return new Promise(function(b,d){a.logout({},function(){c(function(){f.disconnect(),h={},b()})},function(a){d({status:a.status,message:a.data.message})})})},g.signup=function(b){return new Promise(function(c,d){a.signup(b,function(){f.disconnect(),f.reconnect(),g.get().then(c,d)},function(a){d({status:a.status,message:a.data.message})})})},g.getNotifications=function(a,c){return new Promise(function(d,e){b.get({username:a,unreadCount:c},function(a){return a&&a.data?d(a.data):c?d(0):e()},function(a){return console.error("Unable to fetch user notifications!"),e({status:a.status,message:a.data.message})})})},g.markNotification=function(a,c,d){return new Promise(function(e,f){b.update({username:a,notificationid:c},{unread:d},function(){e()},function(a){return console.error("Unable to mark notification!"),f({status:a.status,message:a.data.message})})})},g.subscribeToNotifications=function(a,c){return new Promise(function(d,e){b.update({username:a},{socketID:c},function(){d()},function(a){return console.error("Unable to mark notification!"),e({status:a.status,message:a.data.message})})})},g.unsubscribeFromNotifications=function(a){return new Promise(function(c,d){b["delete"]({username:a},function(){c()},function(a){d({status:a.status,message:a.data.message})})})},g}]);var app=angular.module("wecoApp");app.controller("authController",["$scope","$state","User",function(a,b,c){function d(){c.login(a.credentials).then(function(){a.isLoading=!1,b.go("weco.home")},function(b){a.errorMessage=b.message,a.isLoading=!1})}function e(){c.signup(a.credentials).then(function(){a.isLoading=!1,b.go("weco.home")},function(b){a.errorMessage=b.message,a.isLoading=!1})}a.credentials={},a.user=c.me,a.isLoading=!1,a.errorMessage="",a.isLoginForm=function(){return"auth.login"==b.current.name},a.submit=function(){a.isLoading=!0,a.credentials.username=a.credentials.username.toLowerCase(),a.isLoginForm()?d():e()}}]);var app=angular.module("wecoApp");app.controller("branchController",["$scope","$rootScope","$state","$timeout","Branch","Mod","User","Modal","Alerts",function(a,b,c,d,e,f,g,h,i){function j(){h.open("/app/components/modals/branch/create/create-branch.modal.view.html",{branchid:a.branchid}).then(function(a){a&&(h.getOutputArgs()&&h.getOutputArgs().branchid?c.go("weco.branch.subbranches",{branchid:h.getOutputArgs().branchid},{reload:!0}):c.go(c.current,{},{reload:!0}))},function(){i.push("error","Unable to create new branch.")})}function k(){h.open("/app/components/modals/post/create/create-post.modal.view.html",{branchid:a.branchid}).then(function(a){a&&(h.getOutputArgs()&&h.getOutputArgs().branchid?c.go("weco.branch.wall",{branchid:h.getOutputArgs().branchid},{reload:!0}):c.go(c.current,{},{reload:!0}))},function(){i.push("error","Unable to create new post.")})}a.branchid=c.params.branchid,a.showCover=!0,a.isLoading=!0,a.showCoverPicture=function(){a.showCover=!0},a.hideCoverPicture=function(){a.showCover=!1},a.timeItems=["ALL TIME","THIS YEAR","THIS MONTH","THIS WEEK","LAST 24 HRS","THIS HOUR"],a.getTimeafter=function(a){var b,c=new Date;switch(a){case"ALL TIME":b=0;break;case"THIS YEAR":b=new Date(c.getFullYear(),0,1,0,0,0,0).getTime();break;case"THIS MONTH":b=new Date(c.getFullYear(),c.getMonth(),1,0,0,0,0).getTime();break;case"THIS WEEK":b=new Date(c.getFullYear(),c.getMonth(),c.getDate()-c.getDay()+1,0,0,0,0).getTime();break;case"LAST 24 HRS":var d=new Date(c);d.setDate(c.getDate()-1),b=new Date(c.getFullYear(),c.getMonth(),d.getDate(),c.getHours(),0,0,0).getTime();break;case"THIS HOUR":b=new Date(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours(),0,0,0).getTime()}return b},a.isControlSelected=function(a){return c.current.name.indexOf(a)>-1},a.branch={},a.parent={},e.get(c.params.branchid).then(function(b){return d(function(){a.branch=b}),f.getByBranch(a.branchid)},function(a){404==a.status&&c.go("weco.notfound")}).then(function(b){return d(function(){a.branch.mods=b,a.isLoading=!1}),e.get(a.branch.parentid)}).then(function(b){d(function(){a.parent=b})},function(b){a.isLoading=!1}),a.openProfilePictureModal=function(){h.open("/app/components/modals/upload/upload-image.modal.view.html",{route:"branch/"+a.branchid+"/",type:"picture"}).then(function(a){a&&c.go(c.current,{},{reload:!0})},function(){i.push("error","Unable to update profile picture.")})},a.openCoverPictureModal=function(){h.open("/app/components/modals/upload/upload-image.modal.view.html",{route:"branch/"+a.branchid+"/",type:"cover"}).then(function(a){a&&c.go(c.current,{},{reload:!0})},function(){i.push("error","Unable to update cover picture.")})},a.addContent=function(){switch(c.current.name){case"weco.branch.subbranches":j();break;case"weco.branch.wall":"root"!=a.branchid&&k();break;case"weco.branch.post":b.$broadcast("add-comment");break;default:console.error("Unable to add content in state "+c.current.name)}},a.isModerator=function(){if(!a.branch.mods)return!1;for(var b=0;b<a.branch.mods.length;b++)if(a.branch.mods[b].username==g.me().username)return!0;return!1}}]);var app=angular.module("wecoApp");app.controller("nucleusModeratorsController",["$scope","$state","$timeout","User","Branch","Alerts",function(a,b,c,d,e,f){a.mods=[],a.isLoading=!0,a.getMod=function(b,e){var g=d.get(b);return g.then(function(b){c(function(){a.mods[e]=b})},function(){f.push("error","Error fetching moderator.")}),g};for(var g=[],h=0;h<a.branch.mods.length;h++)g.push(a.getMod(a.branch.mods[h].username,h));Promise.all(g).then(function(){a.isLoading=!1},function(){f.push("error","Error fetching moderators."),a.isLoading=!1})}]);var app=angular.module("wecoApp");app.controller("nucleusModToolsController",["$scope","$state","$timeout","Modal","User","Branch","Alerts",function(a,b,c,d,e,f,g){a.isLoading=!0,a.isModLogOpen=!1,a.toggleIsModLogOpen=function(){a.isModLogOpen=!a.isModLogOpen},a.modLog=[],f.getModLog(a.branchid).then(function(b){c(function(){a.modLog=b,a.isLoading=!1})},function(){g.push("error","Error fetching moderator action log."),a.isLoading=!1}),a.openAddModModal=function(){d.open("/app/components/modals/branch/nucleus/modtools/add-mod/add-mod.modal.view.html",{branchid:a.branchid}).then(function(a){a&&b.go(b.current,{},{reload:!0})},function(){g.push("error","Error updating moderator settings.")})},a.openRemoveModModal=function(){for(var c,f=0;f<a.branch.mods.length;f++)a.branch.mods[f].username==e.me().username&&(c=a.branch.mods[f]);for(var h=[],f=0;f<a.branch.mods.length;f++)a.branch.mods[f].date>c.date&&a.branch.mods[f].username!==c.username&&h.push(a.branch.mods[f]);d.open("/app/components/modals/branch/nucleus/modtools/remove-mod/remove-mod.modal.view.html",{branchid:a.branchid,mods:h}).then(function(a){a&&b.go(b.current,{},{reload:!0})},function(){g.push("error","Error updating moderator settings.")})},a.openSubmitSubbranchRequestModal=function(){d.open("/app/components/modals/branch/nucleus/modtools/submit-subbranch-request/submit-subbranch-request.modal.view.html",{branchid:a.branchid}).then(function(a){a&&b.go(b.current,{},{reload:!0})},function(){g.push("error","Error submitting child branch request.")})},a.openReviewSubbranchRequestsModal=function(){d.open("/app/components/modals/branch/nucleus/modtools/review-subbranch-requests/review-subbranch-requests.modal.view.html",{branchid:a.branchid}).then(function(a){a&&b.go(b.current,{},{reload:!0})},function(){g.push("error","Error responding to child branch request.")})},a.openDeleteBranchModal=function(){d.open("/app/components/modals/branch/nucleus/modtools/delete-branch/delete-branch.modal.view.html",{}).then(function(a){a&&b.go(b.current,{},{reload:!0})},function(){g.push("error","Error deleting branch.")})}}]);var app=angular.module("wecoApp");app.controller("nucleusController",["$scope","$state","$timeout","Branch","User",function(a,b,c,d,e){a.tabItems=["about","moderators"],a.tabStates=['weco.branch.nucleus.about({ "branchid": "'+a.branchid+'"})','weco.branch.nucleus.moderators({ "branchid": "'+a.branchid+'"})'],a.$watch(a.isModerator,function(){if(a.branch.mods)for(var b=0;b<a.branch.mods.length;b++)a.branch.mods[b].username==e.me().username&&(a.tabItems.indexOf("settings")==-1&&(a.tabItems.push("settings"),a.tabStates.push('weco.branch.nucleus.settings({ "branchid": "'+a.branchid+'"})')),a.tabItems.indexOf("mod tools")==-1&&(a.tabItems.push("mod tools"),a.tabStates.push('weco.branch.nucleus.modtools({ "branchid": "'+a.branchid+'"})')))}),a.addHTMLLineBreaks=function(a){if(a)return a.split("\n").join("<br>")}}]);var app=angular.module("wecoApp");app.controller("nucleusSettingsController",["$scope","$state","$timeout","Modal","Alerts",function(a,b,c,d,e){function f(a){d.open("/app/components/modals/branch/nucleus/settings/settings.modal.view.html",a).then(function(a){a&&b.go(b.current,{},{reload:!0})},function(){e.push("error","Error updating branch settings.")})}a.openVisibleNameModal=function(){f({title:"Visible Name",inputs:[{placeholder:"Visible name",type:"text",fieldname:"name"}],textareas:[]})},a.openRulesModal=function(){f({title:"Rules & Etiquette",inputs:[],textareas:[{placeholder:"Rules & Etiquette Text",fieldname:"rules"}]})},a.openDescriptionModal=function(){f({title:"Description",inputs:[],textareas:[{placeholder:"Description",fieldname:"description"}]})}}]);var app=angular.module("wecoApp");app.controller("postController",["$scope","$rootScope","$state","$timeout","Post","Comment","Alerts",function(a,b,c,d,e,f,g){function h(a){if(a&&""!==a){var b=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=|\?v=)([^#\&\?]*).*/,c=a.match(b);if(c&&11==c[2].length)return!0}return!1}function i(b,e){var g=b.shift();g&&f.get(c.params.postid,a.comments[e].id).then(function(c){c&&d(function(){a.comments[e].data=c.data,a.comments[e].isLoading=!1}),i(b,e+1)})["catch"](function(){i(b,e+1)})}function j(){if(a.isCommentPermalink())f.get(c.params.postid,c.params.commentid).then(function(b){d(function(){a.comments=[b],a.isLoadingComments=!1;for(var c=0;c<a.comments.length;c++)a.comments[c].isLoading=!0;i(a.comments.slice(),0)})},function(b){404!=b.status&&g.push("error","Error loading comments."),a.isLoadingComments=!1});else{var b=a.sortItems[a.selectedSortItemIdx].toLowerCase();f.getMany(c.params.postid,void 0,b).then(function(b){d(function(){a.comments=b,a.isLoadingComments=!1;for(var c=0;c<a.comments.length;c++)a.comments[c].isLoading=!0;i(a.comments.slice(),0)})},function(b){404!=b.status&&g.push("error","Error loading comments."),a.isLoadingComments=!1})}}a.isLoadingPost=!0,a.isLoadingComments=!0,a.post={},a.comments=[],a.markdownRaw="",a.videoEmbedURL="",a.previewState="show",a.sortItems=["POINTS","REPLIES","DATE"],a.selectedSortItemIdx=0,a.selectedSortItemIdx=0,a.$watch("selectedSortItemIdx",function(){j()}),a.onSubmitComment=function(){j()},a.isCommentPermalink=function(){return"weco.branch.post.comment"==c.current.name},a.setPreviewState=function(b){a.previewState=b},a.vote=function(a,b){e.vote("root",a.id,b).then(function(){var c="up"==b?1:-1;d(function(){a.individual+=c,a.local+=c,a.global+=c})},function(a){g.push("error","Error voting on post.")})},e.getPostOnBranch(c.params.postid,a.branchid).then(function(){return e.get(c.params.postid)},function(){c.go("weco.notfound")}).then(function(b){d(function(){if(a.post=b,a.markdownRaw=b.data.text,a.isLoadingPost=!1,"video"==a.post.type&&h(a.post.data.text)){var c=a.post.data.text.split("v=")[1]||a.post.data.text.split("embed/")[1];c.indexOf("&")!=-1&&(c=c.substring(0,c.indexOf("&"))),a.videoEmbedURL="//www.youtube.com/embed/"+c+"?rel=0"}})},function(b){404==b.status?c.go("weco.notfound"):g.push("error","Error fetching post."),a.isLoadingPost=!1}),b.$on("$stateChangeSuccess",function(a,b,c,d,e,f){j()})}]);var app=angular.module("wecoApp");app.controller("subbranchesController",["$scope","$state","$timeout","Branch","Alerts",function(a,b,c,d,e){function f(b,e){var g=b.shift();g&&d.getPictureUrl(a.branches[e].id,"picture",!1).then(function(b){return b&&b.data&&b.data.data&&c(function(){a.branches[e].profileUrl=b.data.data}),d.getPictureUrl(a.branches[e].id,"picture",!0)}).then(function(d){d&&d.data&&d.data.data&&c(function(){a.branches[e].profileUrlThumb=d.data.data}),f(b,e+1)})["catch"](function(){f(b,e+1)})}function g(){var b,g=a.getTimeafter(a.timeItems[a.selectedTimeItemIdx]);switch(a.sortByItems[a.selectedSortByItemIdx]){case"TOTAL POINTS":b="post_points";break;case"DATE":b="date";break;case"NUMBER OF POSTS":b="post_count";break;case"NUMBER OF COMMENTS":b="post_comments";break;default:b="date"}d.getSubbranches(a.branchid,g,b).then(function(b){c(function(){a.branches=b,a.isLoading=!1,f(a.branches.slice(),0)})},function(){e.push("error","Error fetching branches."),a.isLoading=!1})}a.isLoading=!0,a.branches=[],a.selectedTimeItemIdx=0,a.$watch("selectedTimeItemIdx",function(){g()}),a.sortByItems=["TOTAL POINTS","NUMBER OF POSTS","NUMBER OF COMMENTS","DATE"],a.selectedSortByItemIdx=0,a.$watch("selectedSortByItemIdx",function(){g()})}]);var app=angular.module("wecoApp");app.controller("wallController",["$scope","$state","$timeout","Branch","Post","Alerts",function(a,b,c,d,e,f){function g(b,d){var f=b.shift();f&&e.get(a.posts[d].id).then(function(e){e&&c(function(){var b=a.posts[d].global;a.posts[d]=e,a.posts[d].global=b,a.posts[d].isLoading=!1}),g(b,d+1)})["catch"](function(){g(b,d+1)})}function h(){var b,e=a.getTimeafter(a.timeItems[a.selectedTimeItemIdx]);switch(a.sortByItems[a.selectedSortByItemIdx]){case"TOTAL POINTS":b="points";break;case"DATE":b="date";break;case"NUMBER OF COMMENTS":b="comment_count";break;default:b="points"}d.getPosts(a.branchid,e,b,a.stat).then(function(b){c(function(){a.posts=b,a.isLoading=!1;for(var c=0;c<a.posts.length;c++)a.posts[c].isLoading=!0;g(a.posts.slice(),0)})},function(){f.push("error","Error fetching posts."),a.isLoading=!1})}a.isLoading=!1,a.posts=[],a.stat="global",a.vote=function(b,d){e.vote(a.branchid,b.id,d).then(function(){var a="up"==d?1:-1;c(function(){b.individual+=a,b.local+=a,b.global+=a})},function(a){f.push("error","Error voting on post.")})},a.setStat=function(b){a.isLoading=!0,a.stat=b,h()},a.getLink=function(a){return"text"==a.type?b.href("weco.branch.post",{postid:a.id}):a.text},a.selectedTimeItemIdx=0,a.$watch("selectedTimeItemIdx",function(){h()}),a.postTypeItems=["ALL","TEXT","IMAGE","VIDEO","AUDIO","PAGE"],a.selectedPostTypeItemIdx=0,a.sortByItems=["TOTAL POINTS","NUMBER OF COMMENTS","DATE"],a.selectedSortByItemIdx=0,a.$watch("selectedSortByItemIdx",function(){"TOTAL POINTS"!=a.sortByItems[a.selectedSortByItemIdx]&&a.setStat("individual"),h()})}]);var app=angular.module("wecoApp");app.controller("profileNotificationsController",["$scope","$state","$timeout","User","NotificationTypes","Alerts",function(a,b,c,d,e,f){function g(){a.isLoading=!0,d.getNotifications(b.params.username).then(function(b){c(function(){a.notifications=b,a.isLoading=!1})},function(){f.push("error","Unable to fetch notifications.")})}a.isLoading=!1,a.NotificationTypes=e,a.me=d.me,a.notifications=[],a.getNotificationImageType=function(a){switch(a.type){case e.NEW_CHILD_BRANCH_REQUEST:case e.CHILD_BRANCH_REQUEST_ANSWERED:case e.BRANCH_MOVED:return"branch";case e.MODERATOR:return"moderator";case e.COMMENT:return"comment";default:return"user"}},a.setUnread=function(a,b){d.markNotification(d.me().username,a.id,b).then(function(){c(function(){a.unread=b})},function(a){f.push("error","Unable to mark notification.")})},g()}]);var app=angular.module("wecoApp");app.controller("profileController",["$scope","$timeout","$state","User","Modal","Alerts",function(a,b,c,d,e,f){a.user={},a.showCover=!0,a.isLoading=!0,a.showCoverPicture=function(){a.showCover=!0},a.hideCoverPicture=function(){a.showCover=!1},d.get(c.params.username).then(function(c){b(function(){a.user=c,a.isLoading=!1})},function(b){404==b.status?c.go("weco.notfound"):f.push("error","Unable to fetch user."),a.isLoading=!1}),a.tabItems=["about","timeline"],a.tabStates=["weco.profile.about","weco.profile.timeline"],a.$watch(function(){return d.me().username},function(b){b==c.params.username&&(a.tabItems.indexOf("settings")==-1&&a.tabStates.indexOf("weco.profile.settings")==-1&&(a.tabItems.push("settings"),a.tabStates.push("weco.profile.settings")),a.tabItems.indexOf("notifications")==-1&&a.tabStates.indexOf("weco.profile.notifications")==-1&&(a.tabItems.push("notifications"),a.tabStates.push("weco.profile.notifications")))}),a.openProfilePictureModal=function(){e.open("/app/components/modals/upload/upload-image.modal.view.html",{route:"user/me/",type:"picture"}).then(function(a){a&&c.go(c.current,{},{reload:!0})},function(){f.push("error","Unable to change profile picture.")})},a.openCoverPictureModal=function(){e.open("/app/components/modals/upload/upload-image.modal.view.html",{route:"user/me/",type:"cover"}).then(function(a){a&&c.go(c.current,{},{reload:!0})},function(){f.push("error","Unable to change cover picture.")})},a.isMyProfile=function(){return d.me().username==c.params.username}}]);var app=angular.module("wecoApp");app.controller("profileSettingsController",["$scope","$state","Modal","Alerts",function(a,b,c,d){function e(a){c.open("/app/components/modals/profile/settings/settings.modal.view.html",a).then(function(a){a&&b.go(b.current,{},{reload:!0})},function(){d.push("error","Unable to update profile settings.")})}a.openNameModal=function(){e({title:"Name",inputs:[{placeholder:"First name",type:"text",fieldname:"firstname"},{placeholder:"Last name",type:"text",fieldname:"lastname"}]})},a.openEmailModal=function(){e({title:"Email",inputs:[{placeholder:"Email",type:"email",fieldname:"email"}]})},a.openDOBModal=function(){e({title:"Date of Birth",inputs:[{placeholder:"Date of Birth",type:"date",fieldname:"dob"}]})}}]);
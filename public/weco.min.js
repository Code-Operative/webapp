"use strict";function getLogActionVerb(a){return"addmod"==a?"added":"removemod"==a?"removed":""}function getTemplate(a){var b="<div class=\"time\">{{ entry.date | date: 'dd MMMM yyyy HH:mm' }}</div>";switch(a.action){case"removemod":case"addmod":return b+'<div class="entry"><a ui-sref="weco.profile.about({ username: entry.username })">{{ entry.username }}</a> '+getLogActionVerb(a.action)+' <a ui-sref="weco.profile.about({ username: entry.data })">{{ entry.data }}</a> as a moderator.</div>';case"make-subbranch-request":return b+'<div class="entry"><a ui-sref="weco.profile.about({ username: entry.username })">{{ entry.username }}</a> made a Child Branch Request to <a ui-sref="weco.branch.nucleus.about({ branchid: entry.data })">{{ entry.data }}</a>.</div>';case"answer-subbranch-request":var c=JSON.parse(a.data);return b+'<div class="entry"><a ui-sref="weco.profile.about({ username: entry.username })">{{ entry.username }}</a> '+c.response+"ed a Child Branch Request to <a ui-sref=\"weco.branch.nucleus.about({ branchid: '"+c.parentid+"' })\">"+c.parentid+"</a> made by <a ui-sref=\"weco.profile.about({ username: '"+c.childmod+"' })\">"+c.childmod+"</a> from <a ui-sref=\"weco.branch.nucleus.about({ branchid: '"+c.childid+"' })\">"+c.childid+"</a>.</div>";default:return""}}var app=angular.module("wecoApp",["config","ui.router","ngAnimate","ngSanitize","ngFileUpload","hc.marked","angular-google-analytics","api"]);app.constant("NotificationTypes",{NEW_CHILD_BRANCH_REQUEST:0,CHILD_BRANCH_REQUEST_ANSWERED:1,BRANCH_MOVED:2,MODERATOR:3,COMMENT:4,POST_FLAGGED:5,POST_REMOVED:6,POST_TYPE_CHANGED:7,POST_MARKED_NSFW:8}),app.config(["markedProvider",function(a){a.setOptions({gfm:!0,sanitize:!0})}]),app.config(function($sceDelegateProvider){$sceDelegateProvider.resourceUrlWhitelist(["self","*://www.youtube.com/**"])}),app.filter("reverse",function(){return function(a){return!!angular.isArray(a)&&(!!a&&a.slice().reverse())}}),app.filter("capitalize",function(){return function(a){return a?a.charAt(0).toUpperCase()+a.substr(1).toLowerCase():""}}),app.config(["$stateProvider","$urlRouterProvider","$locationProvider","AnalyticsProvider","ENV",function($stateProvider,$urlRouterProvider,$locationProvider,a,b){a.setAccount("UA-84400255-1"),"production"===b.name?a.setDomainName("weco.io"):a.setDomainName("none"),a.setPageEvent("$stateChangeSuccess"),a.logAllCalls(!0),$locationProvider.html5Mode(!0),$urlRouterProvider.otherwise("/"),$urlRouterProvider.rule(function($injector,$location){var a=$location.path(),b="/"===a[a.length-1];if(b){var c=a.substr(0,a.length-1);return c}}),$stateProvider.state("auth",{"abstract":!0,templateUrl:"/app/pages/auth/auth.view.html",controller:"authController"}).state("auth.login",{url:"/login"}).state("auth.signup",{url:"/signup"}).state("verify",{url:"/:username/verify/:token",templateUrl:"/app/pages/verify/verify.view.html",controller:"verifyController"}).state("reset-password",{url:"/reset-password","abstract":!0,templateUrl:"/app/pages/reset-password/reset-password.view.html",controller:"resetPasswordController"}).state("reset-password.request",{url:"/request",templateUrl:"/app/pages/reset-password/request/request.view.html",controller:"requestResetPasswordController"}).state("reset-password.confirm",{url:"/:username/:token",templateUrl:"/app/pages/reset-password/confirm/confirm.view.html",controller:"confirmResetPasswordController"}).state("weco",{"abstract":!0,resolve:{authenticate:function(){console.log("This code is ran before any state is reached...")}},template:'<nav-bar></nav-bar><div class="full-page" ui-view></div>'}).state("weco.notfound",{templateUrl:"/app/pages/notfound/notfound.view.html"}).state("weco.home",{url:"/",templateUrl:"/app/pages/home/home.view.html",pageTrack:"/"}).state("weco.profile",{url:"/u/:username","abstract":!0,templateUrl:"/app/pages/profile/profile.view.html",controller:"profileController"}).state("weco.profile.about",{url:"/about",templateUrl:"/app/pages/profile/about/about.view.html",pageTrack:"/u/:username/about"}).state("weco.profile.timeline",{url:"/timeline",templateUrl:"/app/pages/profile/timeline/timeline.view.html",pageTrack:"/u/:username/timeline"}).state("weco.profile.settings",{url:"/settings",templateUrl:"/app/pages/profile/settings/settings.view.html",selfOnly:!0,redirectTo:"auth.login",pageTrack:"/u/:username/settings"}).state("weco.profile.notifications",{url:"/notifications",templateUrl:"/app/pages/profile/notifications/notifications.view.html",selfOnly:!0,redirectTo:"auth.login",pageTrack:"/u/:username/notifications"}).state("weco.branch",{url:"/b/:branchid","abstract":!0,templateUrl:"/app/pages/branch/branch.view.html",controller:"branchController"}).state("weco.branch.nucleus",{url:"/nucleus","abstract":!0,templateUrl:"/app/pages/branch/nucleus/nucleus.view.html",controller:"nucleusController",pageTrack:"/b/:branchid/nucleus"}).state("weco.branch.nucleus.about",{url:"/about",templateUrl:"/app/pages/branch/nucleus/about/about.view.html"}).state("weco.branch.nucleus.settings",{url:"/settings",templateUrl:"/app/pages/branch/nucleus/settings/settings.view.html",controller:"nucleusSettingsController",modOnly:!0,redirectTo:"auth.login"}).state("weco.branch.nucleus.moderators",{url:"/moderators",templateUrl:"/app/pages/branch/nucleus/moderators/moderators.view.html",controller:"nucleusModeratorsController"}).state("weco.branch.nucleus.modtools",{url:"/modtools",templateUrl:"/app/pages/branch/nucleus/modtools/modtools.view.html",controller:"nucleusModToolsController",modOnly:!0,redirectTo:"auth.login"}).state("weco.branch.nucleus.flaggedposts",{url:"/flaggedposts",templateUrl:"/app/pages/branch/nucleus/flaggedposts/flaggedposts.view.html",controller:"nucleusFlaggedPostsController",modOnly:!0,redirectTo:"auth.login"}).state("weco.branch.subbranches",{url:"/subbranches",templateUrl:"/app/pages/branch/subbranches/subbranches.view.html",controller:"subbranchesController",pageTrack:"/b/:branchid/subbranches"}).state("weco.branch.wall",{url:"/wall",templateUrl:"/app/pages/branch/wall/wall.view.html",controller:"wallController",pageTrack:"/b/:branchid/wall"}).state("weco.branch.post",{url:"/p/:postid",templateUrl:"/app/pages/branch/post/post.view.html",controller:"postController",pageTrack:"/p/:postid"}).state("weco.branch.post.comment",{url:"/c/:commentid",pageTrack:"/p/:postid/c/:commentid"}),$urlRouterProvider.when("/u/{username}","/u/{username}/about"),$urlRouterProvider.when("/b/{branchid}","/b/{branchid}/wall"),$urlRouterProvider.otherwise(function($injector,$location){var a=$injector.get("$state");return a.go("weco.notfound"),$location.path()})}]),app.run(["$rootScope","$state","$timeout","$window","User","Mod","socket","Modal","Alerts","Analytics",function(a,b,c,d,e,f,g,h,i,j){a.tooltip={},a.modalOpen=h.isOpen,c(function(){d.prerenderReady=!0}),g.on("on_connect","notifications",function(a){console.log("Connection established"),e.get().then(function(b){if(!b.username)throw"Not Authenticated";return e.subscribeToNotifications(b.username,a.id)}).then(function(){console.log("Successfully subscribed to notifications")})["catch"](function(a){console.error("Error subscribing to notifications: ",a)})}),g.on("on_disconnect","notifications",function(a){console.log("Disconnected"),e.me().username?e.unsubscribeFromNotifications(e.me().username,a.id).then(function(){console.log("Successfully unsubscribed from notifications")},function(a){console.error("Error unsubscribing to notifications: ",a)}):console.error("Error unsubscribing to notifications: Not Authenticated")}),a.$on("$stateChangeStart",function(a,c,d,g,h){function i(a){f.getByBranch(d.branchid).then(function(b){k=b,a()},a)}function j(){e.get().then(function(e){if(!c.selfOnly||0!==Object.keys(e).length&&d.username==e.username||(console.log(Object.keys(e).length),b.transitionTo(c.redirectTo),a.preventDefault()),c.modOnly){for(var f=!1,g=0;g<k.length;g++)k[g].username==e.username&&(f=!0);f||(b.transitionTo(c.redirectTo),a.preventDefault())}},function(d){d&&(console.error("Unable to fetch self: ",d),b.transitionTo(c.redirectTo),a.preventDefault())})}var k=[];c.modOnly?i(j):c.selfOnly&&j()})}]),app.factory("socket",["$rootScope","ENV",function(a,b){var c={},d={},e=[];return c.reconnect=function(){console.log("Reconnecting"),d={notifications:io.connect(b.apiEndpoint+"notifications",{forceNew:!0}),messages:io.connect(b.apiEndpoint+"messages",{forceNew:!0})};for(var a=0;a<e.length;a++)d[e[a].namespace].on(e[a].event,e[a].cb)},c.disconnect=function(){console.log("Disconnecting");for(var a in d)d[a].io.disconnect()},c.on=function(a,b,c){e.push({event:a,namespace:b,cb:c}),d[b].on(a,c)},c.reconnect(),c}]),app.controller("rootController",["$scope","$state","ENV",function(a,b,c){a.socketioURL=c+"socket.io/socket.io.js",a.hasNavBar=function(){return!(b.current.name.indexOf("auth")>-1||b.current.name.indexOf("verify")>-1||b.current.name.indexOf("reset-password")>-1)}}]);var app=angular.module("wecoApp");app.directive("alerts",["$timeout","Alerts",function(a,b){return{restrict:"E",replace:!0,scope:{},templateUrl:"/app/components/alerts/alerts.view.html",link:function(a){a.alerts=b.get,a.close=b.close}}}]);var app=angular.module("wecoApp");app.factory("Alerts",["$timeout",function(a){function b(){e=e.filter(function(a){return a.alive===!0})}function c(c){c.alive=!1,a(function(){b()},600)}var d={},e=[],f=5e3;return d.get=function(){return e},d.push=function(b,d,g){var h={type:b,text:d,alive:!0};a(function(){e=[h].concat(e),g||a(function(){c(h)},f)})},d.close=function(a){c(e[a])},d}]);var app=angular.module("wecoApp");app.directive("commentThread",["$state","Comment","User","$timeout","Alerts",function(a,b,c,d,e){return{restrict:"E",replace:!1,scope:{comments:"=",sortBy:"="},templateUrl:"/app/components/comment-thread/comment-thread.view.html",link:function(f){function g(a,c){b.getMany(a.postid,a.id,f.sortBy.toLowerCase(),c).then(function(b){d(function(){c?a.comments=a.comments.concat(b):a.comments=b})},function(){e.push("error","Unable to get replies!")})}f.user=c.me(),f.openComment=void 0,f.openReply=function(a,b){d(function(){f.openComment&&(f.openComment.openReply=!1),f.openComment=a,f.openComment.openReply=!0,f.openComment.update=b})},f.closeReply=function(){d(function(){f.openComment.openReply=!1,f.openComment=void 0})},f.onCancelComment=function(){f.closeReply()},f.onSubmitComment=function(){f.openComment.update?(d(function(){f.openComment.isLoading=!0}),b.get(f.openComment.postid,f.openComment.id).then(function(a){d(function(){f.openComment.data=a,f.openComment.isLoading=!1,f.closeReply()})},function(){e.push("error","Unable to reload comment!"),f.closeReply()})):(f.loadMore(f.openComment),f.closeReply())},f.timeSince=function(a){var b=6e4,c=60*b,d=24*c,e=30*d,f=365*d,g=(new Date).getTime()-new Date(a);return g<b?Math.round(g/1e3)+" seconds ago":g<c?Math.round(g/b)+" minutes ago":g<d?Math.round(g/c)+" hours ago":g<e?Math.round(g/d)+" days ago":g<f?Math.round(g/e)+" months ago":Math.round(g/f)+" years ago"},f.loadMore=function(a){var b=null;a.comments&&a.comments.length>0&&(b=a.comments[a.comments.length-1].id),g(a,b)},f.vote=function(a,c){b.vote(a.postid,a.id,c).then(function(){var b="up"==c?1:-1;d(function(){a.individual+=b}),e.push("success","Thanks for voting!")},function(a){400===a.status?e.push("error","You have already voted on this comment."):e.push("error","Error voting on comment.")})},f.isOwnComment=function(a){return!(!c.me()||!a.data)&&c.me().username==a.data.creator},f.openCommentPermalink=function(b){a.go("weco.branch.post.comment",{postid:b.postid,commentid:b.id},{reload:!0})}}}}]);var app=angular.module("wecoApp");app.directive("dropdown",["$timeout",function(a){return{restrict:"E",replace:"true",templateUrl:"/app/components/dropdown/dropdown.view.html",scope:{title:"&",items:"=",selected:"="},link:function(b,c,d){b.isOpen=!1,b.open=function(){a(function(){b.isOpen=!0})},b.close=function(){a(function(){b.isOpen=!1})},b.select=function(c){a(function(){b.selected=c,b.close()})}}}}]);var app=angular.module("wecoApp");app.directive("loading",["$compile",function(a){return{restrict:"A",templateUrl:"/app/components/loading/loading.view.html",scope:{when:"&"},replace:!1,transclude:!0,link:function(a,b,c,d,e){e(a.$parent,function(a,c){b.append(a)})}}}]);var app=angular.module("wecoApp");app.directive("modLogEntry",["$compile",function(a){var b=function(b,c,d){c.html(getTemplate(b.entry)),a(c.contents())(b)};return{restrict:"A",replace:!1,link:b,scope:{entry:"="}}}]);var app=angular.module("wecoApp");app.controller("modalCreateBranchController",["$scope","$timeout","Modal","Branch",function(a,b,c,d){a.newBranch={parentid:c.getInputArgs().branchid},a.errorMessage="",a.$on("OK",function(){return a.newBranch&&a.newBranch.id&&a.newBranch.name?(a.isLoading=!0,a.newBranch.id=a.newBranch.id.toLowerCase(),void d.create(a.newBranch).then(function(){b(function(){var b=a.newBranch.id;a.newBranch={},a.errorMessage="",a.isLoading=!1,c.OK({branchid:b})})},function(c){b(function(){a.errorMessage=c.message,a.isLoading=!1})})):void b(function(){a.errorMessage="Please fill in all fields"})}),a.$on("Cancel",function(){b(function(){a.newBranch={},a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalNucleusAddModController",["$scope","$timeout","Modal","Mod",function(a,b,c,d){a.Modal=c,a.errorMessage="",a.isLoading=!1,a.data={},a.$on("OK",function(){a.isLoading=!0;var e=c.getInputArgs().branchid;d.create(e,a.data.username).then(function(){b(function(){a.data={},a.errorMessage="",a.isLoading=!1,c.OK()})},function(c){b(function(){a.data={},a.errorMessage=c.message,404==c.status&&(a.errorMessage="That user doesn't exist"),a.isLoading=!1})})}),a.$on("Cancel",function(){b(function(){a.data={},a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalNucleusDeleteBranchController",["$scope","$timeout","Modal","Branch",function(a,b,c,d){a.Modal=c,a.errorMessage="",a.isLoading=!1,a.data={},a.$on("OK",function(){return a.data&&a.data.branchid?(a.isLoading=!0,void d["delete"](a.data.branchid).then(function(){b(function(){a.data={},a.errorMessage="",a.isLoading=!1,c.OK()})},function(c){b(function(){a.errorMessage=c.message,a.isLoading=!1})})):void b(function(){a.errorMessage="Please fill in all fields"})}),a.$on("Cancel",function(){b(function(){a.data={},a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalNucleusRemoveModController",["$scope","$timeout","Modal","Branch","User","Mod",function(a,b,c,d,e,f){function g(c,d){var f=e.get(c);return f.then(function(c){b(function(){a.mods[d]=c})},function(){a.errorMessage="Unable to get mod!"}),f}a.Modal=c,a.errorMessage="",a.isLoading=!0,a.mods=[],a.selectedMod={};for(var h=[],i=0;i<c.getInputArgs().mods.length;i++)h.push(g(c.getInputArgs().mods[i].username,i));Promise.all(h).then(function(){a.isLoading=!1}),a.select=function(b){a.selectedMod=b},a.$on("OK",function(){a.isLoading=!0;var d=c.getInputArgs().branchid;f["delete"](d,a.selectedMod.username).then(function(){b(function(){c.OK({removedMod:a.selectedMod.username}),a.selectedMod={},a.errorMessage="",a.isLoading=!1})},function(c){b(function(){a.errorMessage=c.message,404==c.status&&(a.errorMessage="That user doesn't exist"),a.isLoading=!1})})}),a.$on("Cancel",function(){b(function(){c.Cancel(),a.selectedMod={},a.errorMessage="",a.isLoading=!1})})}]);var app=angular.module("wecoApp");app.controller("modalNucleusReviewSubbranchRequestsController",["$scope","$timeout","Modal","Branch",function(a,b,c,d){a.Modal=c,a.errorMessage="",a.requests=[],a.isLoading=!0,d.getSubbranchRequests(c.getInputArgs().branchid).then(function(c){function e(b,e){var f=d.get(b);return f.then(function(a){c[e].branch=a},function(){a.errorMessage="Unable to get branch!"}),f}for(var f=[],g=0;g<c.length;g++)f.push(e(c[g].childid,g));Promise.all(f).then(function(){b(function(){a.requests=c,a.isLoading=!1})},function(){b(function(){a.errorMessage="Unable to fetch child branch requests!",a.isLoading=!1})})},function(){a.errorMessage="Unable to fetch child branch requests!"}),a.action=function(c,e){a.isLoading=!0,d.actionSubbranchRequest(e,a.requests[c].parentid,a.requests[c].childid).then(function(){b(function(){a.requests.splice(c,1),a.errorMessage="",a.isLoading=!1})},function(c){b(function(){a.errorMessage=c.message,404==c.status&&(a.errorMessage="That user doesn't exist"),a.isLoading=!1})})},a.$on("OK",function(){b(function(){a.errorMessage="",a.isLoading=!1,c.OK()})}),a.$on("Cancel",function(){b(function(){a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalNucleusSubmitSubbranchRequestController",["$scope","$timeout","Modal","Branch",function(a,b,c,d){a.Modal=c,a.errorMessage="",a.isLoading=!1,a.data={},a.$on("OK",function(){if(!a.data||!a.data.parentid)return void b(function(){a.errorMessage="Please fill in all fields"});a.isLoading=!0;var e=c.getInputArgs().branchid;d.submitSubbranchRequest(a.data.parentid,e).then(function(){b(function(){a.data={},a.errorMessage="",a.isLoading=!1,c.OK()})},function(c){b(function(){a.errorMessage=c.message,a.isLoading=!1})})}),a.$on("Cancel",function(){b(function(){a.data={},a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalNucleusSettingsController",["$scope","$timeout","Modal","Branch",function(a,b,c,d){a.Modal=c,a.inputValues=[],a.textareaValues=[],a.errorMessage="",a.isLoading=!1,a.$on("OK",function(){if(a.inputValues.length<c.getInputArgs().inputs.length||a.inputValues.indexOf("")>-1||a.textareaValues.length<c.getInputArgs().textareas.length||a.textareaValues.indexOf("")>-1)return void b(function(){a.errorMessage="Please fill in all fields"});for(var e={},f=0;f<c.getInputArgs().inputs.length;f++)e[c.getInputArgs().inputs[f].fieldname]=a.inputValues[f],"date"==c.getInputArgs().inputs[f].type&&(e[c.getInputArgs().inputs[f].fieldname]=new Date(a.inputValues[f]).getTime());for(var f=0;f<c.getInputArgs().textareas.length;f++)e[c.getInputArgs().textareas[f].fieldname]=a.textareaValues[f];a.isLoading=!0,d.update(e).then(function(){b(function(){a.inputValues=[],a.textareaValues=[],a.errorMessage="",a.isLoading=!1,c.OK()})},function(c){b(function(){a.errorMessage=c.message,a.isLoading=!1})})}),a.$on("Cancel",function(){b(function(){a.inputValues=[],a.textareaValues=[],a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.directive("modal",["Modal",function(a){return{restrict:"A",replace:!1,scope:{},templateUrl:"/app/components/modals/modal.view.html",link:function(b,c,d){b.getTemplateUrl=a.templateUrl,b.isOpen=a.isOpen,b.OK=function(){b.$broadcast("OK")},b.Cancel=function(){b.$broadcast("Cancel")}}}}]);var app=angular.module("wecoApp");app.factory("Modal",["$timeout",function(a){var b={},c="";b.templateUrl=function(){return c};var d=!1;b.isOpen=function(){return d};var e={};b.getInputArgs=function(){return e};var f={};b.getOutputArgs=function(){return f};var g,h;return b.open=function(b,f){return c="",a(function(){c=b}),d=!0,e=f,new Promise(function(a,b){g=a,h=b})},b.OK=function(b){a(function(){d=!1,b&&(f=b),g(!0)})},b.Cancel=function(b){a(function(){d=!1,b&&(f=b),g(!1)})},b.Error=function(){h()},b}]);var app=angular.module("wecoApp");app.controller("modalCreatePostController",["$scope","$timeout","$http","ENV","Upload","Modal","Post",function(a,b,c,d,e,f,g){a.Modal=f,a.errorMessage="",a.file=null,a.uploadUrl="",a.isUploading=!1,a.isLoading=!1,a.progress=0,a.preview=!1,a.newPost={branchids:[f.getInputArgs().branchid],nsfw:!1},a.getProxyUrl=function(a){return a&&"http:"===a.substring(0,5)?d.apiEndpoint+"proxy?url="+a:a},a.postType={items:["TEXT","PAGE","IMAGE","VIDEO","AUDIO"],idx:0,title:"POST TYPE"},a.togglePreview=function(){a.preview=!a.preview},a.setFile=function(b){a.file=b},a.upload=function(b){c({method:"GET",url:d.apiEndpoint+"post/"+b+"/picture-upload-url"}).then(function(b){b&&b.data&&b.data.data?(a.uploadUrl=b.data.data,e.http({url:a.uploadUrl,method:"PUT",headers:{"Content-Type":"image/*"},data:a.file}).then(function(b){a.file=null,a.isUploading=!1,a.progress=0,f.OK()},function(b){a.file=null,a.isUploading=!1,a.progress=0,a.errorMessage="Unable to upload photo!"},function(b){a.progress=Math.min(100,parseInt(100*b.loaded/b.total))})):a.errorMessage="Unable to upload photo!"},function(){a.errorMessage="Unable to upload photo!"})},a.$on("OK",function(){if(!(a.newPost&&a.newPost.title&&a.newPost.branchids&&0!==a.newPost.branchids.length&&a.newPost.text&&void 0!==a.newPost.nsfw))return void b(function(){a.errorMessage="Please fill in all fields"});a.isLoading=!0,a.newPost.type=a.postType.items[a.postType.idx].toLowerCase();var c=JSON.parse(JSON.stringify(a.newPost));c.branchids=JSON.stringify(a.newPost.branchids),g.create(c).then(function(c){b(function(){a.errorMessage="",a.isLoading=!1,a.progress=0,a.file&&"image"!=a.newPost.type?(a.isUploading=!0,a.upload(c)):f.OK()})},function(c){b(function(){a.errorMessage=c.message,a.isLoading=!1})})}),a.$on("Cancel",function(){b(function(){a.errorMessage="",a.isLoading=!1,f.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalDeletePostController",["$scope","$timeout","Modal","Post","Alerts",function(a,b,c,d,e){a.Modal=c,a.errorMessage="",a.isLoading=!1,a.$on("OK",function(){a.isLoading=!0,d["delete"](c.getInputArgs().postid).then(function(){e.push("success","Your post was deleted."),a.isLoading=!1,c.OK()},function(b){a.isLoading=!1,e.push("error","Error deleting your post!"),c.Cancel()})}),a.$on("Cancel",function(){b(function(){a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalFlagPostController",["$scope","$timeout","Modal","Post","Alerts",function(a,b,c,d,e){a.errorMessage="",a.isLoading=!1,a.branchid=c.getInputArgs().branchid,a.flagItems=["AGAINST THE BRANCH RULES","AGAINST SITE RULES","NOT A "+c.getInputArgs().post.type.toUpperCase()+" POST"],c.getInputArgs().post.nsfw||a.flagItems.push("NSFW"),a.selectedFlagItemIdx=0,a.$on("OK",function(){a.isLoading=!0;var e,f=c.getInputArgs().post;switch(a.selectedFlagItemIdx){case 0:e="branch_rules";break;case 1:e="site_rules";break;case 2:e="wrong_type";break;case 3:e="nsfw";break;default:return a.errorMessage="Unknown flag type.",void(a.isLoading=!1)}d.flag(f.id,a.branchid,e).then(function(){b(function(){a.errorMessage="",a.isLoading=!1,c.OK()})},function(c){b(function(){a.errorMessage=c.message,a.isLoading=!1})})}),a.$on("Cancel",function(){b(function(){a.errorMessage="",a.isLoading=!1,c.Cancel()})}),a.close=function(){b(function(){a.errorMessage="",a.isLoading=!1,c.Cancel()})}}]);var app=angular.module("wecoApp");app.controller("modalResolveFlagPostController",["$scope","$timeout","Modal","Post","Branch","Alerts",function(a,b,c,d,e,f){a.errorMessage="",a.isLoading=!1,a.post=c.getInputArgs().post,a.text={reason:""},a.postTypeItems=["TEXT","IMAGE","VIDEO","AUDIO","PAGE"],a.selectedPostTypeItemIdx=0,a.resolveItems=["CHANGE POST TYPE","REMOVE POST","MARK AS NSFW","APPROVE POST"],a.selectedResolveItemIdx=0,a.reasonItems=["VIOLATING BRANCH RULES","VIOLATING SITE RULES"],a.selectedReasonItemIdx=0,a.$on("OK",function(){a.isLoading=!0;var d,g;switch(a.selectedResolveItemIdx){case 0:d="change_type",g=a.postTypeItems[a.selectedPostTypeItemIdx].toLowerCase();break;case 1:if(d="remove",0===a.selectedReasonItemIdx)g="branch_rules";else{if(1!==a.selectedReasonItemIdx)return void f.push("error","Unknown reason.");g="site_rules"}break;case 2:d="mark_nsfw";break;case 3:d="approve";break;default:return void f.push("error","Unknown action.")}return"remove"!==d||a.text.reason&&0!==a.text.reason.length?void e.resolveFlaggedPost(a.post.branchid,a.post.id,d,g,a.text.reason).then(function(){b(function(){a.errorMessage="",a.isLoading=!1,c.OK()})})["catch"](function(c){b(function(){a.errorMessage=c.message,a.isLoading=!1})}):void b(function(){a.errorMessage="Please provide an explanatory message for the OP",a.isLoading=!1})}),a.$on("Cancel",function(){b(function(){a.errorMessage="",a.isLoading=!1,c.Cancel()})}),a.close=function(){b(function(){a.errorMessage="",a.isLoading=!1,c.Cancel()})}}]);var app=angular.module("wecoApp");app.controller("modalProfileSettingsController",["$scope","$timeout","Modal","User",function(a,b,c,d){a.Modal=c,a.values=[],a.errorMessage="",a.isLoading=!1,a.$on("OK",function(){if(a.values.length<c.getInputArgs().inputs.length||a.values.indexOf("")>-1)return void b(function(){a.errorMessage="Please fill in all fields"});for(var e={},f=0;f<c.getInputArgs().inputs.length;f++)e[c.getInputArgs().inputs[f].fieldname]=a.values[f],"date"==c.getInputArgs().inputs[f].type&&(e[c.getInputArgs().inputs[f].fieldname]=new Date(a.values[f]).getTime());a.isLoading=!0,d.update(e).then(function(){b(function(){a.values=[],a.errorMessage="",a.isLoading=!1,c.OK()})},function(c){b(function(){a.errorMessage=c.message,a.isLoading=!1})})}),a.$on("Cancel",function(){b(function(){a.values=[],a.errorMessage="",a.isLoading=!1,c.Cancel()})})}]);var app=angular.module("wecoApp");app.controller("modalUploadImageController",["$scope","$timeout","Modal","$http","ENV","Upload",function(a,b,c,d,e,f){a.Modal=c,a.errorMessage="",a.uploadUrl="",a.file=null,a.isUploading=!1,a.progress=0,a.$watch(function(){return c.isOpen()},function(b){b&&d({method:"GET",url:e.apiEndpoint+c.getInputArgs().route+c.getInputArgs().type+"-upload-url"}).then(function(b){b&&b.data&&b.data.data?a.uploadUrl=b.data.data:a.errorMessage="Unable to upload photo!"},function(){a.errorMessage="Unable to upload photo!"})}),a.setFile=function(b){a.file=b},a.upload=function(){return a.file?void f.http({url:a.uploadUrl,method:"PUT",headers:{"Content-Type":"image/*"},data:a.file}).then(function(b){a.file=null,a.isUploading=!1,a.progress=0,c.OK()},function(b){a.file=null,a.isUploading=!1,a.progress=0,a.errorMessage="Unable to upload photo!"},function(b){a.progress=Math.min(100,parseInt(100*b.loaded/b.total))}):void(a.errorMessage="No file selected!")},a.$on("Cancel",function(){b(function(){a.file=null,a.errorMessage="",c.Cancel()})}),a.$on("OK",function(){return a.file?void b(function(){a.errorMessage="",a.isUploading=!0,a.progress=0,a.upload()}):void(a.errorMessage="No file selected!")})}]);var app=angular.module("wecoApp");app.directive("navBar",["User","$state","$timeout","socket","Alerts",function(a,b,c,d,e){return{restrict:"E",replace:"true",templateUrl:"/app/components/nav/nav.view.html",link:function(f,g,h){function i(){a.me().username&&a.getNotifications(a.me().username,!0).then(function(a){c(function(){f.notificationCount=a})},function(a){e.push("error","Error fetching notifications.")})}f.user=a.me,f.logout=function(){f.expanded=!1,a.logout().then(function(){b.go("auth.login")},function(){e.push("error","Unable to log out.")})},f.isControlSelected=function(a){return b.current.name.indexOf(a)>-1&&"root"==b.params.branchid},f.onHomePage=function(){return"weco.home"==b.current.name},f.expanded=!1,f.isNavExpanded=function(){return f.expanded},f.toggleNav=function(){f.expanded=!f.expanded},f.notificationCount=0,f.$watch(function(){return a.me().username},function(){i()}),f.$on("$stateChangeSuccess",i),d.on("notification","notifications",i),f.showNotificationCount=function(){return f.notificationCount>0};var j="";f.triggerAnimation=function(){c(function(){j="/assets/images/logo-animation.gif"}),c(function(){j=""},1e3)},f.getAnimationSrc=function(){return j}}}}]);var app=angular.module("wecoApp");app.directive("onScrollToBottom",function(){return{restrict:"A",link:function(a,b,c){var d=a.$eval(c.onScrollToBottom);b.on("scroll",function(c){b[0].scrollTop+b[0].offsetHeight>=b[0].scrollHeight&&a.$apply(d)})}}});var app=angular.module("wecoApp");app.directive("scrollToTopWhen",["$rootScope","$timeout",function(a,b){return{link:function(c,d,e){a.$on(e.scrollToTopWhen,function(){b(function(){angular.element(d)[0].scrollTop=0})})}}}]);var app=angular.module("wecoApp");app.directive("tabs",["$state",function(a){return{restrict:"E",replace:"true",scope:{items:"&",states:"&",callbacks:"="},templateUrl:"/app/components/tabs/tabs.view.html",link:function(b,c,d){b.isSelected=function(c){var d,e,f=b.states()[c].indexOf("("),g=b.states()[c].indexOf(")");if(f>-1&&g>-1)try{d=JSON.parse(b.states()[c].substr(f+1,b.states()[c].length-f-2)),e=b.states()[c].substr(0,f)}catch(h){console.error("Unable to parse JSON!")}return d&&e?a.current.name==e&&JSON.stringify(d)==JSON.stringify(a.params):a.current.name==b.states()[c]}}}}]);var app=angular.module("wecoApp");app.directive("tagEditor",["$timeout",function(a){return{restrict:"E",replace:"true",templateUrl:"/app/components/tag-editor/tag-editor.view.html",scope:{items:"=",title:"&",max:"&"},link:function(a,b,c){a.errorMessage="",a.data={},a.addItem=function(){if(a.errorMessage="",!(a.items.length>=a.max())&&a.data.item){if(/\s/g.test(a.data.item))return void(a.errorMessage="Cannot contain spaces.");a.data.item=a.data.item.toLowerCase(),a.items.indexOf(a.data.item)>-1||(a.items.push(a.data.item),a.data.item=void 0)}},a.removeItem=function(b){a.errorMessage="",a.items.indexOf(b)>-1&&a.items.splice(a.items.indexOf(b),1)}}}}]);var app=angular.module("wecoApp");app.directive("tooltip",["$rootScope",function(a){return{restrict:"E",replace:!1,scope:{},templateUrl:"/app/components/tooltip/tooltip.view.html",link:function(b,c){b.text=function(){return a.tooltip.text},b.x=function(){return a.tooltip.x},b.y=function(){return a.tooltip.y},b.show=function(){return a.tooltip.show}}}}]),app.directive("tooltipText",["$rootScope","$window","$timeout",function(a,b,c){return{restrict:"A",scope:{tooltipText:"="},link:function(d,e,f){var g=e[0],h=d.$eval(f.offsetX),i=d.$eval(f.offsetY);h||(h=0),i||(i=0),g.addEventListener("mouseover",function(){c(function(){a.tooltip.show=!0,a.tooltip.text=d.tooltipText,a.tooltip.x=g.getBoundingClientRect().left+b.pageXOffset+h,a.tooltip.y=g.getBoundingClientRect().top+b.pageYOffset+i})},!1),g.addEventListener("mouseout",function(){c(function(){a.tooltip.show=!1})})}}}]);var app=angular.module("wecoApp");app.controller("writeCommentController",["$scope","$timeout","Comment","Alerts",function(a,b,c,d){a.isLoading=!1,a.comment={text:""},a.postComment=function(){b(function(){a.isLoading=!0}),a.comment.postid=a.postid(),a.comment.parentid=a.parentid(),a.update?c.update(a.comment.postid,a.comment.parentid,a.comment.text).then(function(){b(function(){a.isLoading=!1,a.comment={text:""},a.onSubmit(a.comment.id)})},function(c){d.push("error","Error editing comment."),b(function(){a.isLoading=!1})}):c.create(a.comment).then(function(c){b(function(){a.isLoading=!1,a.comment={text:""},a.onSubmit(c)})},function(c){d.push("error","Error posting comment."),b(function(){a.isLoading=!1})})},a.cancelComment=function(){b(function(){a.isLoading=!1,a.comment={text:""},a.onCancel()})}}]);var app=angular.module("wecoApp");app.directive("writeComment",function(){return{restrict:"E",replace:!0,scope:{parentid:"&",postid:"&",onSubmit:"=",onCancel:"=",update:"=",placeholder:"&"},templateUrl:"/app/components/write-comment/write-comment.view.html",controller:"writeCommentController"}}),angular.module("config",[]).constant("ENV",{name:"development",apiEndpoint:"http://api-dev.eu9ntpt33z.eu-west-1.elasticbeanstalk.com/v1/"});var api=angular.module("api",["ngResource"]);api.config(["$httpProvider",function(a){a.defaults.withCredentials=!0}]);var api=angular.module("api");api.factory("BranchPostsAPI",["$resource","ENV",function(a,b){function c(a,b){var c=[];for(var d in a)c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.join("&")}return a(b.apiEndpoint+"branch/:branchid/posts/:postid",{branchid:"@branchid",postid:""},{vote:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c}})}]);var api=angular.module("api");api.factory("BranchAPI",["$resource","ENV",function(a,b){function c(a,b){
var c=[];for(var d in a)c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.join("&")}return a(b.apiEndpoint+"branch/:branchid",{},{update:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c}})}]);var api=angular.module("api");api.factory("CommentAPI",["$resource","ENV",function(a,b){function c(a,b){var c=[];for(var d in a)c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.join("&")}return a(b.apiEndpoint+"post/:postid/comments/:commentid",{postid:"@postid",commentid:""},{vote:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c},update:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c}})}]);var api=angular.module("api");api.factory("ModLogAPI",["$resource","ENV",function(a,b){return a(b.apiEndpoint+"branch/:branchid/modlog",{},{})}]);var api=angular.module("api");api.factory("ModsAPI",["$resource","ENV",function(a,b){return a(b.apiEndpoint+"branch/:branchid/mods/:username",{},{})}]);var api=angular.module("api");api.factory("PostAPI",["$resource","ENV",function(a,b){return a(b.apiEndpoint+"post/:postid",{},{})}]);var api=angular.module("api");api.factory("SubbranchRequestAPI",["$resource","ENV",function(a,b){function c(a,b){var c=[];for(var d in a)c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.join("&")}return a(b.apiEndpoint+"branch/:branchid/requests/subbranches/:childid",{branchid:"@branchid",childid:"@childid"},{getAll:{method:"GET",params:{childid:""},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c},accept:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c},reject:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c}})}]);var api=angular.module("api");api.factory("SubbranchesAPI",["$resource","ENV",function(a,b){return a(b.apiEndpoint+"branch/:branchid/subbranches",{branchid:"@branchid"},{})}]);var api=angular.module("api");api.factory("UserNotificationsAPI",["$resource","ENV",function(a,b){function c(a,b){var c=[];for(var d in a)c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.join("&")}return a(b.apiEndpoint+"user/:username/notifications/:notificationid",{username:"@username",notificationid:""},{update:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c}})}]);var api=angular.module("api");api.factory("UserAPI",["$resource","ENV",function(a,b){function c(a,b){var c=[];for(var d in a)c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c.join("&")}return a(b.apiEndpoint+"user/:param",{param:"me"},{login:{method:"POST",params:{param:"login"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c},logout:{method:"GET",params:{param:"logout"}},signup:{method:"POST",params:{param:""}},update:{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:c}})}]);var app=angular.module("wecoApp");app.factory("Branch",["BranchAPI","SubbranchesAPI","ModLogAPI","SubbranchRequestAPI","BranchPostsAPI","$http","$state","ENV",function(a,b,c,d,e,f,g,h){var i={};return i.getPictureUrl=function(a,b,c){return"picture"!=b&&"cover"!=b&&(b="picture"),f({method:"GET",url:h.apiEndpoint+"branch/"+a+"/"+b+(c?"-thumb":"")})},i.get=function(b){return new Promise(function(c,d){a.get({branchid:b},function(a){return a&&a.data?void i.getPictureUrl(b,"picture",!1).then(function(c){return c&&c.data&&c.data.data&&(a.data.profileUrl=c.data.data),i.getPictureUrl(b,"picture",!0)},function(){return i.getPictureUrl(b,"picture",!0)}).then(function(c){return c&&c.data&&c.data.data&&(a.data.profileUrlThumb=c.data.data),i.getPictureUrl(b,"cover",!1)},function(){return i.getPictureUrl(b,"cover",!1)}).then(function(c){return c&&c.data&&c.data.data&&(a.data.coverUrl=c.data.data),i.getPictureUrl(b,"cover",!0)},function(){return i.getPictureUrl(b,"cover",!0)}).then(function(b){b&&b.data&&b.data.data&&(a.data.coverUrlThumb=b.data.data),c(a.data)},function(){c(a.data)}):d()},function(a){d({status:a.status,message:a.data.message})})})},i.update=function(b){return new Promise(function(c,d){a.update({branchid:g.params.branchid},b,function(){c()},function(a){d({status:a.status,message:a.data.message})})})},i.create=function(b){return new Promise(function(c,d){a.save(b,function(){c()},function(a){d({status:a.status,message:a.data.message})})})},i["delete"]=function(b){return new Promise(function(c,d){a["delete"]({branchid:b},function(){c()},function(a){d({status:a.status,message:a.data.message})})})},i.getSubbranches=function(a,c,d,e){return new Promise(function(f,g){var h={branchid:a,timeafter:c,sortBy:d};e&&(h.lastBranchId=e),b.get(h,function(a){a&&a.data?f(a.data):g({status:500,message:"Something went wrong"})},function(a){g({status:a.status,message:a.data.message})})})},i.getModLog=function(a){return new Promise(function(b,d){c.get({branchid:a},function(a){a&&a.data?b(a.data):d({status:500,message:"Something went wrong"})},function(a){d({status:a.status,message:a.data.message})})})},i.submitSubbranchRequest=function(a,b){return new Promise(function(c,e){d.save({branchid:a,childid:b},function(){c()},function(a){e({status:a.status,message:a.data.message})})})},i.getSubbranchRequests=function(a){return new Promise(function(b,c){d.getAll({branchid:a},function(a){a&&a.data?b(a.data):c({status:500,message:"Something went wrong"})},function(a){c({status:a.status,message:a.data.message})})})},i.actionSubbranchRequest=function(a,b,c){return new Promise(function(e,f){function g(a){f({status:a.status,message:a.data.message})}if("accept"==a)d.accept({branchid:b,childid:c},{action:a},e,g);else{if("reject"!=a)return f({status:400,message:"Invalid action"});d.reject({branchid:b,childid:c},{action:a},e,g)}})},i.getPosts=function(a,b,c,d,f,g){return new Promise(function(h,i){var j={branchid:a,timeafter:b,sortBy:c,stat:d,postType:f};g&&(j.lastPostId=g),e.get(j,function(a){a&&a.data?h(a.data):i({status:500,message:"Something went wrong"})},function(a){i({status:a.status,message:a.data.message})})})},i.getFlaggedPosts=function(a,b,c){return new Promise(function(d,f){e.get({branchid:a,timeafter:b,sortBy:c,flag:!0},function(a){a&&a.data?d(a.data):f({status:500,message:"Something went wrong"})},function(a){f({status:a.status,message:a.data.message})})})},i.resolveFlaggedPost=function(a,b,c,d,e){return new Promise(function(g,i){var j={};j.action=c,j["change_type"===c?"type":"reason"]=d,j.message=e;var k=h.apiEndpoint+"branch/"+a+"/posts/"+b+"/resolve";f.post(k,j).then(g,function(a){i({status:a.status,message:a.data.message})})})},i}]);var app=angular.module("wecoApp");app.factory("Comment",["CommentAPI","$http","$state","ENV",function(a,b,c,d){var e={};return e.create=function(b){return new Promise(function(c,d){a.save(b,function(a){c(a.data)},function(a){d({status:a.status,message:a.data.message})})})},e.getMany=function(b,c,d,e){return new Promise(function(f,g){var h={postid:b,parentid:c,sort:d};e&&(h.lastCommentId=e),a.get(h,function(a){return a&&a.data?void f(a.data):g()},function(a){g({status:a.status,message:a.data.message})})})},e.get=function(b,c){return new Promise(function(d,e){a.get({postid:b,commentid:c},function(a){return a&&a.data?void d(a.data):e()},function(a){e({status:a.status,message:a.data.message})})})},e.vote=function(b,c,d){return new Promise(function(e,f){return"up"!=d&&"down"!=d?f():void a.vote({postid:b,commentid:c},{vote:d},function(){e()},function(a){f({status:a.status,message:a.data.message})})})},e.update=function(b,c,d){return new Promise(function(e,f){a.update({postid:b,commentid:c},{text:d},function(){e()},function(a){f({status:a.status,message:a.data.message})})})},e}]);var app=angular.module("wecoApp");app.factory("Mod",["ModsAPI","$http","$state","ENV",function(a,b,c,d){var e={};return e.getByBranch=function(b){return new Promise(function(c,d){a.get({branchid:b}).$promise["catch"](function(a){d({status:a.status,message:a.data.message})}).then(function(a){a&&a.data?c(a.data):d({status:500,message:"Something went wrong"})})})},e.create=function(b,c){return new Promise(function(d,e){a.save({branchid:b},{username:c}).$promise["catch"](function(a){e({status:a.status,message:a.data.message})}).then(function(){d()})})},e["delete"]=function(b,c){return new Promise(function(d,e){a["delete"]({branchid:b,username:c}).$promise["catch"](function(a){e({status:a.status,message:a.data.message})}).then(function(){d()})})},e}]);var app=angular.module("wecoApp");app.factory("Post",["PostAPI","BranchPostsAPI","CommentAPI","$http","$state","ENV",function(a,b,c,d,e,f){var g={};return g.getPictureUrl=function(a,b){return d({method:"GET",url:f.apiEndpoint+"post/"+a+"/picture"+(b?"-thumb":"")})},g.create=function(b){return new Promise(function(c,d){a.save(b,function(a){c(a.data)},function(a){d({status:a.status,message:a.data.message})})})},g.get=function(b){return new Promise(function(c,d){a.get({postid:b},function(a){return a&&a.data?void g.getPictureUrl(b,!1).then(function(c){return c&&c.data&&c.data.data&&(a.data.profileUrl=c.data.data),g.getPictureUrl(b,!0)}).then(function(b){b&&b.data&&b.data.data&&(a.data.profileUrlThumb=b.data.data),c(a.data)},function(){c(a.data)}):d()},function(a){d({status:a.status,message:a.data.message})})})},g.vote=function(a,c,d){return new Promise(function(e,f){return"up"!=d&&"down"!=d?f():void b.vote({branchid:a,postid:c},{vote:d},e,function(a){f({status:a.status,message:a.data.message})})})},g["delete"]=function(b){return new Promise(function(c,d){a.remove({postid:b},c,function(a){d({status:a.status,message:a.data.message})})})},g.getPostOnBranch=function(a,c){return new Promise(function(d,e){b.get({postid:a,branchid:c},function(a){return a&&a.data?void d(a.data):e()},function(a){e({status:a.status,message:a.data.message})})})},g.flag=function(a,b,c){return new Promise(function(e,g){d.post(f.apiEndpoint+"post/"+a+"/flag",{flag_type:c,branchid:b}).then(e,function(a){g({status:a.status,message:a.data.message})})})},g}]);var app=angular.module("wecoApp");app.factory("User",["UserAPI","UserNotificationsAPI","$timeout","$http","ENV","socket",function(a,b,c,d,e,f){var g={},h={};return g.me=function(){return h||{}},g.get=function(b){return new Promise(function(c,d){a.get({param:b||"me"},function(a){return a&&a.data?void g.getPictureUrl(b||"me","picture",!1).then(function(c){return c&&c.data&&c.data.data&&(a.data.profileUrl=c.data.data),g.getPictureUrl(b||"me","picture",!0)},function(){return g.getPictureUrl(b||"me","picture",!0)}).then(function(c){return c&&c.data&&c.data.data&&(a.data.profileUrlThumb=c.data.data),g.getPictureUrl(b||"me","cover",!1)},function(){return g.getPictureUrl(b||"me","cover",!1)}).then(function(c){return c&&c.data&&c.data.data&&(a.data.coverUrl=c.data.data),g.getPictureUrl(b||"me","cover",!0)},function(){return g.getPictureUrl(b||"me","cover",!0)}).then(function(d){d&&d.data&&d.data.data&&(a.data.coverUrlThumb=d.data.data),b||(h=a.data),c(a.data)},function(){b||(h=a.data),c(a.data)}):d()},function(a){b||(h={}),d({status:a.status,message:a.data.message})})})},g.get().then(function(){},function(){}),g.getPictureUrl=function(a,b,c){return a||(a="me"),"picture"!=b&&"cover"!=b&&(b="picture"),d.get(e.apiEndpoint+"user/"+a+"/"+b+(c?"-thumb":""))},g.update=function(b){return new Promise(function(c,d){a.update(b,function(){c()},function(a){d({status:a.status,message:a.data.message})})})},g.login=function(b){return new Promise(function(c,d){a.login(b,function(){f.disconnect(),f.reconnect(),g.get().then(c,d)},function(a){d({status:a.status,message:a.data.message})})})},g.logout=function(){return new Promise(function(b,d){a.logout({},function(){c(function(){f.disconnect(),h={},b()})},function(a){d({status:a.status,message:a.data.message})})})},g.signup=function(b){return new Promise(function(c,d){a.signup(b,function(){c()},function(a){d({status:a.status,message:a.data.message})})})},g.getNotifications=function(a,c,d){return new Promise(function(e,f){b.get({username:a,unreadCount:c,lastNotificationId:d},function(a){return a&&a.data?e(a.data):c?e(0):f()},function(a){return console.error("Unable to fetch user notifications!"),f({status:a.status,message:a.data.message})})})},g.markNotification=function(a,c,d){return new Promise(function(e,f){b.update({username:a,notificationid:c},{unread:d},function(){e()},function(a){return console.error("Unable to mark notification!"),f({status:a.status,message:a.data.message})})})},g.subscribeToNotifications=function(a,c){return new Promise(function(d,e){b.update({username:a},{socketID:c},function(){d()},function(a){return console.error("Unable to mark notification!"),e({status:a.status,message:a.data.message})})})},g.unsubscribeFromNotifications=function(a){return new Promise(function(c,d){b["delete"]({username:a},function(){c()},function(a){d({status:a.status,message:a.data.message})})})},g.verify=function(a,b){return new Promise(function(c,f){d.get(e.apiEndpoint+"user/"+a+"/verify/"+b).then(c,function(a){f(a.data)})})},g.resendVerification=function(a){return new Promise(function(b,c){d.get(e.apiEndpoint+"user/"+a+"/reverify").then(b,function(a){c(a.data)})})},g.requestResetPassword=function(a){return new Promise(function(b,c){d.get(e.apiEndpoint+"user/"+a+"/reset-password").then(b,function(a){c(a.data)})})},g.resetPassword=function(a,b,c){return new Promise(function(f,g){d.post(e.apiEndpoint+"user/"+a+"/reset-password/"+c,{password:b}).then(f,function(a){g(a.data)})})},g}]);var app=angular.module("wecoApp");app.controller("authController",["$scope","$state","$timeout","User","Alerts",function(a,b,c,d,e){function f(){d.login(a.credentials).then(function(){a.isLoading=!1,a.loopAnimation=!1,b.go("weco.home")},function(b){c(function(){a.errorMessage=b.message,a.isLoading=!1,a.loopAnimation=!1,403==b.status&&(a.showResendVerification=!0)})})}function g(){d.signup(a.credentials).then(function(){a.isLoading=!1,a.loopAnimation=!1,b.go("weco.home"),e.push("success","Check your inbox to verify your account!",!0)},function(b){c(function(){a.errorMessage=b.message,a.isLoading=!1,a.loopAnimation=!1})})}a.credentials={},a.user=d.me,a.isLoading=!1,a.loopAnimation=!1,a.errorMessage="",a.showResendVerification=!1,a.isLoginForm=function(){return"auth.login"==b.current.name},a.submit=function(){a.isLoading=!0,a.loopAnimation=!0,a.triggerAnimation(),a.credentials.username=a.credentials.username.toLowerCase(),a.isLoginForm()?f():g()},a.resendVerification=function(){a.isLoading=!0,d.resendVerification(a.credentials.username).then(function(){e.push("success","Verification email sent. Keep an eye on your inbox!",!0),c(function(){a.errorMessage="",a.isLoading=!1,a.showResendVerification=!1})},function(){e.push("error","Unable to resend verification email!",!0),c(function(){a.errorMessage="",a.isLoading=!1,a.showResendVerification=!1})})};var h="/assets/images/logo-animation-large.gif";a.triggerAnimation=function(){""!==h&&c(function(){h=""}),c(function(){h="/assets/images/logo-animation-large.gif"}),c(function(){h="",a.loopAnimation&&a.triggerAnimation()},1e3)},a.getAnimationSrc=function(){return h}}]);var app=angular.module("wecoApp");app.controller("branchController",["$scope","$rootScope","$state","$timeout","Branch","Mod","User","Modal","Alerts",function(a,b,c,d,e,f,g,h,i){function j(){h.open("/app/components/modals/branch/create/create-branch.modal.view.html",{branchid:a.branchid}).then(function(a){a&&(h.getOutputArgs()&&h.getOutputArgs().branchid?c.go("weco.branch.subbranches",{branchid:h.getOutputArgs().branchid},{reload:!0}):c.go(c.current,{},{reload:!0}))},function(){i.push("error","Unable to create new branch.")})}function k(){h.open("/app/components/modals/post/create/create-post.modal.view.html",{branchid:a.branchid}).then(function(a){a&&(h.getOutputArgs()&&h.getOutputArgs().branchid?c.go("weco.branch.wall",{branchid:h.getOutputArgs().branchid},{reload:!0}):c.go(c.current,{},{reload:!0}))},function(){i.push("error","Unable to create new post.")})}a.branchid=c.params.branchid,a.showCover=!0,a.isLoading=!0,a.showCoverPicture=function(){a.showCover=!0},a.hideCoverPicture=function(){a.showCover=!1},a.timeItems=["ALL TIME","THIS YEAR","THIS MONTH","THIS WEEK","LAST 24 HRS","THIS HOUR"],a.getTimeafter=function(a){var b,c=new Date;switch(a){case"ALL TIME":b=0;break;case"THIS YEAR":b=new Date(c.getFullYear(),0,1,0,0,0,0).getTime();break;case"THIS MONTH":b=new Date(c.getFullYear(),c.getMonth(),1,0,0,0,0).getTime();break;case"THIS WEEK":b=new Date(c.getFullYear(),c.getMonth(),c.getDate()-c.getDay()+1,0,0,0,0).getTime();break;case"LAST 24 HRS":var d=new Date(c);d.setDate(c.getDate()-1),b=new Date(c.getFullYear(),c.getMonth(),d.getDate(),c.getHours(),0,0,0).getTime();break;case"THIS HOUR":b=new Date(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours(),0,0,0).getTime()}return b},a.isControlSelected=function(a){return c.current.name.indexOf(a)>-1},a.branch={},a.parent={},e.get(c.params.branchid).then(function(b){return d(function(){a.branch=b}),f.getByBranch(a.branchid)},function(a){404==a.status&&c.go("weco.notfound")}).then(function(b){return d(function(){a.branch.mods=b,a.isLoading=!1}),e.get(a.branch.parentid)}).then(function(b){d(function(){a.parent=b})},function(b){d(function(){a.isLoading=!1})}),a.openProfilePictureModal=function(){h.open("/app/components/modals/upload/upload-image.modal.view.html",{route:"branch/"+a.branchid+"/",type:"picture"}).then(function(a){a&&c.go(c.current,{},{reload:!0})},function(){i.push("error","Unable to update profile picture.")})},a.openCoverPictureModal=function(){h.open("/app/components/modals/upload/upload-image.modal.view.html",{route:"branch/"+a.branchid+"/",type:"cover"}).then(function(a){a&&c.go(c.current,{},{reload:!0})},function(){i.push("error","Unable to update cover picture.")})},a.addContent=function(){switch(c.current.name){case"weco.branch.subbranches":j();break;case"weco.branch.wall":k();break;case"weco.branch.post":b.$broadcast("add-comment");break;default:console.error("Unable to add content in state "+c.current.name)}},a.getAddContentTooltip=function(){switch(c.current.name){case"weco.branch.subbranches":return"Create New Branch";case"weco.branch.wall":return"Add New Post";case"weco.branch.post":return"Write a Comment";default:return""}},a.canAddContent=function(){switch(c.current.name){case"weco.branch.subbranches":case"weco.branch.wall":case"weco.branch.post":return!0;default:return!1}},a.isModerator=function(){if(!a.branch.mods)return!1;for(var b=0;b<a.branch.mods.length;b++)if(a.branch.mods[b].username==g.me().username)return!0;return!1}}]);var app=angular.module("wecoApp");app.controller("nucleusFlaggedPostsController",["$scope","$state","$timeout","Branch","Post","Alerts","Modal",function(a,b,c,d,e,f,g){function h(b){var e,g=a.getTimeafter(a.timeItems[a.selectedTimeItemIdx]);switch(a.sortByItems[a.selectedSortByItemIdx]){case"DATE":e="date";break;case"BRANCH RULES FLAGS":e="branch_rules";break;case"SITE RULES FLAGS":e="site_rules";break;case"WRONG TYPE FLAGS":e="wrong_type";break;case"NSFW FLAGS":e="nsfw";break;default:e="date"}var h=a.postTypeItems[a.selectedPostTypeItemIdx].toLowerCase();d.getFlaggedPosts(a.branchid,g,e,null,h,b).then(function(d){c(function(){b?a.posts=a.posts.concat(d):a.posts=d,a.isLoading=!1,a.isLoadingMore=!1})},function(){f.push("error","Error fetching posts."),a.isLoading=!1})}a.isLoading=!1,a.isLoadingMore=!1,a.posts=[],a.postTypeItems=["ALL","TEXT","IMAGE","VIDEO","AUDIO","PAGE"],a.selectedPostTypeItemIdx=0,a.$watch("selectedPostTypeItemIdx",function(){c(function(){a.isLoading=!0,a.posts=[],h()})}),a.sortByItems=["DATE","BRANCH RULES FLAGS","SITE RULES FLAGS","WRONG TYPE FLAGS","NSFW FLAGS"],a.selectedSortByItemIdx=0,a.$watch("selectedSortByItemIdx",function(){c(function(){a.isLoading=!0,a.posts=[],h()})}),a.timeItems=["ALL TIME","THIS YEAR","THIS MONTH","THIS WEEK","LAST 24 HRS","THIS HOUR"],a.selectedTimeItemIdx=0,a.$watch("selectedTimeItemIdx",function(){c(function(){a.isLoading=!0,a.posts=[],h()})}),a.getTimeafter=function(a){var b,c=new Date;switch(a){case"ALL TIME":b=0;break;case"THIS YEAR":b=new Date(c.getFullYear(),0,1,0,0,0,0).getTime();break;case"THIS MONTH":b=new Date(c.getFullYear(),c.getMonth(),1,0,0,0,0).getTime();break;case"THIS WEEK":b=new Date(c.getFullYear(),c.getMonth(),c.getDate()-c.getDay()+1,0,0,0,0).getTime();break;case"LAST 24 HRS":var d=new Date(c);d.setDate(c.getDate()-1),b=new Date(c.getFullYear(),c.getMonth(),d.getDate(),c.getHours(),0,0,0).getTime();break;case"THIS HOUR":b=new Date(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours(),0,0,0).getTime()}return b},a.loadMore=function(){a.isLoadingMore||(a.isLoadingMore=!0,a.posts.length>0&&h(a.posts[a.posts.length-1].id))},a.openResolveFlagPostModal=function(b){g.open("/app/components/modals/post/flag/resolve/resolve-flag-post.modal.view.html",{post:b}).then(function(b){b&&(f.push("success","Done."),c(function(){a.isLoading=!0,a.posts=[],h()}))},function(){f.push("error","Error resolving flags on post.")})}}]);var app=angular.module("wecoApp");app.controller("nucleusModeratorsController",["$scope","$state","$timeout","User","Branch","Alerts",function(a,b,c,d,e,f){a.mods=[],a.isLoading=!0,a.getMod=function(b,e){var g=d.get(b);return g.then(function(b){c(function(){a.mods[e]=b})},function(){f.push("error","Error fetching moderator.")}),g};for(var g=[],h=0;h<a.branch.mods.length;h++)g.push(a.getMod(a.branch.mods[h].username,h));Promise.all(g).then(function(){a.isLoading=!1},function(){f.push("error","Error fetching moderators."),a.isLoading=!1})}]);var app=angular.module("wecoApp");app.controller("nucleusModToolsController",["$scope","$state","$timeout","Modal","User","Branch","Alerts",function(a,b,c,d,e,f,g){a.isLoading=!0,a.isModLogOpen=!1,a.toggleIsModLogOpen=function(){a.isModLogOpen=!a.isModLogOpen},a.modLog=[],f.getModLog(a.branchid).then(function(b){c(function(){a.modLog=b,a.isLoading=!1})},function(){g.push("error","Error fetching moderator action log."),a.isLoading=!1}),a.openAddModModal=function(){d.open("/app/components/modals/branch/nucleus/modtools/add-mod/add-mod.modal.view.html",{branchid:a.branchid}).then(function(a){a&&b.go(b.current,{},{reload:!0})},function(){g.push("error","Error updating moderator settings.")})},a.openRemoveModModal=function(){for(var c,f=0;f<a.branch.mods.length;f++)a.branch.mods[f].username==e.me().username&&(c=a.branch.mods[f]);for(var h=[],f=0;f<a.branch.mods.length;f++)a.branch.mods[f].username===c.username&&a.branch.mods.length>1?h.push(a.branch.mods[f]):a.branch.mods[f].date>c.date&&h.push(a.branch.mods[f]);d.open("/app/components/modals/branch/nucleus/modtools/remove-mod/remove-mod.modal.view.html",{branchid:a.branchid,mods:h}).then(function(a){d.getOutputArgs().removedMod==c.username?b.go("weco.branch.nucleus.about",{},{reload:!0}):a&&b.go(b.current,{},{reload:!0})},function(){g.push("error","Error updating moderator settings.")})},a.openSubmitSubbranchRequestModal=function(){d.open("/app/components/modals/branch/nucleus/modtools/submit-subbranch-request/submit-subbranch-request.modal.view.html",{branchid:a.branchid}).then(function(a){a&&b.go(b.current,{},{reload:!0})},function(){g.push("error","Error submitting child branch request.")})},a.openReviewSubbranchRequestsModal=function(){d.open("/app/components/modals/branch/nucleus/modtools/review-subbranch-requests/review-subbranch-requests.modal.view.html",{branchid:a.branchid}).then(function(a){a&&b.go(b.current,{},{reload:!0})},function(){g.push("error","Error responding to child branch request.")})},a.openDeleteBranchModal=function(){d.open("/app/components/modals/branch/nucleus/modtools/delete-branch/delete-branch.modal.view.html",{}).then(function(a){a&&b.go(b.current,{},{reload:!0})},function(){g.push("error","Error deleting branch.")})}}]);var app=angular.module("wecoApp");app.controller("nucleusController",["$scope","$state","$timeout","Branch","User",function(a,b,c,d,e){a.tabItems=["about","moderators"],a.tabStates=['weco.branch.nucleus.about({ "branchid": "'+a.branchid+'"})','weco.branch.nucleus.moderators({ "branchid": "'+a.branchid+'"})'],a.$watch(a.isModerator,function(){if(a.branch.mods)for(var b=0;b<a.branch.mods.length;b++)a.branch.mods[b].username==e.me().username&&(a.tabItems.indexOf("settings")==-1&&(a.tabItems.push("settings"),a.tabStates.push('weco.branch.nucleus.settings({ "branchid": "'+a.branchid+'"})')),a.tabItems.indexOf("mod tools")==-1&&(a.tabItems.push("mod tools"),a.tabStates.push('weco.branch.nucleus.modtools({ "branchid": "'+a.branchid+'"})')),a.tabItems.indexOf("flagged posts")==-1&&(a.tabItems.push("flagged posts"),a.tabStates.push('weco.branch.nucleus.flaggedposts({ "branchid": "'+a.branchid+'"})')))}),a.addHTMLLineBreaks=function(a){if(a)return a.split("\n").join("<br>")}}]);var app=angular.module("wecoApp");app.controller("nucleusSettingsController",["$scope","$state","$timeout","Modal","Alerts",function(a,b,c,d,e){function f(a){d.open("/app/components/modals/branch/nucleus/settings/settings.modal.view.html",a).then(function(a){a&&b.go(b.current,{},{reload:!0})},function(){e.push("error","Error updating branch settings.")})}a.openVisibleNameModal=function(){f({title:"Visible Name",inputs:[{placeholder:"Visible name",type:"text",fieldname:"name"}],textareas:[]})},a.openRulesModal=function(){f({title:"Rules & Etiquette",inputs:[],textareas:[{placeholder:"Rules & Etiquette Text",fieldname:"rules"}]})},a.openDescriptionModal=function(){f({title:"Description",inputs:[],textareas:[{placeholder:"Description",fieldname:"description"}]})}}]);var app=angular.module("wecoApp");app.controller("postController",["$scope","$rootScope","$state","$timeout","Post","Comment","Alerts","User","Modal","ENV",function(a,b,c,d,e,f,g,h,i,j){function k(a){if(a&&""!==a){var b=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=|\?v=)([^#\&\?]*).*/,c=a.match(b);if(c&&11==c[2].length)return!0}return!1}function l(b){if(a.isCommentPermalink())f.get(c.params.postid,c.params.commentid).then(function(b){d(function(){a.comments=[b],a.isLoadingComments=!1})},function(b){404!=b.status&&g.push("error","Error loading comments."),a.isLoadingComments=!1});else{var e=a.sortItems[a.selectedSortItemIdx].toLowerCase();f.getMany(c.params.postid,void 0,e,b).then(function(c){d(function(){b?a.comments=a.comments.concat(c):a.comments=c,a.isLoadingMore=!1,a.isLoadingComments=!1})},function(b){404!=b.status&&g.push("error","Error loading comments."),a.isLoadingComments=!1})}}a.isLoadingPost=!0,a.isLoadingComments=!0,a.isLoadingMore=!1,a.post={},a.comments=[],a.markdownRaw="",a.videoEmbedURL="",a.previewState="show",a.getProxyUrl=function(a){return a&&"http:"===a.substring(0,5)?j.apiEndpoint+"proxy?url="+a:a},a.isOwnPost=function(){return!(!a.post||!a.post.data)&&h.me().username==a.post.data.creator},a.openDeletePostModal=function(){i.open("/app/components/modals/post/delete/delete-post.modal.view.html",{postid:a.post.id}).then(function(a){a&&c.go("weco.home")},function(){g.push("error","Unable to delete post.")})},a.sortItems=["POINTS","REPLIES","DATE"],a.selectedSortItemIdx=0,a.$watch("selectedSortItemIdx",function(){d(function(){a.isLoadingComments=!0,a.comments=[],l()})}),a.onSubmitComment=function(){d(function(){a.isLoadingComments=!0,a.comments=[],l()})},a.isCommentPermalink=function(){return"weco.branch.post.comment"==c.current.name},a.setPreviewState=function(b){a.previewState=b},a.vote=function(a,b){e.vote("root",a.id,b).then(function(){var c="up"==b?1:-1;d(function(){a.individual+=c,a.local+=c,a.global+=c}),g.push("success","Thanks for voting!")},function(a){400===a.status?g.push("error","You have already voted on this post."):g.push("error","Error voting on post.")})},e.getPostOnBranch(c.params.postid,a.branchid).then(function(){return e.get(c.params.postid)},function(){c.go("weco.notfound")}).then(function(b){d(function(){if(a.post=b,a.markdownRaw=b.data.text,a.isLoadingPost=!1,"video"==a.post.type&&k(a.post.data.text)){var c=a.post.data.text.split("v=")[1]||a.post.data.text.split("embed/")[1];c.indexOf("&")!=-1&&(c=c.substring(0,c.indexOf("&"))),a.videoEmbedURL="//www.youtube.com/embed/"+c+"?rel=0"}})},function(b){404==b.status?c.go("weco.notfound"):g.push("error","Error fetching post."),a.isLoadingPost=!1}),a.loadMore=function(){a.isLoadingMore||(a.isLoadingMore=!0,a.comments.length>0&&l(a.comments[a.comments.length-1].id))},b.$on("$stateChangeSuccess",function(b,c,e,f,g,h){d(function(){a.isLoadingComments=!0,a.comments=[],l()})})}]);var app=angular.module("wecoApp");app.controller("subbranchesController",["$scope","$state","$timeout","Branch","Alerts",function(a,b,c,d,e){function f(b){var f,g=a.getTimeafter(a.timeItems[a.selectedTimeItemIdx]);switch(a.sortByItems[a.selectedSortByItemIdx]){case"TOTAL POINTS":f="post_points";break;case"DATE":f="date";break;case"NUMBER OF POSTS":f="post_count";break;case"NUMBER OF COMMENTS":f="post_comments";break;default:f="date"}d.getSubbranches(a.branchid,g,f,b).then(function(d){c(function(){b?a.branches=a.branches.concat(d):a.branches=d,a.isLoading=!1,a.isLoadingMore=!1})},function(){e.push("error","Error fetching branches."),a.isLoading=!1})}a.isLoading=!0,a.isLoadingMore=!1,a.branches=[],a.loadMore=function(){a.isLoadingMore||(a.isLoadingMore=!0,a.branches.length>0&&f(a.branches[a.branches.length-1].id))},a.selectedTimeItemIdx=0,a.$watch("selectedTimeItemIdx",function(){f()}),a.sortByItems=["TOTAL POINTS","NUMBER OF POSTS","NUMBER OF COMMENTS","DATE"],a.selectedSortByItemIdx=0,a.$watch("selectedSortByItemIdx",function(){f()})}]);var app=angular.module("wecoApp");app.controller("wallController",["$scope","$state","$timeout","Branch","Post","Alerts","Modal","ENV",function(a,b,c,d,e,f,g,h){function i(b){var e,g=a.getTimeafter(a.timeItems[a.selectedTimeItemIdx]);switch(a.sortByItems[a.selectedSortByItemIdx]){case"TOTAL POINTS":e="points";break;case"DATE":e="date";break;case"NUMBER OF COMMENTS":e="comment_count";break;default:e="points"}var h=a.postTypeItems[a.selectedPostTypeItemIdx].toLowerCase();d.getPosts(a.branchid,g,e,a.stat,h,b).then(function(d){c(function(){b?a.posts=a.posts.concat(d):a.posts=d,a.isLoading=!1,a.isLoadingMore=!1})},function(){f.push("error","Error fetching posts."),a.isLoading=!1})}a.isLoading=!1,a.isLoadingMore=!1,a.posts=[],a.stat="global",a.getProxyUrl=function(a){return a&&"http:"===a.substring(0,5)?h.apiEndpoint+"proxy?url="+a:a},a.getOriginalBranchesTooltipString=function(a){if(!a.data||!a.data.original_branches)return"";for(var b="",c=JSON.parse(a.data.original_branches),d=1;d<c.length;d++)b+=c[d]+(d<c.length?"\n":"");return b},a.getOriginalBranches=function(a){return a.data&&a.data.original_branches?JSON.parse(a.data.original_branches):""},a.vote=function(b,d){e.vote(a.branchid,b.id,d).then(function(){var a="up"==d?1:-1;c(function(){b.individual+=a,b.local+=a,b.global+=a}),f.push("success","Thanks for voting!")},function(a){400===a.status?f.push("error","You have already voted on this post."):f.push("error","Error voting on post.")})},a.setStat=function(b){c(function(){a.isLoading=!0,a.stat=b,a.posts=[],i()})},a.getLink=function(a){return"text"==a.type?b.href("weco.branch.post",{postid:a.id}):a.text},a.loadMore=function(){a.isLoadingMore||(a.isLoadingMore=!0,a.posts.length>0&&i(a.posts[a.posts.length-1].id))},a.openFlagPostModal=function(b){g.open("/app/components/modals/post/flag/flag-post.modal.view.html",{post:b,branchid:a.branchid}).then(function(a){a&&f.push("success","Post flagged. The branch moderators will be informed.")},function(){f.push("error","Unable to flag post.")})},a.selectedTimeItemIdx=0,a.$watch("selectedTimeItemIdx",function(){c(function(){a.isLoading=!0,a.posts=[],i()})}),a.postTypeItems=["ALL","TEXT","IMAGE","VIDEO","AUDIO","PAGE"],a.selectedPostTypeItemIdx=0,a.$watch("selectedPostTypeItemIdx",function(){c(function(){a.isLoading=!0,a.posts=[],i()})}),a.sortByItems=["TOTAL POINTS","NUMBER OF COMMENTS","DATE"],a.selectedSortByItemIdx=0,
a.$watch("selectedSortByItemIdx",function(){c(function(){"TOTAL POINTS"!=a.sortByItems[a.selectedSortByItemIdx]&&a.setStat("individual"),a.isLoading=!0,a.posts=[],i()})})}]);var app=angular.module("wecoApp");app.controller("profileNotificationsController",["$scope","$state","$timeout","User","NotificationTypes","Alerts",function(a,b,c,d,e,f){function g(e){a.isLoading=!0,d.getNotifications(b.params.username,!1,e).then(function(b){c(function(){e?a.notifications=a.notifications.concat(b):a.notifications=b,a.isLoading=!1,a.isLoadingMore=!1})},function(){f.push("error","Unable to fetch notifications.")})}a.isLoading=!1,a.isLoadingMore=!1,a.NotificationTypes=e,a.me=d.me,a.notifications=[],a.getNotificationImageType=function(a){switch(a.type){case e.NEW_CHILD_BRANCH_REQUEST:case e.CHILD_BRANCH_REQUEST_ANSWERED:case e.BRANCH_MOVED:return"branch";case e.MODERATOR:return"moderator";case e.COMMENT:return"comment";case e.POST_FLAGGED:case e.POST_REMOVED:case e.POST_TYPE_CHANGED:return"flagged";default:return"user"}},a.setUnread=function(a,b){d.markNotification(d.me().username,a.id,b).then(function(){c(function(){a.unread=b})},function(a){f.push("error","Unable to mark notification.")})},a.loadMore=function(){a.isLoadingMore||(a.isLoadingMore=!0,a.notifications.length>0&&g(a.notifications[a.notifications.length-1].id))},g(),a.reasonString=function(a){switch(a){case"branch_rules":return"for violating the branch rules";case"site_rules":return"for violating the site rules";case"wrong_type":return"for being tagged with an incorrect post type";case"nsfw":return"as NSFW";default:return""}}}]);var app=angular.module("wecoApp");app.controller("profileController",["$scope","$timeout","$state","User","Modal","Alerts",function(a,b,c,d,e,f){a.user={},a.showCover=!0,a.isLoading=!0,a.showCoverPicture=function(){a.showCover=!0},a.hideCoverPicture=function(){a.showCover=!1},d.get(c.params.username).then(function(c){b(function(){a.user=c,a.isLoading=!1})},function(b){404==b.status?c.go("weco.notfound"):f.push("error","Unable to fetch user."),a.isLoading=!1}),a.tabItems=["about","timeline"],a.tabStates=["weco.profile.about","weco.profile.timeline"],a.$watch(function(){return d.me().username},function(b){b==c.params.username&&(a.tabItems.indexOf("settings")==-1&&a.tabStates.indexOf("weco.profile.settings")==-1&&(a.tabItems.push("settings"),a.tabStates.push("weco.profile.settings")),a.tabItems.indexOf("notifications")==-1&&a.tabStates.indexOf("weco.profile.notifications")==-1&&(a.tabItems.push("notifications"),a.tabStates.push("weco.profile.notifications")))}),a.openProfilePictureModal=function(){e.open("/app/components/modals/upload/upload-image.modal.view.html",{route:"user/me/",type:"picture"}).then(function(a){a&&c.go(c.current,{},{reload:!0})},function(){f.push("error","Unable to change profile picture.")})},a.openCoverPictureModal=function(){e.open("/app/components/modals/upload/upload-image.modal.view.html",{route:"user/me/",type:"cover"}).then(function(a){a&&c.go(c.current,{},{reload:!0})},function(){f.push("error","Unable to change cover picture.")})},a.isMyProfile=function(){return d.me().username==c.params.username}}]);var app=angular.module("wecoApp");app.controller("profileSettingsController",["$scope","$state","Modal","Alerts","User",function(a,b,c,d,e){function f(a){c.open("/app/components/modals/profile/settings/settings.modal.view.html",a).then(function(a){a&&(b.go(b.current,{},{reload:!0}),d.push("success","Successfully updated profile settings!"))},function(){d.push("error","Unable to update profile settings.")})}a.openNameModal=function(){f({title:"Name",inputs:[{placeholder:"First name",type:"text",fieldname:"firstname"},{placeholder:"Last name",type:"text",fieldname:"lastname"}]})},a.openEmailModal=function(){f({title:"Email",inputs:[{placeholder:"Email",type:"email",fieldname:"email"}]})},a.openDOBModal=function(){f({title:"Date of Birth",inputs:[{placeholder:"Date of Birth",type:"date",fieldname:"dob"}]})},a.updateNSFW=function(){e.update({show_nsfw:a.user.show_nsfw}).then(function(){d.push("success","Successfully updated profile settings!")},function(){d.push("error","Unable to update profile settings.")})}}]);var app=angular.module("wecoApp");app.controller("confirmResetPasswordController",["$scope","$state","$timeout","User","Alerts",function(a,b,c,d,e){a.resetPassword=function(){return a.setLoading(!0),a.setLoopAnimation(!0),a.triggerAnimation(),a.credentials.password!=a.credentials.confirmPassword?(e.push("error","The two passwords are different."),a.setLoading(!1),void a.setLoopAnimation(!1)):void d.resetPassword(b.params.username,a.credentials.password,b.params.token).then(function(){e.push("success","Successfully updated password! You can now login.",!0),a.setLoading(!1),a.setLoopAnimation(!1),b.go("auth.login")},function(b){c(function(){a.setErrorMessage(b.message),a.setLoading(!1),a.setLoopAnimation(!1)})})}}]);var app=angular.module("wecoApp");app.controller("requestResetPasswordController",["$scope","$state","$timeout","User","Alerts",function(a,b,c,d,e){a.sendLink=function(){a.setLoading(!0),a.setLoopAnimation(!0),a.triggerAnimation(),d.requestResetPassword(a.credentials.username).then(function(){b.go("weco.home"),a.setLoading(!1),a.setLoopAnimation(!1),e.push("success","A password reset link has been sent to your inbox.",!0)},function(b){a.setLoading(!1),a.setErrorMessage(b.message),a.setLoopAnimation(!1)})}}]);var app=angular.module("wecoApp");app.controller("resetPasswordController",["$scope","$state","$timeout","User","Alerts",function(a,b,c,d,e){a.errorMessage="",a.isLoading=!1,a.loopAnimation=!1,a.credentials={};var f="/assets/images/logo-animation-large.gif";a.triggerAnimation=function(){""!==f&&c(function(){f=""}),c(function(){f="/assets/images/logo-animation-large.gif"}),c(function(){f="",a.loopAnimation&&a.triggerAnimation()},1e3)},a.setLoopAnimation=function(b){a.loopAnimation=b},a.setErrorMessage=function(b){a.errorMessage=b},a.setLoading=function(b){a.isLoading=b},a.getAnimationSrc=function(){return f}}]);var app=angular.module("wecoApp");app.controller("verifyController",["$scope","$state","$interval","$timeout","User","Alerts",function(a,b,c,d,e,f){a.message="Verifying your account.";var g="/assets/images/logo-animation-large.gif";c(function(){""!==g&&d(function(){g=""}),d(function(){g="/assets/images/logo-animation-large.gif"}),a.message.indexOf("...")>-1?a.message="Verifying your account.":a.message+="."},1e3),d(function(){e.verify(b.params.username,b.params.token).then(function(){b.go("auth.login"),f.push("success","Account verified! You can now login.",!0)},function(a){f.push("error","Unable to verify your account. Your token may have expired: try signing up again.",!0),b.go("auth.signup")})},3e3),a.getAnimationSrc=function(){return g}}]),function(a,b){"function"==typeof define&&define.amd?define(["angular"],b):"object"==typeof module&&module.exports?module.exports=b(require("angular")):b(a.angular)}(this,function(angular,a){return angular.module("angular-google-analytics",[]).provider("Analytics",function(){var b,c,d,e,f,g=!0,h="auto",i=!1,j=!1,k="USD",l=!1,m=!1,n=!1,o=!1,p=!1,q=!1,r=!1,s=!1,t=!1,u=!1,v=!1,w="$routeChangeSuccess",x=!1,y=!1,z=!1,A="",B=!0,C=!1;this.log=[],this.offlineQueue=[],this.setAccount=function(c){return b=angular.isUndefined(c)||c===!1?a:angular.isArray(c)?c:angular.isObject(c)?[c]:[{tracker:c,trackEvent:!0}],this},this.trackPages=function(a){return B=!!a,this},this.trackPrefix=function(a){return A=a,this},this.setDomainName=function(a){return d=a,this},this.useDisplayFeatures=function(a){return n=!!a,this},this.useAnalytics=function(a){return g=!!a,this},this.useEnhancedLinkAttribution=function(a){return r=!!a,this},this.useCrossDomainLinker=function(a){return j=!!a,this},this.setCrossLinkDomains=function(a){return c=a,this},this.setPageEvent=function(a){return w=a,this},this.setCookieConfig=function(a){return h=a,this},this.useECommerce=function(a,b){return p=!!a,q=!!b,this},this.setCurrency=function(a){return k=a,this},this.setRemoveRegExp=function(a){return a instanceof RegExp&&(f=a),this},this.setExperimentId=function(a){return e=a,this},this.ignoreFirstPageLoad=function(a){return s=!!a,this},this.trackUrlParams=function(a){return C=!!a,this},this.disableAnalytics=function(a){return o=!!a,this},this.setHybridMobileSupport=function(a){return u=!!a,this},this.startOffline=function(a){return v=!!a,v===!0&&this.delayScriptTag(!0),this},this.delayScriptTag=function(a){return m=!!a,this},this.logAllCalls=function(a){return t=!!a,this},this.enterTestMode=function(){return y=!0,this},this.enterDebugMode=function(a){return l=!0,z=!!a,this},this.readFromRoute=function(a){return x=!!a,this},this.$get=["$document","$location","$log","$rootScope","$window","$injector",function(D,$location,E,F,G,$injector){var H=this,I=function(a,b){return angular.isObject(b)&&angular.isDefined(b[a])},J=function(a,b,c){return I(a,b)&&b[a]===c},K=function(a,b){return angular.isString(b)?b+"."+a:I("name",b)?b.name+"."+a:a},L={};x&&($injector.has("$route")?L=$injector.get("$route"):E.warn("$route service is not available. Make sure you have included ng-route in your application dependencies."));var M=function(){if(x&&L.current&&"pageTrack"in L.current)return L.current.pageTrack;var a=C?$location.url():$location.path();return f?a.replace(f,""):a},N=function(){var a={utm_source:"campaignSource",utm_medium:"campaignMedium",utm_term:"campaignTerm",utm_content:"campaignContent",utm_campaign:"campaignName"},b={};return angular.forEach($location.search(),function(c,d){var e=a[d];angular.isDefined(e)&&(b[e]=c)}),b},O=function(a,b,c,d,e,f,g,h,i){var j={};return a&&(j.id=a),b&&(j.affiliation=b),c&&(j.revenue=c),d&&(j.tax=d),e&&(j.shipping=e),f&&(j.coupon=f),g&&(j.list=g),h&&(j.step=h),i&&(j.option=i),j},P=function(a){!g&&G._gaq&&"function"==typeof a&&a()},Q=function(){var a=Array.prototype.slice.call(arguments);return v===!0?void H.offlineQueue.push([Q,a]):(G._gaq||(G._gaq=[]),t===!0&&H._log.apply(H,a),void G._gaq.push(a))},R=function(a){g&&G.ga&&"function"==typeof a&&a()},S=function(){var a=Array.prototype.slice.call(arguments);return v===!0?void H.offlineQueue.push([S,a]):"function"!=typeof G.ga?void H._log("warn","ga function not set on window"):(t===!0&&H._log.apply(H,a),void G.ga.apply(null,a))},T=function(a){var c=Array.prototype.slice.call(arguments,1),d=c[0],e=[];return"function"==typeof a?b.forEach(function(b){a(b)&&e.push(b)}):e=b,0===e.length?void S.apply(H,c):void e.forEach(function(a){I("select",a)&&"function"==typeof a.select&&!a.select(c)||(c[0]=K(d,a),S.apply(H,c))})};return this._log=function(){var a=Array.prototype.slice.call(arguments);if(a.length>0){if(a.length>1)switch(a[0]){case"debug":case"error":case"info":case"log":case"warn":E[a[0]](a.slice(1))}H.log.push(a)}},this._createScriptTag=function(){if(!b||b.length<1)return void H._log("warn","No account id set to create script tag");if(b.length>1&&(H._log("warn","Multiple trackers are not supported with ga.js. Using first tracker only"),b=b.slice(0,1)),i===!0)return void H._log("warn","ga.js or analytics.js script tag already created");o===!0&&(H._log("info","Analytics disabled: "+b[0].tracker),G["ga-disable-"+b[0].tracker]=!0),Q("_setAccount",b[0].tracker),d&&Q("_setDomainName",d),r&&Q("_require","inpage_linkid","//www.google-analytics.com/plugins/ga/inpage_linkid.js"),B&&!s&&(f?Q("_trackPageview",M()):Q("_trackPageview"));var a,c=D[0];return a=n===!0?("https:"===c.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js":("https:"===c.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",y!==!0?!function(){var b=c.createElement("script");b.type="text/javascript",b.async=!0,b.src=a;var d=c.getElementsByTagName("script")[0];d.parentNode.insertBefore(b,d)}():H._log("inject",a),i=!0,!0},this._createAnalyticsScriptTag=function(){if(!b)return void H._log("warn","No account id set to create analytics script tag");if(i===!0)return void H._log("warn","ga.js or analytics.js script tag already created");o===!0&&b.forEach(function(a){H._log("info","Analytics disabled: "+a.tracker),G["ga-disable-"+a.tracker]=!0});var a=D[0],d=u===!0?"https:":"",f=d+"//www.google-analytics.com/"+(l?"analytics_debug.js":"analytics.js");if(y!==!0?!function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,a,"script",f,"ga"):("function"!=typeof G.ga&&(G.ga=function(){}),H._log("inject",f)),z&&(G.ga_debug={trace:!0}),b.forEach(function(a){a.crossDomainLinker=I("crossDomainLinker",a)?a.crossDomainLinker:j,a.crossLinkDomains=I("crossLinkDomains",a)?a.crossLinkDomains:c,a.displayFeatures=I("displayFeatures",a)?a.displayFeatures:n,a.enhancedLinkAttribution=I("enhancedLinkAttribution",a)?a.enhancedLinkAttribution:r,a.set=I("set",a)?a.set:{},a.trackEcommerce=I("trackEcommerce",a)?a.trackEcommerce:p,a.trackEvent=!!I("trackEvent",a)&&a.trackEvent;var b={};I("fields",a)?b=a.fields:I("cookieConfig",a)?angular.isString(a.cookieConfig)?b.cookieDomain=a.cookieConfig:b=a.cookieConfig:angular.isString(h)?b.cookieDomain=h:h&&(b=h),a.crossDomainLinker===!0&&(b.allowLinker=!0),I("name",a)&&(b.name=a.name),a.fields=b,S("create",a.tracker,a.fields),u===!0&&S(K("set",a),"checkProtocolTask",null);for(var d in a.set)a.set.hasOwnProperty(d)&&S(K("set",a),d,a.set[d]);a.crossDomainLinker===!0&&(S(K("require",a),"linker"),angular.isDefined(a.crossLinkDomains)&&S(K("linker:autoLink",a),a.crossLinkDomains)),a.displayFeatures&&S(K("require",a),"displayfeatures"),a.trackEcommerce&&(q?(S(K("require",a),"ec"),S(K("set",a),"&cu",k)):S(K("require",a),"ecommerce")),a.enhancedLinkAttribution&&S(K("require",a),"linkid"),B&&!s&&S(K("send",a),"pageview",A+M())}),e){var g=a.createElement("script"),m=a.getElementsByTagName("script")[0];g.src=d+"//www.google-analytics.com/cx/api.js?experiment="+e,m.parentNode.insertBefore(g,m)}return i=!0,!0},this._ecommerceEnabled=function(a,b){var c=p&&!q;return a===!0&&c===!1&&(p&&q?H._log("warn",b+" is not available when Enhanced Ecommerce is enabled with analytics.js"):H._log("warn","Ecommerce must be enabled to use "+b+" with analytics.js")),c},this._enhancedEcommerceEnabled=function(a,b){var c=p&&q;return a===!0&&c===!1&&H._log("warn","Enhanced Ecommerce must be enabled to use "+b+" with analytics.js"),c},this._trackPage=function(b,c,d){b=b?b:M(),c=c?c:D[0].title,P(function(){Q("_set","title",c),Q("_trackPageview",A+b)}),R(function(){var e={page:A+b,title:c};angular.extend(e,N()),angular.isObject(d)&&angular.extend(e,d),T(a,"send","pageview",e)})},this._trackEvent=function(a,b,c,d,e,f){P(function(){Q("_trackEvent",a,b,c,d,!!e)}),R(function(){var g={},h=function(a){return J("trackEvent",a,!0)};angular.isDefined(e)&&(g.nonInteraction=!!e),angular.isObject(f)&&angular.extend(g,f),angular.isDefined(g.page)||(g.page=M()),T(h,"send","event",a,b,c,d,g)})},this._addTrans=function(a,b,c,d,e,f,g,h,i){P(function(){Q("_addTrans",a,b,c,d,e,f,g,h)}),R(function(){if(H._ecommerceEnabled(!0,"addTrans")){var f=function(a){return J("trackEcommerce",a,!0)};T(f,"ecommerce:addTransaction",{id:a,affiliation:b,revenue:c,tax:d,shipping:e,currency:i||"USD"})}})},this._addItem=function(a,b,c,d,e,f){P(function(){Q("_addItem",a,b,c,d,e,f)}),R(function(){if(H._ecommerceEnabled(!0,"addItem")){var g=function(a){return J("trackEcommerce",a,!0)};T(g,"ecommerce:addItem",{id:a,name:c,sku:b,category:d,price:e,quantity:f})}})},this._trackTrans=function(){P(function(){Q("_trackTrans")}),R(function(){if(H._ecommerceEnabled(!0,"trackTrans")){var a=function(a){return J("trackEcommerce",a,!0)};T(a,"ecommerce:send")}})},this._clearTrans=function(){R(function(){if(H._ecommerceEnabled(!0,"clearTrans")){var a=function(a){return J("trackEcommerce",a,!0)};T(a,"ecommerce:clear")}})},this._addProduct=function(a,b,c,d,e,f,g,h,i,j){P(function(){Q("_addProduct",a,b,c,d,e,f,g,h,i)}),R(function(){if(H._enhancedEcommerceEnabled(!0,"addProduct")){var k=function(a){return J("trackEcommerce",a,!0)},l={id:a,name:b,category:c,brand:d,variant:e,price:f,quantity:g,coupon:h,position:i};angular.isObject(j)&&angular.extend(l,j),T(k,"ec:addProduct",l)}})},this._addImpression=function(a,b,c,d,e,f,g,h){P(function(){Q("_addImpression",a,b,c,d,e,f,g,h)}),R(function(){if(H._enhancedEcommerceEnabled(!0,"addImpression")){var i=function(a){return J("trackEcommerce",a,!0)};T(i,"ec:addImpression",{id:a,name:b,category:e,brand:d,variant:f,list:c,position:g,price:h})}})},this._addPromo=function(a,b,c,d){P(function(){Q("_addPromo",a,b,c,d)}),R(function(){if(H._enhancedEcommerceEnabled(!0,"addPromo")){var e=function(a){return J("trackEcommerce",a,!0)};T(e,"ec:addPromo",{id:a,name:b,creative:c,position:d})}})},this._setAction=function(a,b){P(function(){Q("_setAction",a,b)}),R(function(){if(H._enhancedEcommerceEnabled(!0,"setAction")){var c=function(a){return J("trackEcommerce",a,!0)};T(c,"ec:setAction",a,b)}})},this._trackTransaction=function(a,b,c,d,e,f,g,h,i){this._setAction("purchase",O(a,b,c,d,e,f,g,h,i))},this._trackRefund=function(a){this._setAction("refund",O(a))},this._trackCheckOut=function(a,b){this._setAction("checkout",O(null,null,null,null,null,null,null,a,b))},this._trackDetail=function(){this._setAction("detail"),this._pageView()},this._trackCart=function(a,b){["add","remove"].indexOf(a)!==-1&&(this._setAction(a,{list:b}),this._trackEvent("UX","click",a+("add"===a?" to cart":" from cart")))},this._promoClick=function(a){this._setAction("promo_click"),this._trackEvent("Internal Promotions","click",a)},this._productClick=function(a){this._setAction("click",O(null,null,null,null,null,null,a,null,null)),this._trackEvent("UX","click",a)},this._pageView=function(a){R(function(){S(K("send",a),"pageview")})},this._send=function(){var a=Array.prototype.slice.call(arguments);a.unshift("send"),R(function(){S.apply(H,a)})},this._set=function(a,b,c){R(function(){S(K("set",c),a,b)})},this._trackTimings=function(b,c,d,e){R(function(){T(a,"send","timing",b,c,d,e)})},this._trackException=function(b,c){R(function(){T(a,"send","exception",{exDescription:b,exFatal:!!c})})},m||(g?this._createAnalyticsScriptTag():this._createScriptTag()),B&&F.$on(w,function(){(!x||L.current&&L.current.templateUrl&&!L.current.doNotTrack)&&H._trackPage()}),{log:H.log,offlineQueue:H.offlineQueue,configuration:{accounts:b,universalAnalytics:g,crossDomainLinker:j,crossLinkDomains:c,currency:k,debugMode:l,delayScriptTag:m,disableAnalytics:o,displayFeatures:n,domainName:d,ecommerce:H._ecommerceEnabled(),enhancedEcommerce:H._enhancedEcommerceEnabled(),enhancedLinkAttribution:r,experimentId:e,hybridMobileSupport:u,ignoreFirstPageLoad:s,logAllCalls:t,pageEvent:w,readFromRoute:x,removeRegExp:f,testMode:y,traceDebuggingMode:z,trackPrefix:A,trackRoutes:B,trackUrlParams:C},getUrl:M,setCookieConfig:H._setCookieConfig,getCookieConfig:function(){return h},createAnalyticsScriptTag:function(a){return a&&(h=a),H._createAnalyticsScriptTag()},createScriptTag:function(){return H._createScriptTag()},offline:function(a){if(a===!0&&v===!1&&(v=!0),a===!1&&v===!0)for(v=!1;H.offlineQueue.length>0;){var b=H.offlineQueue.shift();b[0].apply(H,b[1])}return v},trackPage:function(a,b,c){H._trackPage.apply(H,arguments)},trackEvent:function(a,b,c,d,e,f){H._trackEvent.apply(H,arguments)},addTrans:function(a,b,c,d,e,f,g,h,i){H._addTrans.apply(H,arguments)},addItem:function(a,b,c,d,e,f){H._addItem.apply(H,arguments)},trackTrans:function(){H._trackTrans.apply(H,arguments)},clearTrans:function(){H._clearTrans.apply(H,arguments)},addProduct:function(a,b,c,d,e,f,g,h,i,j){H._addProduct.apply(H,arguments)},addPromo:function(a,b,c,d){H._addPromo.apply(H,arguments)},addImpression:function(a,b,c,d,e,f,g,h){H._addImpression.apply(H,arguments)},productClick:function(a){H._productClick.apply(H,arguments)},promoClick:function(a){H._promoClick.apply(H,arguments)},trackDetail:function(){H._trackDetail.apply(H,arguments)},trackCart:function(a,b){H._trackCart.apply(H,arguments)},trackCheckout:function(a,b){H._trackCheckOut.apply(H,arguments)},trackTimings:function(a,b,c,d){H._trackTimings.apply(H,arguments)},trackTransaction:function(a,b,c,d,e,f,g,h,i){H._trackTransaction.apply(H,arguments)},trackException:function(a,b){H._trackException.apply(H,arguments)},setAction:function(a,b){H._setAction.apply(H,arguments)},pageView:function(){H._pageView.apply(H,arguments)},send:function(a){H._send.apply(H,arguments)},set:function(a,b,c){H._set.apply(H,arguments)}}}]}).directive("gaTrackEvent",["Analytics","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){var f=b(e.gaTrackEvent);d.bind("click",function(){e.gaTrackEventIf&&!c.$eval(e.gaTrackEventIf)||f.length>1&&a.trackEvent.apply(a,f(c))})}}}]),angular.module("angular-google-analytics")});